{
  "sections": [
    {
      "id": "section-architecture",
      "slug": "architecture",
      "title": "Architecture Overview",
      "entries": [
        {
          "id": "aspect-runtime-bootstrap",
          "sectionId": "section-architecture",
          "slug": "runtime-bootstrap",
          "name": "Runtime bootstrap wires CLI, config, database, and TUI",
          "description": "`main.go` enables optional pprof when `CRUSH_PROFILE` is set and delegates to the Cobra root command, whose `RunE` path initializes the app via `setupApp`, spawns the Bubble Tea program, and streams events into the TUI. `setupApp` resolves the working directory, loads config (including YOLO permission overrides), ensures the per-user data directory, and connects to SQLite with tuned pragmas before constructing the `app.App`. The app constructor wires session/message/history services, permission handling, LSP client caches, and the coder agent, registers cleanup hooks, and starts background event loops, while metrics dispatch is guarded by `shouldEnableMetrics`. The bootstrap pass also writes a `.gitignore` alongside the data directory, wraps Cobra through Fang to install version banners plus signal handling, and lets `MaybePrependStdin` fold piped stdin ahead of prompts for non-interactive runs. The database connect routine applies pragmatic defaults (foreign keys, WAL, cache/page tuning) and runs goose migrations up-front to guarantee schema readiness for the rest of the runtime.",
          "tags": [
            "architecture",
            "cli",
            "cli-runtime",
            "config",
            "sqlite",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/main.go",
              "sha256": "5be1f8c97e29217502762d14cab3dce4d3fd3a8973c370c8779bf55f18239539"
            },
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            },
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            },
            {
              "path": "projects/Crush/internal/db/connect.go",
              "sha256": "fa45f5ef2272863b452837dccc253c7bb6ba75728474893a0e5345122fb1d08a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.9
        },
        {
          "id": "aspect-event-telemetry",
          "sectionId": "section-architecture",
          "slug": "event-telemetry",
          "name": "PostHog telemetry captures lifecycle and prompt metrics",
          "description": "`internal/event/event.go` boots a PostHog client with Charm-specific endpoint, stamps base props (runtime, shell, Crush version) and exposes helpers that mimic exception events via `$exception` payloads. `internal/event/all.go` records app/session milestones (init, exit with duration, prompt send/respond, token usage) while `event.Error` bridges panic recovery. Startup now derives a stable `distinctId` via `machineid.ProtectedID` with an HMAC-MAC fallback so telemetry still correlates when the OS blocks machine IDs, and shutdown flows call `Flush` to close the PostHog client. The package funnels through the custom `logger` adapter to reuse slog so telemetry inherits the app's log level, establishing observability hooks that stay dormant until metrics are enabled.",
          "tags": [
            "architecture",
            "eventing",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/event.go",
              "sha256": "f235255dec6ac1a6de0bef38c6c39f69b1d97c20dcb9103d672034cf62dcd12e"
            },
            {
              "path": "projects/Crush/internal/event/all.go",
              "sha256": "21dfe17370ea51186d7bbb1c90737f06644c6c065121f1aff19820c1db6154f0"
            },
            {
              "path": "projects/Crush/internal/event/logger.go",
              "sha256": "7a27e1f03a63f585574635995bf600a425088036b395b8a393819ae694ad193a"
            },
            {
              "path": "projects/Crush/internal/event/identifier.go",
              "sha256": "f1b3108e8ac8cc01e3ba8d2ffc42b7f47d5a368bda00f72fb965a67f1e469c8a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.7
        },
        {
          "id": "aspect-pubsub-broker",
          "sectionId": "section-architecture",
          "slug": "pubsub-broker",
          "name": "Buffered pubsub broker fans service events into the TUI",
          "description": "`internal/pubsub/broker.go` provides a buffered, thread-safe broker where subscribers auto-unregister when their context closes, and `Publish` drops messages rather than blocking slow consumers. The broker tracks an explicit subscriber count for diagnostics and exposes `Shutdown` to close every channel atomically so background goroutines do not leak when the app exits. `app.setupEvents` registers session, message, permission, history, MCP, and LSP channels through `setupSubscriber`, relaying them onto a single Tea message queue with backpressure warnings. This design keeps background services decoupled while ensuring the TUI receives timely lifecycle updates.",
          "tags": [
            "architecture",
            "pubsub",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/pubsub/broker.go",
              "sha256": "99fd3c3e7aefb1b49b8e86412cb0b8ba359c757602751d7c183f341d5b43919d"
            },
            {
              "path": "projects/Crush/internal/pubsub/events.go",
              "sha256": "3199c3bfd00f640163056a4f0d615932573029ca8257f03f1c5bf9bdc36548e2"
            },
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.65
        },
        {
          "id": "aspect-app-subscribe-bridge",
          "sectionId": "section-architecture",
          "slug": "app-subscribe-bridge",
          "name": "TUI subscriber funnels fan-in events with panic recovery",
          "description": "`internal/app/app.go` wraps `App.Subscribe` in `log.RecoverPanic` and attaches a TUI-scoped context so UI panics trigger `program.Quit` instead of crashing. It adds a cleanup hook that cancels the handler, waits on `tuiWG`, and continually drains the shared `events` channel with `program.Send`, logging debug messages when the channel closes or contexts cancel. The bridge sits atop the 100-item `app.events` buffer seeded during app startup, giving the handler breathing room to catch up before slow renders drop messages. This pattern lets all service fan-in goroutines terminate cleanly without leaking when the Bubble Tea program exits.",
          "tags": [
            "architecture",
            "concurrency",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.72
        },
        {
          "id": "aspect-init-coder-agent",
          "sectionId": "section-architecture",
          "slug": "init-coder-agent",
          "name": "Coder agent initialization wires MCP cleanup and event subscription",
          "description": "`internal/app/app.go` verifies the `coder` agent config before calling `agent.NewAgent`, passing permission, session, message, history services, and the shared LSP cache so tools reuse backend state. It appends `agent.CloseMCPClients` to the app cleanup stack, registers the agent's pubsub feed through `setupSubscriber`, and only attempts initialization once onboarding marks the config as `IsConfigured`, otherwise logging a warning and continuing without the agent. This ensures MCP clients and prompt streams come up lazily and shut down with the rest of the runtime.",
          "tags": [
            "agent",
            "architecture",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.74
        },
        {
          "id": "aspect-app-shutdown",
          "sectionId": "section-architecture",
          "slug": "app-shutdown",
          "name": "Graceful shutdown cancels agents and closes LSP clients",
          "description": "`internal/app/app.go`'s `Shutdown` first calls `CoderAgent.CancelAll` to stop active generations, then iterates `LSPClients.Seq2()` to close each client within a five-second timeout while logging errors. It subsequently walks `cleanupFuncs`, which contains the database `Close`, event subscriber cancels, and the TUI handler teardown, so every goroutine spawned during startup observes the global context cancellation. This sequencing prevents background goroutines from outliving the process.",
          "tags": [
            "architecture",
            "concurrency",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.7
        },
        {
          "id": "aspect-noninteractive-streaming",
          "sectionId": "section-architecture",
          "slug": "noninteractive-streaming",
          "name": "Non-interactive spinner streams incremental agent output",
          "description": "`internal/app/app.go`'s `RunNonInteractive` builds a cancellable spinner via `format.NewSpinner`, auto-approves the new session, and keeps an `ansi` progress bar heartbeat while `CoderAgent.Run` streams results. It derives a history-friendly session title by prefixing `Non-interactive:` and truncating prompts over 100 characters with an ellipsis before storing the record. A `messageReadBytes` map tracks how many bytes from each assistant message have been printed so only new suffixes hit stdout, the spinner stops as soon as completions arrive or errors, and agent cancellations (`context.Canceled`, `agent.ErrRequestCancelled`) unwind cleanly without leaving escape sequences behind.",
          "tags": [
            "architecture",
            "cli-runtime",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.64
        },
        {
          "id": "aspect-service-event-waitgroup",
          "sectionId": "section-architecture",
          "slug": "service-event-waitgroup",
          "name": "Event subscribers share cleanup waitgroups and drop slow consumers",
          "description": "`internal/app/app.go` initialises `serviceEventsWG` and a cancellable `eventsCtx`, wiring subscribers for sessions, messages, permissions, history, MCP, and LSP. Each `setupSubscriber` goroutine pumps its pubsub channel into the shared `events` queue, warning when the TUI fails to receive within two seconds before dropping the message, and logging when upstream channels close or when the context cancels to aid debugging. The appended cleanup cancels the context and waits on the group so no fan-in goroutine leaks past shutdown.",
          "tags": [
            "architecture",
            "concurrency",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-lsp-client-cache",
          "sectionId": "section-architecture",
          "slug": "lsp-client-cache",
          "name": "App caches LSP clients and shuts them down with timeouts",
          "description": "`app.New` seeds `App.LSPClients` with a `csync.Map`, and `createAndStartLSPClient` stores each successfully initialised client before returning. Background initialisation skips disabled entries, verifies root markers with `lsp.HasRootMarkers`, and sets Bubble Tea diagnostics callbacks while tracking ready/error state via `updateLSPState`. On `Shutdown`, the app iterates `LSPClients.Seq2()`, opening a five-second context for each `client.Close` and logging failures, so background language servers respect the runtime lifecycle without leaking goroutines.",
          "tags": [
            "architecture",
            "concurrency",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            },
            {
              "path": "projects/Crush/internal/app/lsp.go",
              "sha256": "539ca0ea5633371ba59d819b9cf3ecc3e82bd4ce9d0d0e1dc9649377084d9b11"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        }
      ]
    },
    {
      "id": "section-config",
      "slug": "config",
      "title": "Configuration and Providers",
      "entries": [
        {
          "id": "aspect-config-json-merge",
          "slug": "config-json-merge",
          "name": "Config.Merge streams layered JSON readers with go-jsons",
          "description": "`config.Merge` delegates to `jsons.Merge`, letting Crush merge multiple `io.Reader` sources (user, repo, project) into a single buffer. The helper returns a fresh `bytes.Reader`, so callers can rewind and decode combined configuration without temporary files.",
          "tags": [
            "config"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/merge.go",
              "sha256": "e1d696dd2aea662ce2572b633e292801b2a3a193cb2905f27a7351e35c5ba430"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42,
          "sectionId": "section-config"
        },
        {
          "id": "aspect-config-loader",
          "sectionId": "section-config",
          "slug": "config-loader",
          "name": "Configuration loader hydrates providers and runtime defaults",
          "description": "`config.Load` discovers configs in project-local, repo, and user paths, merges them, and backfills defaults such as the data directory, debug toggles, and Bubble Tea limits (including git-less fallbacks). It sets up structured logging under `.crush/logs`, instantiates an env-backed resolver for provider secrets, and initializes provider definitions by blending Catwalk metadata with user overrides, extra headers, and curated model lists before registering agents. Provider discovery relies on `provider.go`, which caches Catwalk responses under XDG or OS-specific data directories, serves embedded or cached entries when auto-update is disabled, and refreshes in the background when caches are stale. Companion tests (`load_test.go`) assert the precedence chain (project \u2192 repo \u2192 user), default data directories, and completion limits so regressions in merge order surface immediately. Together these flows ensure any run starts with fully resolved provider catalogs, selected models, and MCP/LSP scaffolding while keeping credentials in environment variables.",
          "tags": [
            "config",
            "llm",
            "mcp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            },
            {
              "path": "projects/Crush/internal/config/config.go",
              "sha256": "deb2d8e112ff7cab7783428cc2af45b751908841e4ee9d5b4620953544e37294"
            },
            {
              "path": "projects/Crush/internal/config/provider.go",
              "sha256": "743106292f4f369ab0b89ca7dba731d2b4ce05628c60daa3362c02fb58ad6d15"
            },
            {
              "path": "projects/Crush/internal/config/load_test.go",
              "sha256": "1bbdf828ed2b47805f8eae8c90663cbea89641a5019372118e0d3f7842cb79c8"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.85
        },
        {
          "id": "aspect-config-lsp-defaults-tests",
          "sectionId": "section-config",
          "slug": "config-lsp-defaults-tests",
          "name": "LSP defaults tests guard builtin root markers",
          "description": "`internal/config/lsp_defaults_test.go` builds a config containing gopls and a custom entry, runs `applyLSPDefaults`, and asserts only the known gopls block inherits packaged root markers while the hand-authored `custom` record keeps its explicit list. The regression locks in that default hydration never clobbers user-specified markers yet backfills first-party servers so they boot without extra config.",
          "tags": [
            "config",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/lsp_defaults_test.go",
              "sha256": "f85fd8d09c54d59f61206af2ebed6198dd1cad32494c0f4755a8aa1137b51e1e"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.34
        },
        {
          "id": "aspect-config-merge-tests",
          "sectionId": "section-config",
          "slug": "config-merge-tests",
          "name": "Merge tests verify multi-reader JSON stitch",
          "description": "`internal/config/merge_test.go` feeds two JSON readers into `Merge`, expecting a single deterministic concatenation without errors. The check proves the helper drains each stream and rewinds the buffer so higher-level config loading can combine repo, project, and user files safely.",
          "tags": [
            "config"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/merge_test.go",
              "sha256": "7cafadbc39b7b3ff2732a7cabd1a7fd039ab40a85c4e22a89ef3140d425a29ca"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.3
        },
        {
          "id": "aspect-config-provider-empty-tests",
          "sectionId": "section-config",
          "slug": "config-provider-empty-tests",
          "name": "Provider loader tests cover empty responses",
          "description": "`internal/config/provider_empty_test.go` stubs Catwalk with an empty provider set and confirms `loadProviders` surfaces the friendly error while avoiding an on-disk cache. A follow-up case seeds an empty cache JSON, then checks the loader refreshes mock data, proving cache misses self-heal instead of propagating blanks.",
          "tags": [
            "config",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/provider_empty_test.go",
              "sha256": "342363ff1548917e614743628ea5de37611b487c6fa42cfe61f625415fd14ea6"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.36
        },
        {
          "id": "aspect-config-schema-artifact",
          "sectionId": "section-config",
          "slug": "config-schema-artifact",
          "name": "Config JSON schema documents providers, options, and permissions",
          "description": "`schema.json` defines Draft 2020-12 schema for Crush config, covering provider dictionaries, model selections, MCP servers, LSP maps, and options like context paths or attribution toggles. Defaults (e.g., `attribution.generated_with`, completions limits) are encoded so editors can validate config files generated by the CLI.",
          "tags": [
            "config",
            "schema"
          ],
          "sources": [
            {
              "path": "projects/Crush/schema.json",
              "sha256": "3f7ac51a48af1f004afd1a6680e14498db6112d846e3d6046e18047faf4ead8e"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.6
        },
        {
          "id": "aspect-context-path-presets",
          "sectionId": "section-config",
          "slug": "context-path-presets",
          "name": "Context path presets cover common CRUSH documentation variants",
          "description": "`internal/config/config.go` lists mixed-case defaults for Crush onboarding files, and `setDefaults` in `internal/config/load.go` prepends them, sorts with `slices.Sort`, and compacts duplicates. The preset list ensures new workspaces surface CRUSH/AGENTS instructions even when teams rename or case-shift the files, and the prompt builder (`internal/llm/prompt/prompt.go`) streams those paths through the context expander so agents automatically ingest the curated docs.",
          "tags": [
            "config",
            "onboarding",
            "tui",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/config.go",
              "sha256": "deb2d8e112ff7cab7783428cc2af45b751908841e4ee9d5b4620953544e37294"
            },
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            },
            {
              "path": "projects/Crush/internal/llm/prompt/prompt.go",
              "sha256": "dedbea50b9f64bef0a6a882972001841376983d44a3ffb4fe96a6e0e54fc1eac"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-crush-default-config",
          "sectionId": "section-config",
          "slug": "crush-default-config",
          "name": "Default crush.json enables gopls with schema metadata",
          "description": "`crush.json` references the public schema and pre-enables the Go LSP (`gopls`) so fresh checkouts have language intelligence without extra setup. The file anchors schema validation during onboarding and documents the single built-in provider.",
          "tags": [
            "config",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/crush.json",
              "sha256": "68bdb7f2500f7e0418a63200c303f4ba2cd6a27ba8a197559e21be8f8454464f"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.38
        },
        {
          "id": "aspect-data-directory-resolution",
          "sectionId": "section-config",
          "slug": "data-directory-resolution",
          "name": "Data directory resolution reuses nearest `.crush` folder",
          "description": "`internal/config/load.go`'s `setDefaults` honours the CLI flag when supplied, otherwise calls `fsext.LookupClosest` to reuse the nearest `.crush` directory before falling back to `<workingDir>/.crush`. This keeps multiple repos sharing an ancestor cache without duplicating data directories while still provisioning one when nothing exists.",
          "tags": [
            "config",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "id": "aspect-env-interface-wrapper",
          "sectionId": "section-config",
          "slug": "env-interface-wrapper",
          "name": "Env interface abstracts OS lookups and map-backed overrides",
          "description": "`internal/env/env.go` defines a simple `Env` interface with `Get` and `Env`, providing both an `osEnv` implementation and a `mapEnv` for tests so configuration loaders can swap environments without touching global state. `env_test.go` exercises the map-backed variant to ensure empty maps return nil slices and lookups behave predictably.",
          "tags": [
            "config",
            "environment",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/env/env.go",
              "sha256": "2b81425fba63c04e1912f2099d2b426f9d6b4755f0a1197b10f2236073515e5c"
            },
            {
              "path": "projects/Crush/internal/env/env_test.go",
              "sha256": "1ef6d0f35e69028cafc178d8a7f0a67ce288df71944d86a5a5bae99b0f35a500"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-git-worktree-throttles",
          "sectionId": "section-config",
          "slug": "git-worktree-throttles",
          "name": "Git detection caps ls and completion scans outside repositories",
          "description": "`internal/config/load.go` runs `git rev-parse --is-inside-work-tree` and, when it fails, uses `assignIfNil` to cap the ls tool's depth/items along with the TUI completions limits. The guard prevents expensive filesystem walks when Crush runs against ad-hoc directories or temporary workspaces, and the ls tool honours those limits via `config.Options.TUI.Completions` when assembling directory trees.",
          "tags": [
            "config",
            "tui",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            },
            {
              "path": "projects/Crush/internal/llm/tools/ls.go",
              "sha256": "2b194e28482514686a7c57c9aa3a87b779159423090a53f188a1dee869902fe1"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.64
        },
        {
          "id": "aspect-lsp-defaults-powernap",
          "sectionId": "section-config",
          "slug": "lsp-defaults-powernap",
          "name": "Powernap defaults backfill incomplete LSP server definitions",
          "description": "`internal/config/load.go`'s `applyLSPDefaults` loads the Powernap catalogue and fills any missing options, init options, file types, root markers, command, args, or environment entries for each configured server. That lets minimal snippets inherit workable LSP settings while still permitting explicit overrides.",
          "tags": [
            "config",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.68
        },
        {
          "id": "aspect-permissions-options",
          "sectionId": "section-config",
          "slug": "permissions-options",
          "name": "Config options govern permissions, metrics, and TUI limits",
          "description": "`internal/config/config.go` models `Options` and `Permissions`, allowing users to pre-authorize specific tool actions via `AllowedTools`, toggle YOLO (`SkipRequests`), and disable metrics. The same struct controls completions depth/size limits and attribution banners, which downstream tools (e.g., Bash) inspect before formatting instructions. These settings feed directly into `setupApp`, shaping how aggressively Crush prompts for approvals and how much data the TUI surfaces when traversing projects.",
          "tags": [
            "config",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/config.go",
              "sha256": "deb2d8e112ff7cab7783428cc2af45b751908841e4ee9d5b4620953544e37294"
            },
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.62
        },
        {
          "id": "aspect-project-initialization",
          "sectionId": "section-config",
          "slug": "project-initialization",
          "name": "Initialization flags gate onboarding and context discovery",
          "description": "`config/init.go` stores the active config in a global pointer and derives project initialization status by checking a `.crush/init` marker alongside presence of default context files (e.g., `CRUSH.md`, `CLAUDE.md`). It exposes `ProjectNeedsInitialization` for the TUI, which the chat page consumes to decide whether to run onboarding or project setup flows, and `MarkProjectInitialized` writes the sentinel file once context is ready. The chat page (`internal/tui/page/chat/chat.go`) leverages these signals to toggle full-screen splash states, focus the editor when ready, and prompt users to generate CRUSH context files when missing.",
          "tags": [
            "config",
            "onboarding",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/init.go",
              "sha256": "7edbbda2c55eaf21f3f40ff47a5284ae56d1fb25e9c9f081f580198d101fbf55"
            },
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.68
        },
        {
          "id": "aspect-provider-cache",
          "sectionId": "section-config",
          "slug": "provider-cache",
          "name": "Provider cache balances embedded fallbacks and background refreshes",
          "description": "`internal/config/provider.go` resolves provider lists from Catwalk or local sources, persisting them under XDG data or OS-specific app data using `home.Dir()` helpers. When auto-update is disabled, it seeds providers from embedded data; otherwise it serves cached payloads while updating in the background and normalizes duplicates. `UpdateProviders` also accepts explicit files/URLs, writing the same cache path so CLI invocations and runtime boot share a single source of truth.",
          "tags": [
            "config",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/provider.go",
              "sha256": "743106292f4f369ab0b89ca7dba731d2b4ce05628c60daa3362c02fb58ad6d15"
            },
            {
              "path": "projects/Crush/internal/home/home.go",
              "sha256": "9388f433d6bc886d152530115e5fafd49fa21e2bbcfbd02dcd607c4ca46ca947"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.75
        },
        {
          "id": "aspect-provider-specialcases",
          "sectionId": "section-config",
          "slug": "provider-specialcases",
          "name": "Provider reconciliation validates Vertex, Azure, and Bedrock credentials",
          "description": "`internal/config/load.go`'s `configureProviders` merges Catwalk models with user overrides but also populates provider-specific extras: Vertex AI pulls project and location from env, Azure resolves and validates its endpoint, and Bedrock ensures AWS creds exist and only Anthropics models are referenced. Providers lacking keys, models, or supported types are pruned to keep the runtime from booting misconfigured entries, and `provider_test.go` covers base-URL overrides, OpenRouter fallbacks, and missing credential cases to guard against regressions.",
          "tags": [
            "config",
            "environment",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            },
            {
              "path": "projects/Crush/internal/config/provider_test.go",
              "sha256": "b79f2690e931c5953b3659290a291164b006016ac14e894fb1169d47f672899c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.72
        },
        {
          "id": "aspect-pushpop-crush-env",
          "sectionId": "section-config",
          "slug": "pushpop-crush-env",
          "name": "CRUSH_* env shadowing enables temporary provider overrides",
          "description": "`internal/config/load.go` wraps provider configuration in `PushPopCrushEnv`, copying any `CRUSH_*` variables to their bare names, running setup, and restoring the environment afterward. This lets users inject alternate API keys or endpoints without permanently mutating process env, while still allowing resolver lookups during provider initialization. `provider.NewProvider` relies on the helper so credential resolution and HTTP option wiring can safely read temporarily shadowed variables and then hand control back to the caller.",
          "tags": [
            "config",
            "environment",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            },
            {
              "path": "projects/Crush/internal/llm/provider/provider.go",
              "sha256": "9a0a3ec225a1f250b6fbb391fccffac2c046d12d7d8d519e792714867ad5f8c6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-variable-resolver",
          "sectionId": "section-config",
          "slug": "variable-resolver",
          "name": "Shell-aware resolver expands secrets and command substitutions",
          "description": "`config.NewShellVariableResolver` wraps a Crush shell with the current environment to expand `$VAR`, `${VAR}`, and `$(command)` expressions when providers reference secrets. `ResolveValue` enforces balanced delimiters, trims command output, and fails fast on missing variables so misconfigured credentials surface early. For simpler lookups, `NewEnvironmentVariableResolver` returns unwrapped values directly from `env.Env`, keeping config resolution predictable across environments. `resolve_test.go` covers double expansion, missing variables, and shell command failures to guarantee resolver behaviour stays stable across platforms.",
          "tags": [
            "config",
            "environment",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/resolve.go",
              "sha256": "34ccf7e292e4c444acf493db753dc44de4c447e1c72f44eac82b40d74c9a096a"
            },
            {
              "path": "projects/Crush/internal/env/env.go",
              "sha256": "2b81425fba63c04e1912f2099d2b426f9d6b4755f0a1197b10f2236073515e5c"
            },
            {
              "path": "projects/Crush/internal/config/resolve_test.go",
              "sha256": "bf8fd08957aa76399df4fdc46fa3d9cc66fcb8987e8a7ffe408f031fb7d95bf2"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-version-buildinfo-fallback",
          "sectionId": "section-config",
          "slug": "version-buildinfo-fallback",
          "name": "version package falls back to build info when ldflags absent",
          "description": "`internal/version/version.go` initializes `Version` to `unknown` but reads `debug.ReadBuildInfo` during init, adopting the module version when Crush is installed via `go install` without ldflags.",
          "tags": [
            "cli",
            "config",
            "distribution"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/version/version.go",
              "sha256": "9e5e5e1724cac0b4a4657817476035795affb86f24e9ebfb6703bb2b4f53100e"
            },
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        }
      ]
    },
    {
      "id": "section-sessions",
      "slug": "sessions",
      "title": "Sessions and Storage",
      "entries": [
        {
          "id": "aspect-session-service",
          "sectionId": "section-sessions",
          "slug": "session-service",
          "name": "Session service seeds UUID records and publishes lifecycle events",
          "description": "`internal/session/session.go` issues sqlc `CreateSession`/`CreateSessionParams` calls to seed UUID rows, fires `event.SessionCreated`/`SessionDeleted`, and publishes broker events so the TUI and metrics hooks catch lifecycle changes. `CreateTaskSession` reuses the tool call identifier as the primary key, while `CreateTitleSession` prefixes `title-` and default copy to coordinate the summariser. `Save` persists token counts, cost, and summary pointers before emitting Updated events, keeping downstream caches in sync with the database.",
          "tags": [
            "pubsub",
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            },
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.78
        },
        {
          "id": "aspect-history-versioning",
          "sectionId": "section-sessions",
          "slug": "history-versioning",
          "name": "Versioned file history retries on conflicts and lists latest snapshots",
          "description": "`internal/history/file.go` wraps writes in `createWithVersion`, a transaction that retries up to three times on UNIQUE conflicts, bumps the version, and publishes Created events once committed. `CreateVersion` inspects `ListFilesByPath` to branch from the latest revision, `ListLatestSessionFiles` collapses per-path head revisions, and `DeleteSessionFiles` walks the session list so every removal still signals the pubsub broker. Together the service keeps tool outputs versioned without leaking half-written rows.",
          "tags": [
            "filesystem",
            "history",
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/history/file.go",
              "sha256": "cc940356f6dfd073795c6f5d7e559467d4e5140da6a51c9b5ac43c097075e392"
            },
            {
              "path": "projects/Crush/internal/db/connect.go",
              "sha256": "fa45f5ef2272863b452837dccc253c7bb6ba75728474893a0e5345122fb1d08a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.7
        },
        {
          "id": "aspect-message-service",
          "sectionId": "section-sessions",
          "slug": "message-service",
          "name": "Message service marshals content parts, finish markers, and pubsub fan-out",
          "description": "`internal/message/message.go` auto-appends a `Finish` part for non-assistant roles, marshals heterogeneous parts through `marshallParts`, and persists them with sqlc before publishing Created events. `Update` rewrites the JSON blob, flips `FinishedAt` when the finish part appears, and broadcasts `pubsub.UpdatedEvent`, while `fromDBItem` uses `unmarshallParts` to rebuild reasoning, tool call, binary, and finish structs. `DeleteSessionMessages` iterates `List` so deletions raise individual events instead of bulk wipes.",
          "tags": [
            "llm",
            "pubsub",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.72
        },
        {
          "id": "aspect-session-subsession",
          "sectionId": "section-sessions",
          "slug": "session-subsession",
          "name": "Sub-sessions reuse tool call IDs for nested work streams",
          "description": "`internal/session/session.go` stores `ParentSessionID` as a nullable column and exposes helpers for nested runs: `CreateTaskSession` writes the tool call ID as the child session key, and `CreateTitleSession` prefixes `title-` for summariser jobs. Both paths publish Created events and return the hydrated struct, letting the TUI render nested conversations while analytics preserve lineage.",
          "tags": [
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-message-content-parts",
          "sectionId": "section-sessions",
          "slug": "message-content-parts",
          "name": "Message parts expose typed accessors for content, tools, and reasoning",
          "description": "`internal/message/content.go` models text, reasoning, image, binary, tool call, tool result, and finish parts, giving each a `String` helper and `isPart` marker so they survive encoding hops. Reasoning slices track signatures plus start/finish timestamps, `BinaryContent.String` adapts base64 output for OpenAI-compatible providers, and `ToolCall`/`ToolResult` capture IDs, payloads, and error flags. Convenience methods such as `ToolCalls`, `AppendReasoningContent`, and `ThinkingDuration` traverse the slice so agent and UI code avoid manual type switches.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/content.go",
              "sha256": "d11e1d2e1bb1414a8d366f81772788aacbfb89aa4cd4d84bc8027bd5e66ba9ca"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            },
            {
              "path": "projects/Crush/internal/llm/provider/provider.go",
              "sha256": "9a0a3ec225a1f250b6fbb391fccffac2c046d12d7d8d519e792714867ad5f8c6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "id": "aspect-sessions-title-task",
          "sectionId": "section-sessions",
          "slug": "sessions-title-task",
          "name": "Title sessions use deterministic IDs for summariser coordination",
          "description": "`CreateTitleSession` in `internal/session/session.go` prefixes `title-` to the parent session ID, seeds default copy, and publishes a Created event so the summariser can safely overwrite the placeholder once it finishes. The deterministic key lets `agent.Summarize` locate and update the record, keeping sidebar titles and cost accounting in sync.",
          "tags": [
            "llm",
            "pubsub",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-task-derived-sessions",
          "sectionId": "section-sessions",
          "slug": "task-derived-sessions",
          "name": "Task sessions branch per tool call so follow-ups stay isolated",
          "description": "`CreateTaskSession` stores the tool call identifier as the session primary key, links back to the parent via `ParentSessionID`, and publishes a Created event before returning. The fixed ID lets `agent.NewAgent` spawn follow-up runs that inherit history while isolating prompts, and downstream consumers can filter task threads via the lineage field.",
          "tags": [
            "pubsub",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-session-delete-events",
          "sectionId": "section-sessions",
          "slug": "session-delete-events",
          "name": "Session deletion emits pubsub payloads and metrics hooks",
          "description": "`Delete` in `internal/session/session.go` loads the session, deletes it through sqlc, publishes a Deleted event, and triggers `event.SessionDeleted()` so metrics and cleanup watchers fire in lockstep. Because message and history services expose `DeleteSession*` helpers that walk their own stores, clearing a session fans out a cascade of deletions instead of leaving orphaned artifacts.",
          "tags": [
            "observability",
            "pubsub",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            },
            {
              "path": "projects/Crush/internal/event/all.go",
              "sha256": "21dfe17370ea51186d7bbb1c90737f06644c6c065121f1aff19820c1db6154f0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "sectionId": "section-sessions",
          "id": "aspect-session-struct-fields",
          "slug": "session-struct-fields",
          "name": "Session struct tracks token counts, costs, and optional summaries",
          "description": "`internal/session/session.go`'s `Session` model keeps prompt/completion token totals, `SummaryMessageID`, cost, and timestamps alongside parent linkage. Services populate these fields from sqlc rows so analytics and the UI can surface spend, message counts, and summary references per session.",
          "tags": [
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "sectionId": "section-sessions",
          "id": "aspect-session-list-root",
          "slug": "session-list-root",
          "name": "ListSessions returns only root conversations ordered by recency",
          "description": "The generated `ListSessions` query in `internal/db/sessions.sql.go` filters `WHERE parent_session_id is NULL` and orders by `created_at DESC`, so the session picker shows primary chats with newest first while nested task/title sessions stay hidden from the top-level list.",
          "tags": [
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sessions.sql.go",
              "sha256": "c71122e613a50b71fae323c037868595f719162d4b9139cc08fad00495c0bbe0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "sectionId": "section-sessions",
          "id": "aspect-session-save-summary-null",
          "slug": "session-save-summary-null",
          "name": "Save wraps summary IDs in sql.NullString to clear on zero values",
          "description": "`Service.Save` converts `Session.SummaryMessageID` into a `sql.NullString`, marking it invalid when the string is empty so clearing a summary actually writes NULL in SQLite. The update path also persists token totals and cost before publishing the Updated event.",
          "tags": [
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        }
      ]
    },
    {
      "id": "section-tui",
      "slug": "tui",
      "title": "Terminal UI",
      "entries": [
        {
          "id": "aspect-completions-filtering",
          "sectionId": "section-tui",
          "slug": "completions-filtering",
          "name": "Incremental filtering avoids redundant recomputation",
          "description": "`internal/tui/components/completions/completions.go`'s `FilterCompletionsMsg` bail outs on identical queries, skips prefix refinements after a zero-result search, and batches commands to resize the list or close it when empty. It also preserves the original cursor column so `adjustPosition` can clamp the popup within the window during typing.",
          "tags": [
            "bubbletea",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/completions/completions.go",
              "sha256": "625114a176ed4f9d04e10834e3640491596190ac74bb64967aabcd2a2c1fb17c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-completions-keymap-popup",
          "sectionId": "section-tui",
          "slug": "completions-keymap-popup",
          "name": "Completions popup remaps navigation and insert shortcuts",
          "description": "`internal/tui/components/completions/completions.go` constructs a hidden filter list, rewiring Bubble Tea key bindings so Up/Down move the selection while dedicated insert bindings emit `SelectCompletionMsg` with `Insert: true`. `OpenCompletionsMsg` resets the query, recalculates width from the rendered items, and signals `CompletionsOpenedMsg` so the editor can adjust focus.",
          "tags": [
            "bubbletea",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/completions/completions.go",
              "sha256": "625114a176ed4f9d04e10834e3640491596190ac74bb64967aabcd2a2c1fb17c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-completions-popup",
          "sectionId": "section-tui",
          "slug": "completions-popup",
          "name": "Completion popup filters and repositions results without stealing focus",
          "description": "`internal/tui/components/completions/completions.go` wraps a filterable list that disables default list navigation in favor of custom key bindings, tracks window size to keep popups on-screen, and emits `SelectCompletionMsg` events with insert semantics. It handles reopen events, query filtering, and automatic height capping (10 rows) while preserving previous widths to avoid jitter, letting the editor request completions without losing focus. The editor component (`internal/tui/components/chat/editor/editor.go`) computes popup coordinates, filters using configured depth/limit from `Options.TUI.Completions`, and reopens the list via Tea messages so listings from `fsext.ListDirectory` stay in sync with on-disk files.",
          "tags": [
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/completions/completions.go",
              "sha256": "625114a176ed4f9d04e10834e3640491596190ac74bb64967aabcd2a2c1fb17c"
            },
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            },
            {
              "path": "projects/Crush/internal/fsext/ls.go",
              "sha256": "3c746b7a43017ba58e5fe0937f5c65f17a4c461d5c8485229d7120bd42d8af33"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.58
        },
        {
          "id": "aspect-lsp-status-panel",
          "sectionId": "section-tui",
          "slug": "lsp-status-panel",
          "name": "LSP status panel merges config ordering with live diagnostics",
          "description": "`internal/tui/components/lsp/lsp.go` pulls servers from `config.Get().LSP.Sorted()`, joins them with `app.GetLSPStates()`, and, when an LSP client is present, tallies protocol diagnostic severities to render coloured counts alongside each name. `RenderLSPBlock` adds truncation indicators and optional section headers, giving the sidebar a constantly updated view driven by `internal/app/lsp_events.go`.",
          "tags": [
            "bubbletea",
            "lsp",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/lsp/lsp.go",
              "sha256": "f6318049ee0c10348cb6266c2722c73d96be24790045d7f5572afe11d9308aef"
            },
            {
              "path": "projects/Crush/internal/app/lsp_events.go",
              "sha256": "e4d026ec6629076c7282ac8982c24c0737a1a000d078e0719143d5c4f8502800"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "id": "aspect-permissions-dialog",
          "sectionId": "section-tui",
          "slug": "permissions-dialog",
          "name": "Permission dialog renders diffs and multiple approval scopes",
          "description": "`internal/tui/components/dialogs/permissions/permissions.go` builds a viewport-backed dialog that pretty-prints tool requests, supports diff viewing for edit/write/multiedit tools with split/unified toggles, and exposes hotkeys for allow once, allow for session, or deny. It tracks viewport scroll offsets, caches rendered content, and emits `PermissionResponseMsg` events that close the dialog and drive the permission service. When the permission service broadcasts requests, the dialog renders the payload produced by `permission.Service` (including file paths normalised by `fsext`) and shows diff viewers for edit-oriented tools so users can compare pending writes before responding.",
          "tags": [
            "permissions",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            },
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/llm/tools/write.go",
              "sha256": "ec62899e546da178100218b187897ece03e78d53e320b76d587032867c4b1cbb"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.6
        },
        {
          "id": "aspect-tool-renderer-error",
          "sectionId": "section-tui",
          "slug": "tool-renderer-error",
          "name": "Tool renderer error styling",
          "description": "`baseRenderer.renderError` reuses `makeHeader` to colorize status icons, adds an `ERROR` badge padded with theme colors, truncates details via `ansi.Truncate`, and joins header/body output. Every renderer calls this path when `ToolResult.IsError`, keeping error surfaces uniform across tools.",
          "tags": [
            "tui",
            "tools",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43
        },
        {
          "id": "aspect-tool-renderer-registry",
          "sectionId": "section-tui",
          "slug": "tool-renderer-registry",
          "name": "Tool renderer registry",
          "description": "`internal/tui/components/chat/messages/renderer.go` initialises a `renderRegistry` at package load, registering factories for every built-in tool (bash, edit, diagnostics, agent, etc.) and falling back to `genericRenderer`. New tools plug in by adding a factory, keeping the chat view extensible without touching the rendering core.",
          "tags": [
            "tui",
            "tools",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-tui-orchestration",
          "sectionId": "section-tui",
          "slug": "tui-orchestration",
          "name": "Bubble Tea shell coordinates pages, dialogs, and permissions",
          "description": "`internal/tui/tui.go` defines the root Bubble Tea `appModel` that batches page initializers, filters high-frequency mouse motion, and keeps the status bar, dialogs, and completion overlays in sync with window sizing. It routes key- and mouse-driven messages to page models, toggles YOLO permission mode via `app.Permissions`, and fans out session/model switch commands through dialog components. The chat page implementation (`internal/tui/page/chat/chat.go`) drives onboarding: it inspects configuration state, surfaces first-run onboarding or CRUSH.md setup flows, and orchestrates sidebar, header, editor, and splash components while adapting compact layouts and focus modes based on terminal geometry. The root model brokers messages for the completions popup and permissions dialog, wiring their commands (`internal/tui/components/completions/completions.go`, `internal/tui/components/dialogs/permissions/permissions.go`) alongside the chat editor so overlay state stays synchronized with session activity.",
          "tags": [
            "architecture",
            "cli",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/tui.go",
              "sha256": "456b4b3a9b6e8d6da885ed176d7306895ec5628b8bc348386a114bd0f8ca8bc1"
            },
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            },
            {
              "path": "projects/Crush/internal/tui/components/completions/completions.go",
              "sha256": "625114a176ed4f9d04e10834e3640491596190ac74bb64967aabcd2a2c1fb17c"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.82
        },
        {
          "id": "aspect-toolcall-plain-preview",
          "slug": "toolcall-plain-preview",
          "name": "Plain tool previews escape control bytes and cap height",
          "description": "`renderPlainContent` normalizes CRLF, replaces tabs with spaces, escapes control characters via `ansiext.Escape`, and clamps output to `responseContextHeight` rows. Extra lines collapse into an ellipsis banner so textual tool replies stay readable inside the chat bubble.",
          "tags": [
            "tui",
            "rendering",
            "chat",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-toolcall-name-display",
          "slug": "toolcall-name-display",
          "name": "Tool prettifier maps internal IDs to friendly labels",
          "description": "`prettifyToolName` converts internal constants like `tools.WriteToolName` into human-friendly names (\"Write\", \"Glob\", \"Agent\"), ensuring tool call headers read naturally even when the backend ID is terse.",
          "tags": [
            "tui",
            "tools",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-editor-keymap",
          "slug": "editor-keymap",
          "name": "Chat editor keymap separates send, newline, and external editor actions",
          "description": "`DefaultEditorKeyMap` binds `/` to the attachment picker, `enter` to send, and `shift+enter`/`ctrl+j` to insert newlines, while `ctrl+o` opens the external editor. The helper integrates attachment deletion bindings so keyboard users can manage uploads without touching the mouse.",
          "tags": [
            "tui",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/keys.go",
              "sha256": "ad9696bc49321a786003585da66730d5e1f49c8a9d423a3518a6d8e9843ee84c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-attachments-keymap",
          "slug": "attachments-keymap",
          "name": "Attachment delete mode exposes ctrl+r shortcuts and escape cancel",
          "description": "`AttachmentsKeyMaps` reserves `ctrl+r` plus an index to delete a single attachment, `r` to remove all, and `esc`/`alt+esc` to exit deletion mode. By sharing the bindings through `EditorKeyMap.KeyBindings`, the chat composer keeps attachment management consistent across themes.",
          "tags": [
            "tui",
            "chat",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/keys.go",
              "sha256": "ad9696bc49321a786003585da66730d5e1f49c8a9d423a3518a6d8e9843ee84c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-filterable-list-keymap",
          "slug": "filterable-list-keymap",
          "name": "Filterable lists strip alphanumeric navigation to reserve typing",
          "description": "`filterableList.updateKeyMaps` removes single-character bindings from the underlying list keymap, disabling default letter shortcuts while keeping paging keys. That lets the text input capture free-form queries without forfeiting arrow, page, or half-page navigation.",
          "tags": [
            "tui",
            "bubbletea"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/filterable.go",
              "sha256": "693e2c3c3f9f54fa61f19e44d78f435010fb2709ec010b8280c04d6302a55d89"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-filterable-list-fuzzy",
          "slug": "filterable-list-fuzzy",
          "name": "Fuzzy filtering scores matches and preserves highlighting indexes",
          "description": "`filterableList.Filter` runs `fuzzy.Find` across cached items, sorts by score, and lets implementations that satisfy `HasMatchIndexes` receive matched rune offsets. It then repopulates the list while blurring previous focus targets so search feels instant.",
          "tags": [
            "tui",
            "bubbletea"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/filterable.go",
              "sha256": "693e2c3c3f9f54fa61f19e44d78f435010fb2709ec010b8280c04d6302a55d89"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.49,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-mcp-status-block",
          "slug": "mcp-status-block",
          "name": "MCP status block lists clients with live state icons and truncation",
          "description": "`RenderMCPBlock` pulls configured MCPs, joins them into `core.Status` rows coloured by `MCPState`, and appends an \"\u2026and N more\" indicator when `MaxItems` is exceeded. Tool counts surface for connected clients so users know which MCPs are ready inside the status pane. The data comes from `agent.setupEvents`, which feeds MCP state updates through the pubsub broker so the block reflects live tool counts.",
          "tags": [
            "tui",
            "mcp",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/mcp/mcp.go",
              "sha256": "cbd2c043bce0d93b66f8f4c1f3480ecf54cea0e8db5ad9a98e3646f39489425a"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-logo-gradient-renderer",
          "slug": "logo-gradient-renderer",
          "name": "Logo renderer stretches random glyphs and applies gradient ramps",
          "description": "`logo.Render` chooses a random letterform to stretch, paints the Crush wordmark with `styles.ApplyForegroundGrad`, and stitches diagonal fields around it. Compact mode renders mirror-diagonal fields for the sidebar, while wide mode truncates to the caller-provided width. Gradient stops come from the active theme (`styles/theme.go`), so switching palettes updates the wordmark without modifying the component.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/logo/logo.go",
              "sha256": "110cab492b552d95a5f0aa9a1b8b0e405eecf2995186ba8b907be72c01bfacef"
            },
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.41,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-status-help-bar",
          "slug": "status-help-bar",
          "name": "Status bar shows rotating help until temporary messages expire",
          "description": "`statusCmp.Update` listens for `util.InfoMsg`, displays the message with severity-specific colours, and schedules a `clearMessageCmd` tick using the TTL (default five seconds). When no info is active the component falls back to the Bubble Tea help view with the current key map. `status_test.go` covers TTL expiry and message stacking so transient notices clear without breaking the help view.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/core/status/status.go",
              "sha256": "0966c292cf3debfc2f89555c2cd6e550bce85bfa837d2e0947edabc0af4b0160"
            },
            {
              "path": "projects/Crush/internal/tui/components/core/status_test.go",
              "sha256": "a828e357a71c9ea7700c979117a83dae04debcebf8f27b83662809d2a4ccd355"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-toolcall-syntax-highlight",
          "slug": "toolcall-syntax-highlight",
          "name": "Code previews run syntax highlight with themed line numbers",
          "description": "`renderCodeContent` escapes code, feeds it through `highlight.SyntaxHighlight`, and joins each line with padded line numbers sized by `getDigits`. The renderer keeps background colors in sync with the active theme while trimming tall snippets with an ellipsis row. Highlighting delegates to `tui/highlight`, which maps theme colours onto Chroma styles so previews stay consistent with the active palette.",
          "tags": [
            "tui",
            "rendering",
            "chat",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            },
            {
              "path": "projects/Crush/internal/tui/highlight/highlight.go",
              "sha256": "b692625be3fcbdcb9eb1b90d2c1fe098ad8a4a3d2593cdb8b9830fac6f55c339"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-toolcall-error-banner",
          "slug": "toolcall-error-banner",
          "name": "Error responses get a red badge with trimmed text",
          "description": "`renderToolError` swaps the prompt text for a styled `ERROR` tag and truncates the failure string to the tool call width. The result keeps errant tool failures visible without overwhelming the transcript. `messageCmp.renderAssistantMessage` pairs the banner with the tool call metadata so the chat bubble reflects permission failures and runtime errors consistently.",
          "tags": [
            "tui",
            "tools",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            },
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1a8dc773bb77eb8aad66ec189c3a8b0afe2e7a9dbc5b9c2431639c17e24dfe68"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45,
          "sectionId": "section-tui"
        },
        {
          "id": "aspect-tool-renderer-param-builder",
          "sectionId": "section-tui",
          "slug": "tool-renderer-param-builder",
          "name": "Tool renderer parameter builder",
          "description": "`paramBuilder` offers fluent `addMain`, `addKeyValue`, and `addFlag` helpers whose `build` output feeds `baseRenderer.renderWithParams`. Specific renderers (e.g., fetch, glob) use it to normalize header argument lists, ensuring status lines align even when tool payloads differ. Path-related parameters are run through `fsext.PrettyPath` so the status bar uses the same tilde-shortening as filesystem tools.",
          "tags": [
            "tui",
            "tools",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.41
        }
      ]
    },
    {
      "id": "section-tui-chat",
      "slug": "tui-chat",
      "title": "Chat Experience",
      "entries": [
        {
          "id": "aspect-chat-messages-thinking",
          "sectionId": "section-tui-chat",
          "slug": "chat-messages-thinking",
          "name": "Chat message reasoning viewport",
          "description": "`renderThinkingContent` splits `ReasoningContent.Thinking`, styles lines with the theme's subtle palette, clamps height via `util.Clamp`, and feeds the text into a `viewport.Model` while `core.Status` renders a \"Thought for\" footer when durations are known. Animations switch label text to reflect thinking state, giving live feedback on slow responses.",
          "tags": [
            "tui",
            "llm",
            "rendering",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1b00ccb6c73be0dfbe6860641a00bcad2596a1b98306da4565be30cbf02d5eac"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-chat-message-child-session-sync",
          "slug": "chat-message-child-session-sync",
          "name": "Child sessions stream nested tool calls back into the parent thread",
          "description": "`messageListCmp.handleChildSession` inspects agent tool sessions, creating or updating nested `ToolCallCmp`s for each `ToolCall` and `ToolResult` emitted by the child run. Nested items inherit cancellation and spinner state, keeping multi-hop tool executions visible without leaving the main conversation.",
          "tags": [
            "tui",
            "chat",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52,
          "sectionId": "section-tui-chat"
        },
        {
          "id": "aspect-chat-message-session-loader",
          "slug": "chat-message-session-loader",
          "name": "Session loader rebuilds UI items from stored messages and tool history",
          "description": "When `SetSession` runs, it pulls the full message list via `app.Messages.List`, builds a tool-result map, and converts each record into `MessageCmp` or `ToolCallCmp` instances. Assistant turns that ended the conversation generate section markers, so restored sessions match the live streaming layout.",
          "tags": [
            "tui",
            "chat",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58,
          "sectionId": "section-tui-chat"
        },
        {
          "id": "aspect-chat-layout",
          "sectionId": "section-tui-chat",
          "slug": "chat-layout",
          "name": "Chat page adapts layout for onboarding, compact mode, and focus",
          "description": "`internal/tui/page/chat/chat.go` inspects configuration on init to decide between onboarding splash, project-init prompts, or ready-to-chat editor focus, and switches between chat/editor panes based on mouse targets. It enforces compact mode thresholds (width/height), rebases mouse coordinates when collapsed, and wires keyboard enhancements to child components. The page coordinates sidebar, header, chat stream, and editor while managing cancel timers and completion overlays, giving Crush responsive ergonomics across terminal sizes. Keyboard bindings from `chat/keys.go` keep editor/session shortcuts aligned with the layout decisions.",
          "tags": [
            "onboarding",
            "rendering",
            "session",
            "tui",
            "chat",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            },
            {
              "path": "projects/Crush/internal/tui/page/chat/keys.go",
              "sha256": "9bd976d67143f3ec422527224f896bcafe0bcba6bff7fc0fedb9fbf0cbf5fea2"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.7
        },
        {
          "id": "aspect-chat-message-permission-updates",
          "slug": "chat-message-permission-updates",
          "name": "Permission broker events flip tool call badges inline",
          "description": "When `permission.PermissionNotification` arrives, `handlePermissionRequest` locates the matching `ToolCallCmp`, marks it as requested, and toggles the granted flag before updating the list item. The message list stays in sync with backend approvals, so granting or denying from the dialog instantly refreshes the chat bubble state. The notifications originate from `permission.Service` (`Publish` and `Grant`/`Deny`), linking the UI state directly to server decisions.",
          "tags": [
            "tui",
            "chat",
            "permissions",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            },
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5,
          "sectionId": "section-tui-chat"
        },
        {
          "id": "aspect-chat-message-assistant-refresh",
          "slug": "chat-message-assistant-refresh",
          "name": "Assistant updates reuse existing bubbles and append finish dividers",
          "description": "`handleUpdateAssistantMessage` locates the message via `findAssistantMessageAndToolCalls`, refreshes content when `shouldShowAssistantMessage` is true, and inserts a `messages.NewAssistantSection` when the finish part reports `EndTurn`. Empty assistant messages with pure tool calls are removed to keep the log lean. The helper leans on `message.Message` finish parts, so streaming updates from the agent end up in the same bubble without creating duplicate entries.",
          "tags": [
            "tui",
            "chat",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            },
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "f3aecea3d4e61aa6277528bed4b62c40f05beb6e8e2cf007fe77eda453bd8b67"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.53,
          "sectionId": "section-tui-chat"
        },
        {
          "id": "aspect-chat-message-nested-history",
          "slug": "chat-message-nested-history",
          "name": "Nested agent runs inline their tool calls after replaying child sessions",
          "description": "`convertAssistantMessage` detects agent tool calls, fetches the child session from `app.Messages`, and constructs nested `ToolCallCmp`s marked as nested. The parent message sets `SetNestedToolCalls`, allowing the tool tree to expand in the chat transcript without manual reconciliation. Nested sessions originate from the agent tool (`agent-tool.go`), so the renderer can pull their transcripts through the session service and display them inline.",
          "tags": [
            "tui",
            "chat",
            "tools",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent-tool.go",
              "sha256": "9c7f7928ab2594c21cd3b7ab3febbda661d19ce28cdd94a970b9bfbd840d9600"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56,
          "sectionId": "section-tui-chat"
        }
      ]
    },
    {
      "id": "section-chat-input",
      "slug": "chat-input",
      "title": "Chat Input",
      "entries": [
        {
          "id": "aspect-chat-editor-attachments",
          "sectionId": "section-chat-input",
          "slug": "chat-editor-attachments",
          "name": "Chat editor attachment intake",
          "description": "`editor.Update` handles `filepicker.FilePickedMsg` by rejecting oversized files via `filepicker.IsFileTooBig`, sniffing MIME types with `http.DetectContentType`, and appending `message.Attachment` entries until `maxAttachments` (5). `attachmentsContent` then renders truncated filenames with `styles.DocumentIcon`, giving the composer inline previews of queued uploads.",
          "tags": [
            "tui",
            "filesystem",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-chat-editor-delete-mode",
          "sectionId": "section-chat-input",
          "slug": "chat-editor-delete-mode",
          "name": "Chat editor attachment delete mode",
          "description": "`DeleteKeyMaps` binds `ctrl+r` to toggle delete mode, `r` to clear all attachments, and `esc` to exit; while armed, `Update` interprets digit keys to drop indexed items using `slices.Delete`. `attachmentsContent` prefixes numbers when `deleteMode` is true, delivering keyboard-only pruning for uploads without leaving the chat buffer.",
          "tags": [
            "tui",
            "cli",
            "filesystem",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "id": "aspect-chat-editor-external",
          "sectionId": "section-chat-input",
          "slug": "chat-editor-external",
          "name": "Chat editor external editor handoff",
          "description": "`internal/tui/components/chat/editor/editor.go`'s `openEditor` resolves `$EDITOR` (defaulting to Notepad on Windows or `nvim` elsewhere), writes the textarea content to a temp `.md`, launches it via `tea.ExecProcess`, and on return trims the file into an `OpenEditorMsg`. Errors route through `util.ReportError`, so users can round-trip prompts in their editor without losing Bubble Tea focus. The helper writes prompts to a temp `.md` in the OS cache directory, letting filesystem watchers pick up changes before reinserting the edited text.",
          "tags": [
            "tui",
            "cli",
            "chat",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "id": "aspect-chat-editor-placeholder",
          "sectionId": "section-chat-input",
          "slug": "chat-editor-placeholder",
          "name": "Chat editor dynamic placeholders",
          "description": "`randomizePlaceholders` samples from themed ready/working phrase arrays, and `View` swaps the textarea placeholder to the working variant when `CoderAgent.IsBusy()` or to `\"Yolo mode!\"` when `Permissions.SkipRequests()` is true. The editor therefore mirrors agent load and runtime permission posture without extra UI widgets.",
          "tags": [
            "tui",
            "rendering",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43
        },
        {
          "id": "aspect-chat-editor-prompt-icons",
          "sectionId": "section-chat-input",
          "slug": "chat-editor-prompt-icons",
          "name": "Chat editor YOLO prompt glyphs",
          "description": "`setEditorPrompt` swaps the textarea prompt between `normalPromptFunc` and `yoloPromptFunc`, the latter emitting themed YOLO glyphs per line. The prompt funcs inspect focus and line number to choose icons, so enabling dangerous mode immediately re-skins the composer while interactive mode keeps the standard `> / :::` markers.",
          "tags": [
            "tui",
            "permissions",
            "rendering",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-chat-editor-quit-flow",
          "sectionId": "section-chat-input",
          "slug": "chat-editor-quit-flow",
          "name": "Chat editor quit command dispatch",
          "description": "`send` trims the textarea value and intercepts literal `exit`/`quit`, clearing the buffer and dispatching `dialogs.OpenDialogMsg` with `quit.NewQuitDialog()`. It also resets attachment state and rerolls placeholders on every successful send, keeping the composer fresh after command-driven exits.",
          "tags": [
            "tui",
            "cli",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-chat-message-prompt-queue-layout",
          "slug": "chat-message-prompt-queue-layout",
          "name": "Prompt queue pill shrinks the transcript and reflects agent backlog",
          "description": "Each update cycle compares `CoderAgent.QueuedPrompts` with the cached count; when the number changes the view recomputes layout height and appends the `queuePill` below the messages. The adjustment reserves four rows for the pill so pending prompts are visible without clipping the chat log.",
          "tags": [
            "tui",
            "chat",
            "agent"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45,
          "sectionId": "section-chat-input"
        },
        {
          "id": "aspect-chat-queue-pill",
          "sectionId": "section-chat-input",
          "slug": "chat-queue-pill",
          "name": "Queued prompt pill",
          "description": "`queuePill` constructs a gradient of `\u25b6` glyphs via `styles.ForegroundGrad`, truncates it to the queued count, and wraps the string in a rounded lipgloss border coloured with the theme. Counts of zero short-circuit to an empty string, yielding a lightweight visual indicator when prompts are waiting. The pill is driven by `agent.QueuedPrompts`, so it only appears when the llm service has follow-up work staged.",
          "tags": [
            "tui",
            "rendering",
            "chat",
            "agent"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/queue.go",
              "sha256": "a52e64ba6056ea0eba0f135cefb0080a4bc888c607208cbefd02047115d5611b"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.39
        }
      ]
    },
    {
      "id": "section-chat-output",
      "slug": "chat-output",
      "title": "Chat Output",
      "entries": [
        {
          "id": "aspect-chat-header-context-meter",
          "slug": "chat-header-context-meter",
          "name": "Token percentage indicator tracks context window consumption",
          "description": "Using `config.Get()`, the header pulls the active coder model and computes `(prompt + completion tokens) / context window`, rendering the integer percentage beside diagnostics. This surfaces when long chats approach the model limit without opening a separate stats panel. The percentages are based on `Session.PromptTokens`/`CompletionTokens`, which the agent updates via `trackUsage`, keeping the visual in sync with actual usage.",
          "tags": [
            "tui",
            "chat",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/header/header.go",
              "sha256": "8fb00a9c2bbf3c117d62dfe43b6f20d0133bbbbd1a7060e5f2bdabcf949c2d4a"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48,
          "sectionId": "section-chat-output"
        },
        {
          "id": "aspect-chat-header-details-toggle",
          "slug": "chat-header-details-toggle",
          "name": "Details toggle advertises `ctrl+d` and flips the metadata slab",
          "description": "`SetDetailsOpen` stores the state that drives the header\u2019s `ctrl+d` affordance, letting the view swap between \u201copen\u201d and \u201cclose\u201d hints. The same flag controls whether extra session metadata is rendered, keeping the banner concise by default.",
          "tags": [
            "tui",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/header/header.go",
              "sha256": "8fb00a9c2bbf3c117d62dfe43b6f20d0133bbbbd1a7060e5f2bdabcf949c2d4a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44,
          "sectionId": "section-chat-output"
        },
        {
          "id": "aspect-chat-header-diagnostics-bar",
          "slug": "chat-header-diagnostics-bar",
          "name": "Header aggregates LSP diagnostics into the banner metadata",
          "description": "`header.details` iterates `lspClients.Seq()` collecting error-level diagnostics and renders an error badge alongside provider/model metadata. The badge gives at-a-glance visibility into outstanding LSP issues directly from the chat header.",
          "tags": [
            "tui",
            "chat",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/header/header.go",
              "sha256": "8fb00a9c2bbf3c117d62dfe43b6f20d0133bbbbd1a7060e5f2bdabcf949c2d4a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5,
          "sectionId": "section-chat-output"
        },
        {
          "id": "aspect-chat-message-clipboard-copy",
          "slug": "chat-message-clipboard-copy",
          "name": "Clipboard helper mirrors selections to OSC 52 and system clipboards",
          "description": "`messageListCmp.CopySelectedText` reads highlighted text via `GetSelectedText`, pipes it to both `tea.SetClipboard` and `clipboard.WriteAll`, and emits `util.ReportInfo` while optionally clearing the selection. The helper works after keyboard or mouse selection flows so copying assistant output leaves no stray highlights in the chat view.",
          "tags": [
            "tui",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46,
          "sectionId": "section-chat-output"
        },
        {
          "id": "aspect-chat-message-mouse-selection",
          "slug": "chat-message-mouse-selection",
          "name": "Mouse selection cycles single, word, and paragraph grabs",
          "description": "`messageListCmp.handleMouseClick` tracks click timing and coordinates, calling `StartSelection`, `SelectWord`, or `SelectParagraph` as `clickCount` reaches 1, 2, or 3 before resetting. The logic relies on a 500ms `doubleClickThreshold` and a two-pixel tolerance so drag gestures still highlight chat text without spurious multi-clicks.",
          "tags": [
            "tui",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47,
          "sectionId": "section-chat-output"
        },
        {
          "id": "aspect-chat-messages-assistant-footer",
          "sectionId": "section-chat-output",
          "slug": "chat-messages-assistant-footer",
          "name": "Assistant footer model badges",
          "description": "`assistantSectionModel.View` looks up model metadata via `config.Get().GetModel`, computes the latency since the last user message, and feeds both into `core.Section` with `styles.ModelIcon`. Even if a model disappears from config, it falls back to \"Unknown Model\", keeping footer context attached to each assistant reply.",
          "tags": [
            "tui",
            "llm",
            "rendering",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1b00ccb6c73be0dfbe6860641a00bcad2596a1b98306da4565be30cbf02d5eac"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "id": "aspect-chat-messages-clipboard",
          "sectionId": "section-chat-output",
          "slug": "chat-messages-clipboard",
          "name": "Chat message clipboard shortcuts",
          "description": "`messageCmp.Update` matches `CopyKey` (c/y) to batch `tea.SetClipboard`, `clipboard.WriteAll`, and `util.ReportInfo`, copying the rendered message text while leaving focus intact. The shortcut applies to both user and assistant messages, making it trivial to export replies without breaking streaming updates.",
          "tags": [
            "tui",
            "cli",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1b00ccb6c73be0dfbe6860641a00bcad2596a1b98306da4565be30cbf02d5eac"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-chat-messages-markdown",
          "sectionId": "section-chat-output",
          "slug": "chat-messages-markdown",
          "name": "Chat markdown renderer selection",
          "description": "`messageCmp.toMarkdown` acquires a width-aware renderer from `styles.GetMarkdownRenderer`, renders the message body, and trims trailing newlines so assistant output respects theme spacing. Combined with the style-aware borders in `renderAssistantMessage`, markdown replies stay legible regardless of terminal width. The renderer delegates to `styles/markdown.go`, which maps theme colours and blockquotes so chat replies inherit the active palette.",
          "tags": [
            "tui",
            "rendering",
            "chat",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1b00ccb6c73be0dfbe6860641a00bcad2596a1b98306da4565be30cbf02d5eac"
            },
            {
              "path": "projects/Crush/internal/tui/styles/markdown.go",
              "sha256": "dadadddb480f1597739be958ee5a5c9c1af56af27917fd6fd95cda5574420e2b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43
        },
        {
          "id": "aspect-chat-messages-spinner-guard",
          "sectionId": "section-chat-output",
          "slug": "chat-messages-spinner-guard",
          "name": "Assistant spinner guard logic",
          "description": "`shouldSpin` only animates assistant bubbles when they are unfinished, textless, and lack tool calls, preventing the spinner from obscuring streaming content. `Update` reevaluates the flag on every `anim.StepMsg`, halting animations as soon as content or tool output arrives.",
          "tags": [
            "tui",
            "llm",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1b00ccb6c73be0dfbe6860641a00bcad2596a1b98306da4565be30cbf02d5eac"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-chat-messages-user-attachments",
          "sectionId": "section-chat-output",
          "slug": "chat-messages-user-attachments",
          "name": "Chat message attachment badges",
          "description": "`renderUserMessage` iterates `Message.BinaryContent()`, truncates filenames with `ansi.Truncate`, and renders lipgloss chips using theme backgrounds so uploaded files appear beneath the prompt. Attachments only render when present, keeping the timeline compact while surfacing paths the agent will consume.",
          "tags": [
            "tui",
            "filesystem",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1b00ccb6c73be0dfbe6860641a00bcad2596a1b98306da4565be30cbf02d5eac"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "id": "aspect-chat-sidebar-compact-layout",
          "sectionId": "section-chat-output",
          "slug": "chat-sidebar-compact-layout",
          "name": "Sidebar compact layout switching",
          "description": "`sidebar.View` adapts to compact mode by changing padding, swapping between large and small logos based on `LogoHeightBreakpoint`, collapsing title/cwd styling, and switching to a horizontal section renderer when width exceeds height. This keeps navigation usable on small or wide terminals alike.",
          "tags": [
            "tui",
            "rendering",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/sidebar/sidebar.go",
              "sha256": "09a1f8f8f7b9483ff982f260b92f63d70c77b49b97b63350e6235f9f79b6d801"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-chat-sidebar-history-diff",
          "sectionId": "section-chat-output",
          "slug": "chat-sidebar-history-diff",
          "name": "Sidebar history diff counters",
          "description": "`sidebar.handleFileHistoryEvent` stores `history.File` versions in a concurrent map, normalizes content with `fsext.ToUnixLineEndings`, and calls `diff.GenerateDiff` to compute additions/deletions before updating cached `SessionFile` stats. The sidebar then surfaces per-file churn without re-querying SQLite. Diff stats rely on `internal/diff/diff.go`, which provides the truncation and hunk formatting used in the sidebar counters.",
          "tags": [
            "tui",
            "history",
            "filesystem",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/sidebar/sidebar.go",
              "sha256": "09a1f8f8f7b9483ff982f260b92f63d70c77b49b97b63350e6235f9f79b6d801"
            },
            {
              "path": "projects/Crush/internal/diff/diff.go",
              "sha256": "2ad91d3ef1ac9fdb6f124ec25c94532ad9cffd64de0d3f8cb1ddbf2681f39aea"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.49
        }
      ]
    },
    {
      "id": "section-chat-automation",
      "slug": "chat-automation",
      "title": "Chat Automation",
      "entries": [
        {
          "id": "aspect-chat-message-toolcall-options",
          "slug": "chat-message-toolcall-options",
          "name": "Tool call options capture cached results and cancellation metadata",
          "description": "`buildToolCallOptions` assembles decorators like `WithToolCallResult`, `WithToolCallCancelled`, and the permission flags so replayed tool calls remember cached outputs, cancellation state, and whether a dialog already asked the user. Feeding these options into `NewToolCallCmp` keeps the automation layer in sync when transcripts reload or the agent retries.",
          "tags": [
            "tui",
            "chat",
            "permissions",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.49,
          "sectionId": "section-chat-automation"
        },
        {
          "id": "aspect-chat-message-toolcall-refresh",
          "slug": "chat-message-toolcall-refresh",
          "name": "Tool call rows update in place with results and cancellation state",
          "description": "`updateToolCalls` iterates assistant `ToolCall`s, calling `updateOrAddToolCall` to mutate existing components or append new ones. The helper sets cancellation when the finish part ends with `FinishReasonCanceled`, ensuring the Bubble Tea list mirrors real-time tool progress.",
          "tags": [
            "tui",
            "chat",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/chat.go",
              "sha256": "f178b3153ab22a78a8f4176e6f60bb8335b63abd516e49ed8ded27a6a7a5ad2d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.51,
          "sectionId": "section-chat-automation"
        },
        {
          "id": "aspect-chat-toolcall-copy",
          "sectionId": "section-chat-automation",
          "slug": "chat-toolcall-copy",
          "name": "Tool call copy formatting",
          "description": "`toolCallCmp.copyTool` formats a Markdown summary via `formatToolForCopy`, pushes it to the system clipboard with both `tea.SetClipboard` and `clipboard.WriteAll`, and surfaces success through `util.ReportInfo`. Parameters and results are reformatted per-tool (e.g., `tools.GrepParams`) so shared snippets stay informative. The resulting status toast flows through the status help bar, giving immediate feedback when clipboard writes succeed.",
          "tags": [
            "tui",
            "tools",
            "cli",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/tool.go",
              "sha256": "350907d4270a7987a1da68ee13ddd6e28244bca964e3c877325143c074d80430"
            },
            {
              "path": "projects/Crush/internal/tui/components/core/status/status.go",
              "sha256": "0966c292cf3debfc2f89555c2cd6e550bce85bfa837d2e0947edabc0af4b0160"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-chat-toolcall-nesting",
          "sectionId": "section-chat-automation",
          "slug": "chat-toolcall-nesting",
          "name": "Nested tool call composition",
          "description": "`NewToolCallCmp` accepts options like `WithToolCallNested` and `WithToolCallNestedCalls`, storing child `ToolCallCmp`s and switching to slimmer animations for nested invocations. `Update` recursively feeds messages to children, preserving structured tool hierarchies when the agent invokes tools within tools.",
          "tags": [
            "tui",
            "tools",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/tool.go",
              "sha256": "350907d4270a7987a1da68ee13ddd6e28244bca964e3c877325143c074d80430"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "id": "aspect-chat-toolcall-permissions",
          "sectionId": "section-chat-automation",
          "slug": "chat-toolcall-permissions",
          "name": "Tool call permission flags",
          "description": "`toolCallCmp` tracks `permissionRequested` and `permissionGranted` booleans via constructor options (`WithToolPermissionRequested/Granted`) and exposes setters that emit UI-state changes when broker events arrive. Renderers inspect these flags to flip icons, aligning tool visuals with the permission service's decisions.",
          "tags": [
            "tui",
            "permissions",
            "tools",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/tool.go",
              "sha256": "350907d4270a7987a1da68ee13ddd6e28244bca964e3c877325143c074d80430"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "id": "aspect-chat-toolcall-spinner",
          "sectionId": "section-chat-automation",
          "slug": "chat-toolcall-spinner",
          "name": "Tool call spinner orchestration",
          "description": "`toolCallCmp.Init` seeds an `anim.Anim` sized differently for nested calls, marks `spinning` based on `shouldSpin`, and `Update` fans `anim.StepMsg` through nested tool calls so each pending tool gets an independent progress pulse. This keeps long-running tool chains visually differentiated in the thread. The component reuses cached frames from `anim.Anim`, keeping spinner gradients aligned with the active theme across nested tool calls.",
          "tags": [
            "tui",
            "tools",
            "rendering",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/tool.go",
              "sha256": "350907d4270a7987a1da68ee13ddd6e28244bca964e3c877325143c074d80430"
            },
            {
              "path": "projects/Crush/internal/tui/components/anim/anim.go",
              "sha256": "5ba7d7fefab24e4affbeacba748ffc8ed7f2d134d2a3f8b80b9dcd51cb07cdbc"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        }
      ]
    },
    {
      "id": "section-tui-commands",
      "slug": "tui-commands",
      "title": "Command Palette",
      "entries": [
        {
          "id": "aspect-commands-arguments-dialog",
          "sectionId": "section-tui-commands",
          "slug": "commands-arguments-dialog",
          "name": "Command arguments dialog substitutes placeholders and keeps focus cycling",
          "description": "`internal/tui/components/dialogs/commands/arguments.go` builds one `textinput.Model` per `$ARG`, rotates focus with the arguments keymap, and replaces placeholders in the markdown before emitting `CommandRunCustomMsg`. `ctrl+v` paste, labelled help, and sequential confirmation make user-defined commands ergonomic from the keyboard.",
          "tags": [
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/arguments.go",
              "sha256": "c6898a996902f172686c4e01bdaf8f5e3097da8ef83bf0b333da06edd950cc95"
            },
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-commands-custom-loader",
          "sectionId": "section-tui-commands",
          "slug": "commands-custom-loader",
          "name": "Custom command loader scans XDG, home, and project directories",
          "description": "`internal/tui/components/dialogs/commands/loader.go` ensures the commands directories exist, walks markdown files under user/project roots, and builds IDs with `user:`/`project:` prefixes. `createCommandHandler` inspects the template for `$NAME` tokens to decide between spawning the argument dialog or dispatching a `CommandRunCustomMsg`.",
          "tags": [
            "tui",
            "filesystem",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/loader.go",
              "sha256": "fdf7a4dfd64d44838565b9626b2d643280cc0f477cc6925645d318939781559b"
            },
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43
        },
        {
          "id": "aspect-commands-dialog",
          "sectionId": "section-tui-commands",
          "slug": "commands-dialog",
          "name": "Command palette toggles system/user lists and emits typed handlers",
          "description": "`internal/tui/components/dialogs/commands/commands.go` initialises a filterable list with Tab-based switching between system and user commands, renders a radio header to show the active bucket, and on selection batches a close command followed by the command handler (session switch, model dialog, YOLO toggle, etc.).",
          "tags": [
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            },
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-commands-keybindings",
          "sectionId": "section-tui-commands",
          "slug": "commands-keybindings",
          "name": "Command palette keymaps drive selection, tabbing, and cancel flows",
          "description": "`internal/tui/components/dialogs/commands/keys.go` defines `CommandsDialogKeyMap` and `ArgumentsDialogKeyMap`, wiring enter/tab/navigation/paste bindings with help metadata so the inline help component renders both short and full hints.",
          "tags": [
            "tui",
            "cli",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/keys.go",
              "sha256": "d327edca288e295c077d9d9342cf19c8e7a5c10920d0548560b16144b4e4c6b5"
            },
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.38
        },
        {
          "id": "aspect-commands-filter-shortcuts",
          "slug": "commands-filter-shortcuts",
          "name": "SetCommandType rebuilds list items with IDs and shortcut badges",
          "description": "`SetCommandType` rebuilds the `FilterableList` using `list.NewCompletionItem`, adds `WithCompletionID` for selection persistence, and `WithCompletionShortcut` so accelerator hints show up alongside titles. Switching between system and user lists preserves the active selection when possible.",
          "tags": [
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48,
          "sectionId": "section-tui-commands"
        },
        {
          "id": "aspect-commands-system-handlers",
          "slug": "commands-system-handlers",
          "name": "System command handlers emit Bubble Tea messages for palette actions",
          "description": "`defaultCommands` attaches handlers that return typed messages such as `SwitchSessionsMsg`, `OpenReasoningDialogMsg`, `ToggleYoloModeMsg`, or `CompactMsg`. When the user confirms, the dialog closes and the handler message is sent to the program, plugging the palette into the rest of the chat workflow.",
          "tags": [
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46,
          "sectionId": "section-tui-commands"
        },
        {
          "id": "aspect-commands-user-loader",
          "slug": "commands-user-loader",
          "name": "User commands combine disk-backed templates with palette handlers",
          "description": "`commands.Init` caches `LoadCustomCommands()` results so Tab toggles into the user bucket instantly, and command handlers either show the argument dialog or dispatch the markdown content back to chat. The loader watches project data directories, letting repositories ship scoped palettes without recompiling.",
          "tags": [
            "tui",
            "filesystem",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/loader.go",
              "sha256": "fdf7a4dfd64d44838565b9626b2d643280cc0f477cc6925645d318939781559b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47,
          "sectionId": "section-tui-commands"
        },
        {
          "id": "aspect-commands-cursor-alignment",
          "slug": "commands-cursor-alignment",
          "name": "Command dialog adjusts the shared cursor to match dialog borders",
          "description": "`commandDialogCmp.Cursor` grabs the underlying list cursor, offsets it by the dialog\u2019s position, and returns it so Bubble Tea highlights the correct row even as the dialog recenters or resizes.",
          "tags": [
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42,
          "sectionId": "section-tui-commands"
        },
        {
          "sectionId": "section-tui-commands",
          "id": "aspect-commands-dialog-responsive-sizing",
          "slug": "commands-dialog-responsive-sizing",
          "name": "Command palette resizes list height with window and item count",
          "description": "On `tea.WindowSizeMsg` the dialog recomputes `commandList.SetSize` using `listWidth()` and `listHeight()`, where the latter caps the list at half the terminal height but shrinks when only a few items exist. The behaviour keeps the palette compact on small terminals while avoiding excessive whitespace when dozens of commands are available.",
          "tags": [
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "sectionId": "section-tui-commands",
          "id": "aspect-commands-dialog-radio",
          "slug": "commands-dialog-radio",
          "name": "System/User radio header reflects available buckets and muted theme",
          "description": "`commandTypeRadio` renders a muted \"\u25c9 System \u25cb User\" indicator, swapping glyphs when the active list switches, and collapses to a single title when no user commands exist. The styling ties into the current theme so palette headers stay consistent with the rest of the TUI branding.",
          "tags": [
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.4
        },
        {
          "sectionId": "section-tui-commands",
          "id": "aspect-commands-dialog-contextual-session",
          "slug": "commands-dialog-contextual-session",
          "name": "Session-aware commands appear only when a chat is active",
          "description": "`defaultCommands` appends Summarize Session, Toggle Sidebar, File Picker, and other chat-scoped actions only when `sessionID` is set. That prevents empty palettes in the welcome screen and keeps the command list focused on actions that make sense in the current context.",
          "tags": [
            "tui",
            "cli",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "sectionId": "section-tui-commands",
          "id": "aspect-commands-dialog-reasoning-toggles",
          "slug": "commands-dialog-reasoning-toggles",
          "name": "Reasoning commands depend on provider capabilities",
          "description": "The palette inspects the coder agent configuration: Anthropic models with `CanReason` gain an Enable/Disable Thinking entry, while OpenAI models exposing `HasReasoningEffort` get a \"Select Reasoning Effort\" command that opens the dedicated dialog. Capability checks guard the list so users only see reasoning controls supported by the active provider.",
          "tags": [
            "tui",
            "cli",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            },
            {
              "path": "projects/Crush/internal/config/config.go",
              "sha256": "deb2d8e112ff7cab7783428cc2af45b751908841e4ee9d5b4620953544e37294"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "sectionId": "section-tui-commands",
          "id": "aspect-commands-dialog-editor-picker",
          "slug": "commands-dialog-editor-picker",
          "name": "File picker and external editor entries gate on model and environment",
          "description": "`defaultCommands` only shows the File Picker command when the selected model `SupportsImages`, and exposes an Open External Editor option when `$EDITOR` is set. The palette therefore avoids dead commands while surfacing richer tools for image-capable models and users who configured an external editor.",
          "tags": [
            "tui",
            "cli",
            "config"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        }
      ]
    },
    {
      "id": "section-tui-onboarding",
      "slug": "tui-onboarding",
      "title": "TUI Onboarding",
      "entries": [
        {
          "id": "aspect-onboarding-model-picker",
          "slug": "onboarding-model-picker",
          "name": "Model list groups providers and highlights configured entries",
          "description": "`ModelListComponent` builds grouped filterable lists using provider metadata, adds a \u201cConfigured\u201d badge for providers present in `cfg.Providers`, and remembers the selected item ID so currently preferred models stay pre-selected. Filtering runs through the shared list exp package for fuzzy matching.",
          "tags": [
            "tui",
            "onboarding"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/models/list.go",
              "sha256": "6e56d30370cad2714cf582d6b3b13161331db336cab8fea60af29d28f64f2acc"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.54,
          "sectionId": "section-tui-onboarding"
        },
        {
          "id": "aspect-onboarding-api-key-flow",
          "slug": "onboarding-api-key-flow",
          "name": "Splash transitions from model selection into API key capture",
          "description": "When a chosen provider lacks credentials, `splashCmp` flips `needsAPIKey`, configures `APIKeyInput` with the provider name, and waits for `SubmitAPIKeyMsg`. Verified keys are persisted via `cfg.SetProviderAPIKey` before onboarding closes.",
          "tags": [
            "tui",
            "onboarding",
            "config"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/splash/splash.go",
              "sha256": "e8fa618114e161bc9ff6bab4ba60577376cdbdc739a07923a4afa582f8cbfdf5"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55,
          "sectionId": "section-tui-onboarding"
        },
        {
          "id": "aspect-onboarding-project-init",
          "slug": "onboarding-project-init",
          "name": "Project initialization prompt primes CRUSH.md generation",
          "description": "When `needsProjectInit` is true, the splash renders selectable \u201cYep/Nope\u201d buttons and, on confirmation, calls `initializeProject` to mark the project initialized and queue a `chat.SendMsg` with `prompt.Initialize`. This lets new workspaces bootstrap context without leaving the splash.",
          "tags": [
            "tui",
            "onboarding",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/splash/splash.go",
              "sha256": "e8fa618114e161bc9ff6bab4ba60577376cdbdc739a07923a4afa582f8cbfdf5"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48,
          "sectionId": "section-tui-onboarding"
        },
        {
          "id": "aspect-onboarding-keymap",
          "slug": "onboarding-keymap",
          "name": "Splash keymap offers yes/no and navigation shortcuts",
          "description": "`DefaultKeyMap` binds `y`/`n` alongside `tab` or arrow keys to switch focus, with `enter` confirming and `esc` backing out of API key entry. The mapping keeps onboarding operable entirely from the keyboard.",
          "tags": [
            "tui",
            "onboarding"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/splash/keys.go",
              "sha256": "60d7f0bdf3fabe3209dab35adc9819801d228b3cf3b480dad7c2397113459312"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43,
          "sectionId": "section-tui-onboarding"
        },
        {
          "id": "aspect-onboarding-logo-resize",
          "slug": "onboarding-logo-resize",
          "name": "Splash logo re-renders when terminal size changes",
          "description": "`SetSize` detects width changes and regenerates the pre-rendered logo via `logoBlock`, recalculating list height so the onboarding list or API key form fits beneath the art regardless of window resizing.",
          "tags": [
            "tui",
            "onboarding",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/splash/splash.go",
              "sha256": "e8fa618114e161bc9ff6bab4ba60577376cdbdc739a07923a4afa582f8cbfdf5"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.4,
          "sectionId": "section-tui-onboarding"
        },
        {
          "id": "aspect-onboarding-apikey-input",
          "slug": "onboarding-apikey-input",
          "name": "API key input swaps prompts and titles per verification state",
          "description": "`APIKeyInput.updateStatePresentation` changes the prompt to a spinner during verification, swaps in a checkmark on success, and recolours text for errors while keeping the cursor position correct. A help footer reminds users the key is stored under the global config path.",
          "tags": [
            "tui",
            "onboarding",
            "config"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/models/apikey.go",
              "sha256": "f29f3ed44446216d5d4986215a8524c2cbdb190358e968cf66cbea3437f76cd7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52,
          "sectionId": "section-tui-onboarding"
        },
        {
          "id": "aspect-onboarding-api-key-autosubmit",
          "sectionId": "section-tui-onboarding",
          "slug": "onboarding-api-key-autosubmit",
          "name": "API key verification queues auto-submit after spinner completes",
          "description": "In `splash.go`, `models.APIKeyInput` emits `APIKeyInputStateVerified`, triggering a 5s `SubmitAPIKeyMsg` ticker. `saveAPIKeyAndContinue` only runs when `isAPIKeyValid` remains true, letting users review the message before the key is stored and onboarding closes.",
          "tags": [
            "tui",
            "onboarding",
            "config"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/splash/splash.go",
              "sha256": "e8fa618114e161bc9ff6bab4ba60577376cdbdc739a07923a4afa582f8cbfdf5"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.46
        },
        {
          "id": "aspect-onboarding-model-list-keymap",
          "sectionId": "section-tui-onboarding",
          "slug": "onboarding-model-list-keymap",
          "name": "Model list rebinds list keymap to crush onboarding shortcuts",
          "description": "`splash.New` clones the experimental list keymap, disabling vertical paging keys and wiring `Next`/`Previous` to the splash keymap so `j/k` and arrow keys move between models while other navigation (home/end) stays inactive during onboarding.",
          "tags": [
            "tui",
            "onboarding"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/splash/splash.go",
              "sha256": "e8fa618114e161bc9ff6bab4ba60577376cdbdc739a07923a4afa582f8cbfdf5"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.43
        },
        {
          "id": "aspect-onboarding-mouse-focus",
          "sectionId": "section-tui-onboarding",
          "slug": "onboarding-mouse-focus",
          "name": "Splash mouse handling toggles chat/editor focus in compact layout",
          "description": "`splash.Update` adjusts mouse coordinates when compact mode squeezes the header, switching `focusedPane` between chat and editor on click and forwarding the event to the appropriate component so onboarding honours pointer interactions without breaking focus state.",
          "tags": [
            "tui",
            "onboarding"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/page/chat/chat.go",
              "sha256": "8a768b8aba112b0510e2f7d4ef49a23d66921d9605e4138a042eec60f85d07c7"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.44
        },
        {
          "id": "aspect-onboarding-api-key-spinner",
          "sectionId": "section-tui-onboarding",
          "slug": "onboarding-api-key-spinner",
          "name": "API key input reuses spinner ticks to animate verification state",
          "description": "`splash.Update` forwards `spinner.TickMsg` to `APIKeyInput`, keeping the verification spinner alive while the key is being checked. This ensures visual feedback continues even while the splash waits for validation or submission.",
          "tags": [
            "tui",
            "onboarding"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/chat/splash/splash.go",
              "sha256": "e8fa618114e161bc9ff6bab4ba60577376cdbdc739a07923a4afa582f8cbfdf5"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.4
        }
      ]
    },
    {
      "id": "section-llm",
      "slug": "llm",
      "title": "LLM Integration",
      "entries": [
        {
          "id": "aspect-agent-service",
          "sectionId": "section-llm",
          "slug": "agent-service",
          "name": "Coder agent orchestrates providers, tools, and cancellation",
          "description": "`internal/llm/agent/agent.go` wires the coder agent with session, message, history, permission, and LSP services, selects large and small models via `config.Models`, and bootstraps base tools lazily through `csync.Map` caches. It spins up provider clients with system prompts, manages active request cancellation per session, enqueues prompt queues, and exposes streaming events so the TUI can surface reasoning, tool calls, and summaries in real time.",
          "tags": [
            "agent",
            "llm",
            "permissions",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            },
            {
              "path": "projects/Crush/internal/csync/maps.go",
              "sha256": "31d7c1e87b05c9c73e2b6dab444e4acd7c3a46d549adb217959520ae089462ad"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.85
        },
        {
          "id": "aspect-model-selection",
          "sectionId": "section-llm",
          "slug": "model-selection",
          "name": "Config selects small and large models for titles and summarization",
          "description": "`internal/config/config.go` defines `SelectedModel` types and maps (`SelectedModelTypeSmall`, `SelectedModelTypeLarge`) that reference provider IDs and optional token limits. `agent.go` pulls these definitions when constructing title and summarizer providers so lightweight prompts use the small model while core coding tasks leverage the primary large model. This separation lets Crush reuse provider catalogs while ensuring auxiliary tasks stay cost-efficient and respect provider-specific overrides.",
          "tags": [
            "config",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/config/config.go",
              "sha256": "deb2d8e112ff7cab7783428cc2af45b751908841e4ee9d5b4620953544e37294"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.7
        },
        {
          "id": "aspect-provider-event-stream",
          "sectionId": "section-llm",
          "slug": "provider-event-stream",
          "name": "Provider event pipeline normalizes streaming content and tool calls",
          "description": "`internal/llm/provider/provider.go` defines `ProviderEvent` types for thinking deltas, tool lifecycle, warnings, and completion payloads, wrapping provider-specific clients with a `baseProvider` that strips empty messages and retries up to three times. Streamed events arrive on a channel while `SendMessages` handles one-shot requests, letting agents treat all providers uniformly.",
          "tags": [
            "agent",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/provider.go",
              "sha256": "9a0a3ec225a1f250b6fbb391fccffac2c046d12d7d8d519e792714867ad5f8c6"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.7
        },
        {
          "id": "aspect-agent-queue-management",
          "sectionId": "section-llm",
          "slug": "agent-queue-management",
          "name": "Agent queues prompts per session and cancels active generations",
          "description": "`internal/llm/agent/agent.go` guards each session with an `activeRequests` map so new prompts queue in `promptQueue` when work is in flight. `Run` registers a cancel func, drains queued prompts after tool finishes, and cleans up `promptQueue` entries when runs end, preventing overlapping generations while keeping follow-up prompts responsive.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.72
        },
        {
          "id": "aspect-agent-nested-task-tool",
          "sectionId": "section-llm",
          "slug": "agent-nested-task-tool",
          "name": "Coder agent lazily spawns the task agent as a tool",
          "description": "`internal/llm/agent/agent.go` detects when the coder agent's allowed tools include the agent tool and lazily calls `NewAgent` for the task agent, reusing permissions, sessions, messages, history, and LSP caches. The returned tool from `NewAgentTool` lets the coder delegate subtasks without starting a secondary runtime until it is actually needed.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.7
        },
        {
          "id": "aspect-agent-summarize-pipeline",
          "sectionId": "section-llm",
          "slug": "agent-summarize-pipeline",
          "name": "Summarization pipeline streams progress and updates session cost",
          "description": "`internal/llm/agent/agent.go`'s `Summarize` stores a cancel func in `activeRequests`, emits staged `AgentEventTypeSummarize` messages, appends a guidance prompt, and streams responses from the summarize provider. It appends the persistent shell directory, stores the assistant summary message with provider metadata, updates cost and token counters on the session, and finishes with a `Done` event so the UI clears the progress indicator.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.74
        },
        {
          "id": "aspect-agent-update-model",
          "sectionId": "section-llm",
          "slug": "agent-update-model",
          "name": "Dynamic model refresh rebuilds providers after config changes",
          "description": "`internal/llm/agent/agent.go`'s `UpdateModel` rereads the global config to recreate the primary provider if its ID changed, rebuilds the title provider with a higher token budget for Gemini, and swaps the summarize provider when the large model provider differs. Updated handles replace the cached fields so subsequent runs immediately pick up the new selections.",
          "tags": [
            "config",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "id": "aspect-agent-request-cancellation",
          "slug": "agent-request-cancellation",
          "name": "Agent surfaces session-busy and user-cancelled sentinel errors",
          "description": "`ErrRequestCancelled` and `ErrSessionBusy` provide canonical error values, while `isCancelledErr` treats either as a cancellation so the agent can shut down streams gracefully. Downstream components collapse both user aborts and context cancels into the same control path.",
          "tags": [
            "agent",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/errors.go",
              "sha256": "961aa47085f6eb1a053cec3d971949a7f69b258e4d5d052f16d73354515b9220"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44,
          "sectionId": "section-llm"
        },
        {
          "id": "aspect-agent-telemetry-events",
          "slug": "agent-telemetry-events",
          "name": "Agent telemetry packages prompt timing, token usage, and model info",
          "description": "`eventPromptSent`, `eventPromptResponded`, and `eventTokensUsed` call into the telemetry package with context from `eventCommon`, including provider, model, reasoning effort, and YOLO flag. Prompt durations and token counts are emitted immediately after each run, feeding observability dashboards.",
          "tags": [
            "agent",
            "llm",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/event.go",
              "sha256": "79cf2f15ecb8a7805932b12519d56d3ad2f22b7413de93213f34b42915b663e3"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5,
          "sectionId": "section-llm"
        },
        {
          "id": "aspect-agent-mcp-tools",
          "slug": "agent-mcp-tools",
          "name": "MCP tool registry pings clients, renews sessions, and publishes state",
          "description": "`mcp-tools.go` tracks client sessions in concurrent maps, refreshes them via `getOrRenewClient`, and publishes `MCPEvent`s whenever state changes. `McpTool.Run` enforces permission prompts before calling remote tools and relays textual responses back into the agent tool pipeline.",
          "tags": [
            "agent",
            "llm",
            "mcp",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/mcp-tools.go",
              "sha256": "212d854101a8e00589650d970fdf55dab3f6f350366b3702298a34570c7d7e59"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57,
          "sectionId": "section-llm"
        },
        {
          "id": "aspect-agent-title-streaming",
          "sectionId": "section-llm",
          "slug": "agent-title-streaming",
          "name": "Agent streams small-model titles and strips hidden thinking tags",
          "description": "`internal/llm/agent/agent.go` launches `generateTitle` in a goroutine when a session has no history, streams the small-model provider, trims `<think>` sections, squashes newlines into spaces, and persists the cleaned value through the sessions service so conversations receive concise titles without blocking the main run.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-agent-summary-rebase",
          "sectionId": "section-llm",
          "slug": "agent-summary-rebase",
          "name": "Summary handoff rewrites history around the stored summary message",
          "description": "Before creating a new user message, `processGeneration` checks `Session.SummaryMessageID`; if present it slices the cached transcript so the summary becomes the first user turn, ensuring follow-up prompts build on the recap rather than the entire backlog.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "id": "aspect-agent-attachment-filter",
          "sectionId": "section-llm",
          "slug": "agent-attachment-filter",
          "name": "Run drops binary attachments when the active model is text-only",
          "description": "`Run` inspects `Model().SupportsImages` and clears `attachments` when the provider lacks multimodal support, otherwise it serialises each file into `message.BinaryContent` parts so multimodal runs carry MIME metadata without causing OpenAI-style validation errors.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-agent-provider-event-mapping",
          "sectionId": "section-llm",
          "slug": "agent-provider-event-mapping",
          "name": "Provider events mutate reasoning blocks, tool calls, and usage metrics",
          "description": "`processEvent` switches on each streamed `provider.ProviderEvent`, appending thinking signatures, expanding tool call input/output, finalising completions, and calling `trackUsage` so token accounting and session cost update in lockstep with the TUI message record.",
          "tags": [
            "agent",
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.59
        },
        {
          "id": "aspect-agent-tool-execution-pipeline",
          "sectionId": "section-llm",
          "slug": "agent-tool-execution-pipeline",
          "name": "Tool execution runs in cancellable goroutines with permission-aware fallbacks",
          "description": "When a provider requests tool use, `streamAndHandleEvents` resolves the tool, runs it in a goroutine, honours context deadlines, and marks remaining calls as cancelled on permission errors before finishing the assistant message with `FinishReasonPermissionDenied` so the UI reflects the rejection.",
          "tags": [
            "agent",
            "llm",
            "permissions",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-agent-token-cost-tracking",
          "sectionId": "section-llm",
          "slug": "agent-token-cost-tracking",
          "name": "trackUsage applies provider pricing and persists session spend",
          "description": "`trackUsage` pulls the active model from config, multiplies cache, input, and output tokens by their per-million rates, emits telemetry via `eventTokensUsed`, and saves the updated cost plus prompt/completion tallies back to the session record.",
          "tags": [
            "agent",
            "llm",
            "observability",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-agent-cancel-session",
          "sectionId": "section-llm",
          "slug": "agent-cancel-session",
          "name": "Cancel aborts active generation and clears queued prompts per session",
          "description": "`Cancel` looks up the session's cancel func, cancels any in-flight summarisation keyed by `sessionID-\nsummarize`, and drops pending entries from `promptQueue`, ensuring the next user message starts fresh.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-agent-cancel-all",
          "sectionId": "section-llm",
          "slug": "agent-cancel-all",
          "name": "CancelAll drains cleanup hooks and waits for active requests to exit",
          "description": "`CancelAll` iterates the `activeRequests` map, invokes `Cancel`, runs stored cleanup callbacks (including MCP shutdown), and polls `IsBusy()` until all requests finish or a five-second timeout elapses so shutdown doesn\u2019t leak goroutines.",
          "tags": [
            "agent",
            "llm",
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-agent-mcp-refresh",
          "sectionId": "section-llm",
          "slug": "agent-mcp-refresh",
          "name": "MCP subscription refreshes lazy tool caches and broker state",
          "description": "`setupEvents` subscribes to `SubscribeMCPEvents`; on `MCPEventToolsListChanged` it re-lists tools, resets the lazy MCP cache, updates shared state, and appends the cancel func to cleanup hooks so shutdown halts the watcher.",
          "tags": [
            "agent",
            "llm",
            "mcp",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            },
            {
              "path": "projects/Crush/internal/llm/agent/mcp-tools.go",
              "sha256": "212d854101a8e00589650d970fdf55dab3f6f350366b3702298a34570c7d7e59"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-agent-prompt-history",
          "sectionId": "section-llm",
          "slug": "agent-prompt-history",
          "name": "processGeneration appends tool results before replaying queued prompts",
          "description": "After a tool call finishes, `processGeneration` stores the assistant message and tool result in history, then dequeues any buffered prompts and turns them into new user messages, keeping batched follow-ups ordered without interleaving runs.",
          "tags": [
            "agent",
            "llm",
            "session",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "id": "aspect-agent-missing-tool-result",
          "sectionId": "section-llm",
          "slug": "agent-missing-tool-result",
          "name": "Unknown tool calls return explicit error results without panicking",
          "description": "If a provider references an unregistered tool, `streamAndHandleEvents` records a `ToolResult` with `Tool not found: <name>` and flags it as an error so the run survives misconfigured tool lists and surfaces the issue to the user.",
          "tags": [
            "agent",
            "llm",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "id": "aspect-agent-tool-context-injection",
          "sectionId": "section-llm",
          "slug": "agent-tool-context-injection",
          "name": "Tool execution context injects session and message IDs for permission prompts",
          "description": "`streamAndHandleEvents` stores the session ID on the context before contacting the provider and later adds the assistant message ID, giving tools like Bash enough metadata to issue permission requests tied to the originating message.",
          "tags": [
            "agent",
            "llm",
            "session",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            },
            {
              "path": "projects/Crush/internal/llm/tools/tools.go",
              "sha256": "d82c73f5d27bac29734fa4659e71475fb1e3a8896e36adc267f015f64fce6ea9"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "id": "aspect-agent-toolset-selection",
          "sectionId": "section-llm",
          "slug": "agent-toolset-selection",
          "name": "getAllTools assembles base, diagnostics, MCP, and nested agent helpers",
          "description": "`getAllTools` filters the lazily initialised base tools by the agent allowlist, appends MCP tools for the coder agent, injects diagnostics when LSP clients are available, and adds the nested agent tool when configured before handing the roster to providers.",
          "tags": [
            "agent",
            "llm",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-agent-assistant-placeholder",
          "sectionId": "section-llm",
          "slug": "agent-assistant-placeholder",
          "name": "Assistant placeholder message primes streaming updates before provider output",
          "description": "`streamAndHandleEvents` creates an empty assistant message before contacting the provider, letting the UI show a spinner immediately and ensuring reasoning deltas, tool calls, and finish reasons update the same record instead of flickering between transient messages.",
          "tags": [
            "agent",
            "llm",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-agent-run-queue-busy",
          "sectionId": "section-llm",
          "slug": "agent-run-queue-busy",
          "name": "Run queues prompts and returns no channel when a session is busy",
          "description": "If `IsSessionBusy` returns true, `Run` appends the prompt to `promptQueue` and returns `nil, nil`, signalling the caller to skip subscribing because the queued prompt will be replayed after the current generation completes.",
          "tags": [
            "agent",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.54
        },
        {
          "id": "aspect-agent-empty-finish-fallback",
          "sectionId": "section-llm",
          "slug": "agent-empty-finish-fallback",
          "name": "Blank finish reasons default to canceled to keep history consistent",
          "description": "`processGeneration` guards against providers that omit finish reasons; when `FinishReason()` is empty it logs a cancellation and adds a `FinishReasonCanceled` part so message history reflects that the run was interrupted.",
          "tags": [
            "agent",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.53
        },
        {
          "id": "aspect-agent-tool-cancellation-results",
          "sectionId": "section-llm",
          "slug": "agent-tool-cancellation-results",
          "name": "Tool loop marks remaining calls as canceled when the context ends",
          "description": "Inside `streamAndHandleEvents`, if the request context is canceled the agent finishes the assistant message with `FinishReasonCanceled` and seeds remaining tool results with \"Tool execution canceled by user\" so downstream history shows why execution stopped.",
          "tags": [
            "agent",
            "llm",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.54
        },
        {
          "id": "aspect-agent-run-panic-guard",
          "sectionId": "section-llm",
          "slug": "agent-run-panic-guard",
          "name": "Run wraps generation goroutines with log.RecoverPanic",
          "description": "The goroutine inside `Run` defers `log.RecoverPanic`, turning panics into error events and sending them down the channel so the TUI reports failures without crashing the process.",
          "tags": [
            "agent",
            "llm",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            },
            {
              "path": "projects/Crush/internal/log/log.go",
              "sha256": "373f0bfff11dd59e390b31d1c4fb23e7759dd5df75ded5e76e78a5976d2e39cc"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        }
      ]
    },
    {
      "id": "section-tools",
      "slug": "tools",
      "title": "Agent Tools",
      "entries": [
        {
          "id": "aspect-agent-tool",
          "sectionId": "section-tools",
          "slug": "agent-tool",
          "name": "Agent tool spins nested sessions and aggregates cost",
          "description": "`internal/llm/agent/agent-tool.go` lets the coder agent spawn another agent with a fresh task-specific session, streaming results back once completed. It records the child session\u2019s cost, merges it into the parent session, and returns the assistant\u2019s content while guarding against missing session/message IDs. If the nested run errors, the tool surfaces friendly text errors so the initiating agent can recover gracefully.",
          "tags": [
            "agent",
            "cli-runtime",
            "llm",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/agent/agent-tool.go",
              "sha256": "9c7f7928ab2594c21cd3b7ab3febbda661d19ce28cdd94a970b9bfbd840d9600"
            },
            {
              "path": "projects/Crush/internal/session/session.go",
              "sha256": "96cd789d9a08ddf73f18a3035e7f6b37b7b94623806df131ac97abd9b8f3a675"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.68
        },
        {
          "id": "aspect-bash-tool",
          "sectionId": "section-tools",
          "slug": "bash-tool",
          "name": "Bash tool templates guidance and blocks high-risk commands",
          "description": "`internal/llm/tools/bash.go` embeds a templated description listing banned commands (package managers, network clients, privilege escalators), enforces max runtime/output limits, and injects attribution instructions based on config. Before execution it requests permission with command and timeout metadata, uses the shell runner with blocklists, and truncates output to avoid overwhelming replies while still streaming start/end timestamps. The companion instructions in `internal/llm/tools/bash.md` tell the agent to validate directories with LS, avoid using cat/find when dedicated tools exist, respect the banned command list, and keep a persistent shell session rooted with absolute paths so prompt guidance matches runtime safeguards.",
          "tags": [
            "automation",
            "cli-runtime",
            "llm",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/bash.go",
              "sha256": "88deb685f813fde9ad0a4813950296eabfedd79e1843bba51f0752f5f1db414a"
            },
            {
              "path": "projects/Crush/internal/llm/tools/bash.md",
              "sha256": "19a5026c8c2f04098df893cd2ba0c973ec266703adac867bbb0cfa32b7c6a55f"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.62
        },
        {
          "id": "aspect-download-tool",
          "sectionId": "section-tools",
          "slug": "download-tool",
          "name": "Download tool bounds network writes and enforces path approval",
          "description": "`internal/llm/tools/download.go` limits downloads to HTTP/HTTPS URLs, clamps user-supplied timeouts to 10 minutes, and caps file size at 100 MB. It resolves relative paths against the working directory, issues permission prompts describing URL and target, and ensures parent directories exist before streaming data. If the size limit is hit, it removes partial files to avoid leaving corrupted artifacts. `internal/llm/tools/download.md` reinforces those bounds, highlighting the 100 MB ceiling, protocol whitelist, lack of authentication support, and the fact that the tool will overwrite existing files after creating missing parent directories.",
          "tags": [
            "agent",
            "filesystem",
            "llm",
            "permissions",
            "rendering",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/download.go",
              "sha256": "026d0fe3b3d20a99c6c2235226e2bea18ce6fecf9708e8ea302ec80f34232ddf"
            },
            {
              "path": "projects/Crush/internal/llm/tools/download.md",
              "sha256": "c32d544efa5471f09ba8012e7f1a5645549b259e87f22274b29791c6a5432b91"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.6
        },
        {
          "id": "aspect-edit-tool",
          "sectionId": "section-tools",
          "slug": "edit-tool",
          "name": "Edit tool enforces permission checks and annotates diagnostics",
          "description": "`internal/llm/tools/edit.go` normalizes paths relative to the working directory, generates diffs before requesting permission, and uses history service to version file content. It handles create/delete/replace flows, updates LSP clients, and appends diagnostics to responses so the agent sees compile feedback immediately. Permission prompts include old/new content snapshots, and operations bail out gracefully when users deny the request or replacements fail. The usage guide in `internal/llm/tools/edit.md` demands absolute paths, 3\u20135 lines of unique context, and reiterates creation/deletion semantics plus Windows path rules, ensuring prompt behaviour matches the service constraints.",
          "tags": [
            "diffing",
            "filesystem",
            "history",
            "llm",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/edit.go",
              "sha256": "c29298100d5f7b3218f01ca2dc0f8e87c60ed5ad725b1821ab142a94355f8fae"
            },
            {
              "path": "projects/Crush/internal/llm/tools/edit.md",
              "sha256": "ef84327335ee6b32d4fe086b67032ac0961e0e55ad554a5a055f756be0a5cbe6"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.7
        },
        {
          "id": "aspect-grep-tool-tests",
          "sectionId": "section-tools",
          "slug": "grep-tool-tests",
          "name": "Grep tool tests cover caching and ignore rules",
          "description": "`internal/llm/tools/grep_test.go` locks down the regex cache so repeated patterns reuse compiled expressions, validates glob expansion, and compares the pure Go walker against ripgrep with `.gitignore` / `.crushignore` fixtures. It ensures both implementations skip ignored paths, drop binaries, and return consistent match metadata.",
          "tags": [
            "tools",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/grep_test.go",
              "sha256": "5ceef8556af300cc86a979b0a901fc5f4d335c5353fd7f8e513500f63e3a9d55"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.36
        },
        {
          "id": "aspect-multiedit-tool",
          "sectionId": "section-tools",
          "slug": "multiedit-tool",
          "name": "Multi-edit tool batches sequential replacements with validation",
          "description": "`internal/llm/tools/multiedit.go` accepts an array of edit operations, validates that only the first can create files, and applies replacements while tracking additions and removals. It consolidates permission prompts with pre-computed diffs, writes history entries per edit, and waits for LSP diagnostics before returning. Errors short-circuit the sequence so partial edits don't leave files inconsistent. `internal/llm/tools/multiedit.md` clarifies that edits are applied atomically in sequence and inherit the same uniqueness requirements as the single edit tool, guiding the agent to plan batches that won't conflict.",
          "tags": [
            "diffing",
            "filesystem",
            "history",
            "llm",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/multiedit.go",
              "sha256": "3622d11fadd69a3ab43b037ad8948d5363ebb76ed94e9706afe8c52f374f0e3f"
            },
            {
              "path": "projects/Crush/internal/llm/tools/multiedit.md",
              "sha256": "1635657d0be7bb0792544dd1c43a67ffd39273c1358de0223204d5074b60a8a7"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.66
        },
        {
          "id": "aspect-tool-diagnostics",
          "sectionId": "section-tools",
          "slug": "tool-diagnostics",
          "name": "Diagnostics tool aggregates LSP findings into file and project summaries",
          "description": "`internal/llm/tools/diagnostics.go` pings active LSP clients to ensure files are open, collects diagnostics via `client.GetDiagnostics()`, and sorts them into per-file and project buckets with capped output. It appends a summary of error/warning counts so agents can quickly surface hotspots. The operator notes in `internal/llm/tools/diagnostics.md` explain the empty path behaviour for project-wide scans and the severity grouping semantics, so prompt usage stays aligned with the Go implementation.",
          "tags": [
            "agent",
            "llm",
            "lsp",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/diagnostics.go",
              "sha256": "a3eb2ee89af44d07122ff805bfe896a371b3e1b6305c2f36e593da4c597d55c6"
            },
            {
              "path": "projects/Crush/internal/llm/tools/diagnostics.md",
              "sha256": "1fadb970a6dc9bf143a4aca5fc7baaebbcffb0585720064c9ce2345d7acb3c8b"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.57
        },
        {
          "id": "aspect-tool-fetch",
          "sectionId": "section-tools",
          "slug": "tool-fetch",
          "name": "Fetch tool enforces approval and converts HTML to text or markdown",
          "description": "`internal/llm/tools/fetch.go` requests permission before issuing HTTP GETs, caps timeouts at 120s, and limits bodies to 5MB. It autodetects HTML responses to extract plain text or convert to fenced markdown using goquery and html-to-markdown so agents receive readable snippets. Approved requests surface inside the permissions dialog, which replays `PermissionResponseMsg` back to the permission service so tools can resume or abort based on user choice. The `internal/llm/tools/fetch.md` primer documents the selectable text/markdown/HTML formats, redirect handling, and size/timeout limits so prompt-side instructions mirror runtime enforcement.",
          "tags": [
            "agent",
            "config",
            "filesystem",
            "llm",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/fetch.go",
              "sha256": "d17f0ab8514e0dca7db2e7b74d322188a0a50691204a5247339fb035a9ad5144"
            },
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            },
            {
              "path": "projects/Crush/internal/llm/tools/fetch.md",
              "sha256": "22e6d8556a90f7f05f2efe6c4621bd63fb69e698bfd2a6ad95243248ea323b22"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.64
        },
        {
          "id": "aspect-tool-file-timestamps",
          "sectionId": "section-tools",
          "slug": "tool-file-timestamps",
          "name": "File tool tracks read/write timestamps for history heuristics",
          "description": "`internal/llm/tools/file.go` maintains a mutexed map of file access records, exposing helpers that record read and write times so higher-level tools can decide whether to trigger refreshes or display recent changes.",
          "tags": [
            "llm",
            "tools",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/file.go",
              "sha256": "0fd38cb05b599eeb89ff7a11457fae06e57658d5854396304b5a41ef6517c641"
            }
          ],
          "lastUpdated": "2025-10-17",
          "importance": 0.44
        },
        {
          "id": "aspect-tool-glob",
          "sectionId": "section-tools",
          "slug": "tool-glob",
          "name": "Glob tool prefers ripgrep and falls back to doublestar",
          "description": "`internal/llm/tools/glob.go` validates patterns, honours `.gitignore`/`.crushignore`, and limits matches to 100 entries sorted by recent modification before asking for permission. It streams results back to the TUI with truncation notice so the agent can refine queries when necessary. The instructions in `internal/llm/tools/glob.md` spell out supported glob tokens, the hidden-file skips, and tips for chaining with Grep, aligning the LLM's expectations with the tool's guardrails.",
          "tags": [
            "agent",
            "config",
            "filesystem",
            "llm",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/glob.go",
              "sha256": "a0dabf77845744451c31e10d6382c234765ec7c89499bf8995dd226208d86c28"
            },
            {
              "path": "projects/Crush/internal/fsext/ls.go",
              "sha256": "3c746b7a43017ba58e5fe0937f5c65f17a4c461d5c8485229d7120bd42d8af33"
            },
            {
              "path": "projects/Crush/internal/llm/tools/glob.md",
              "sha256": "9ca9f2007b6a259dbf11bd3f4a68ba003801be3b649397c8f5aa0cc1b281dfd2"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.56
        },
        {
          "id": "aspect-tool-grep",
          "sectionId": "section-tools",
          "slug": "tool-grep",
          "name": "Grep tool caches regexps and surfaces context-rich matches",
          "description": "`internal/llm/tools/grep.go` wraps ripgrep when available (falling back to Go walkers), batches responses to 100 hits, and respects ignore files before prompting for permission. It annotates responses with truncated previews so the agent can drill further without flooding the UI. `internal/llm/tools/grep.md` explains literal versus regex modes, include filters, and ignore behaviour, reinforcing how searches should be scoped to stay within the tool's limits.",
          "tags": [
            "agent",
            "llm",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/grep.go",
              "sha256": "eedb02fe182f11d57d23d4aac51e960eb5a9af1d16291f151dc3ea5196c44ab8"
            },
            {
              "path": "projects/Crush/internal/fsext/ls.go",
              "sha256": "3c746b7a43017ba58e5fe0937f5c65f17a4c461d5c8485229d7120bd42d8af33"
            },
            {
              "path": "projects/Crush/internal/llm/tools/grep.md",
              "sha256": "13146f0827acf9e3cd64786bdc62a6eacf1f0ab6a617d5ba485134ce1b9fe88f"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.55
        },
        {
          "id": "aspect-tool-ls",
          "sectionId": "section-tools",
          "slug": "tool-ls",
          "name": "Ls tool walks trees with ignore stacking and permission guards",
          "description": "`internal/llm/tools/ls.go` lists directory trees with ignore support, truncates at 1,000 items, and emits permission requests describing the root path so users can approve large listings. It also suggests similar directories when a path is missing. The usage guide in `internal/llm/tools/ls.md` emphasises hidden-file filtering, truncation behaviour, and combining LS with other tools for project discovery.",
          "tags": [
            "agent",
            "filesystem",
            "llm",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/ls.go",
              "sha256": "2b194e28482514686a7c57c9aa3a87b779159423090a53f188a1dee869902fe1"
            },
            {
              "path": "projects/Crush/internal/fsext/ls.go",
              "sha256": "3c746b7a43017ba58e5fe0937f5c65f17a4c461d5c8485229d7120bd42d8af33"
            },
            {
              "path": "projects/Crush/internal/llm/tools/ls.md",
              "sha256": "73ef5d0e93297205fa6cc700111fec9a47e754db316199f8681dc58aad8d4731"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.6
        },
        {
          "id": "aspect-tool-permission-patterns",
          "sectionId": "section-tools",
          "slug": "tool-permission-patterns",
          "name": "File-access tools share a unified permission pipeline",
          "description": "File-manipulating tools (`ls`, `view`, `write`, `download`, and `bash`) all call into `permission.Service` before leaving the working directory or mutating files. `internal/llm/tools/ls.go` and `view.go` resolve paths with `fsext` helpers, `download.go` sanitizes HTTP targets, `write.go` stages diffs, and `bash.go` wraps shell execution\u2014all of them emit `CreatePermissionRequest` records that the TUI permissions dialog renders before sending `PermissionResponseMsg` back to resume the tool. This shared pattern lets the agent reuse the same approval UX for reads, writes, and command execution.",
          "tags": [
            "config",
            "llm",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/ls.go",
              "sha256": "2b194e28482514686a7c57c9aa3a87b779159423090a53f188a1dee869902fe1"
            },
            {
              "path": "projects/Crush/internal/llm/tools/view.go",
              "sha256": "4449578dd0cae12851a5ec8d560bc48b55df0b250b5817d4059daaa095ac9607"
            },
            {
              "path": "projects/Crush/internal/llm/tools/write.go",
              "sha256": "ec62899e546da178100218b187897ece03e78d53e320b76d587032867c4b1cbb"
            },
            {
              "path": "projects/Crush/internal/llm/tools/download.go",
              "sha256": "026d0fe3b3d20a99c6c2235226e2bea18ce6fecf9708e8ea302ec80f34232ddf"
            },
            {
              "path": "projects/Crush/internal/llm/tools/bash.go",
              "sha256": "88deb685f813fde9ad0a4813950296eabfedd79e1843bba51f0752f5f1db414a"
            },
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.64
        },
        {
          "id": "aspect-tool-registry",
          "sectionId": "section-tools",
          "slug": "tool-registry",
          "name": "Tool registry propagates session context into tool executions",
          "description": "`internal/llm/tools/tools.go` defines the shared `ToolCall`, `ToolInfo`, and response helpers, stores session/message IDs in context keys, and serializes metadata alongside responses. `agent.NewAgent` registers base tools (bash, download, edit, multiedit, fetch, glob, grep, ls, sourcegraph, view, write) while wiring permission and history services so each tool can rehydrate context. This registry ensures tool responses embed enough metadata for the TUI and history services to track actions, even when tools are executed concurrently.",
          "tags": [
            "agent",
            "cli-runtime",
            "config",
            "llm",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/tools.go",
              "sha256": "d82c73f5d27bac29734fa4659e71475fb1e3a8896e36adc267f015f64fce6ea9"
            },
            {
              "path": "projects/Crush/internal/llm/agent/agent.go",
              "sha256": "ed769eba54b2755c046e4d04ddcc64cab069521ed3b20ce1967b655919d8366b"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.64
        },
        {
          "id": "aspect-tool-rg-discovery",
          "sectionId": "section-tools",
          "slug": "tool-rg-discovery",
          "name": "Ripgrep helper resolves binary location and builds glob commands",
          "description": "`internal/llm/tools/rg.go` caches the `rg` binary path with `sync.OnceValue`, warns when missing, and constructs file and search commands with null-separated output so ls/glob/grep tooling can fall back gracefully when ripgrep is unavailable.",
          "tags": [
            "llm",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/rg.go",
              "sha256": "c392fc0eb0f3d500190d771a87e92c952a217051449f497a396cabd83ef4b1e0"
            }
          ],
          "lastUpdated": "2025-10-17",
          "importance": 0.5
        },
        {
          "id": "aspect-tool-safe-command-list",
          "sectionId": "section-tools",
          "slug": "tool-safe-command-list",
          "name": "Safe command registry enumerates whitelisted shell invocations",
          "description": "`internal/llm/tools/safe.go` enumerates platform-specific safe commands (core utilities, git verbs, and Windows diagnostics) so the bash tool can quickly check whether a request falls inside the allowlist without recomputing per invocation.",
          "tags": [
            "llm",
            "tools",
            "permissions"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/safe.go",
              "sha256": "f129fde8b39182a255c055b0b07bd37d5fb876c3b23a3bb7edf6a327018638fb"
            }
          ],
          "lastUpdated": "2025-10-17",
          "importance": 0.43
        },
        {
          "id": "aspect-tool-sourcegraph",
          "sectionId": "section-tools",
          "slug": "tool-sourcegraph",
          "name": "Sourcegraph tool issues GraphQL searches with bounded results",
          "description": "`internal/llm/tools/sourcegraph.go` submits GraphQL queries to sourcegraph.com, clamping result counts to 20 and timeouts to 120 seconds. Responses are unmarshaled into markdown-like summaries that include repository, path, and surrounding context so agents can cite external references. Query results complement local search tools (`glob`, `grep`, `fetch`) by returning repository paths and context that the agent can combine with permissions-gated filesystem operations. `internal/llm/tools/sourcegraph.md` enumerates the query syntax (repo, file, type, commit filters) and rate limits so prompts describe the same capabilities exposed by the client.",
          "tags": [
            "agent",
            "llm",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/sourcegraph.go",
              "sha256": "8400f6f16f9b28896a0133a521fc73c07fbc0ffb2dcd683970f361942f5530c9"
            },
            {
              "path": "projects/Crush/internal/llm/tools/glob.go",
              "sha256": "a0dabf77845744451c31e10d6382c234765ec7c89499bf8995dd226208d86c28"
            },
            {
              "path": "projects/Crush/internal/llm/tools/grep.go",
              "sha256": "eedb02fe182f11d57d23d4aac51e960eb5a9af1d16291f151dc3ea5196c44ab8"
            },
            {
              "path": "projects/Crush/internal/llm/tools/fetch.go",
              "sha256": "d17f0ab8514e0dca7db2e7b74d322188a0a50691204a5247339fb035a9ad5144"
            },
            {
              "path": "projects/Crush/internal/llm/tools/sourcegraph.md",
              "sha256": "7cd0a5339a540f0034bc0144f3c6b2ebcf291412da44d2dbcc08643d89664e08"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.5
        },
        {
          "id": "aspect-tool-view",
          "sectionId": "section-tools",
          "slug": "tool-view",
          "name": "View tool enforces size limits and nudges LSPs for diagnostics",
          "description": "`internal/llm/tools/view.go` streams file contents with line numbers, enforces a 250 KB / 2,000-line cap, and redacts binary data before prompting. It resolves absolute paths and offers similar-path suggestions when files are missing. The prompt in `internal/llm/tools/view.md` reiterates those limits, the offset/limit parameters, and guidance to favour dedicated tools for directories, keeping agent expectations in sync with runtime constraints.",
          "tags": [
            "agent",
            "filesystem",
            "llm",
            "lsp",
            "permissions",
            "rendering",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/view.go",
              "sha256": "4449578dd0cae12851a5ec8d560bc48b55df0b250b5817d4059daaa095ac9607"
            },
            {
              "path": "projects/Crush/internal/llm/tools/view.md",
              "sha256": "505ed6934251963f99f5bbd3436a0c9e14672b3fca373ff11da53acfe90f9f93"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.58
        },
        {
          "id": "aspect-tool-write",
          "sectionId": "section-tools",
          "slug": "tool-write",
          "name": "Write tool diffs edits, records history, and refreshes LSP state",
          "description": "`internal/llm/tools/write.go` writes or creates files atomically, verifies parent directories (creating them when necessary), and skips writes if content is unchanged after receiving permission. It records history revisions and notifies LSP clients so diagnostics refresh. The `internal/llm/tools/write.md` guide reminds the agent to read files first, notes parent directory auto-creation, and warns that writes are whole-file replacements with Windows path tips, reinforcing safe usage patterns.",
          "tags": [
            "filesystem",
            "history",
            "llm",
            "permissions",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/tools/write.go",
              "sha256": "ec62899e546da178100218b187897ece03e78d53e320b76d587032867c4b1cbb"
            },
            {
              "path": "projects/Crush/internal/history/file.go",
              "sha256": "cc940356f6dfd073795c6f5d7e559467d4e5140da6a51c9b5ac43c097075e392"
            },
            {
              "path": "projects/Crush/internal/llm/tools/write.md",
              "sha256": "b03159a5cb423a065926cb8fe2368bbd261904daae7f617a949bf86c052bb220"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.66
        },
        {
          "id": "aspect-unified-diff-generator",
          "sectionId": "section-tools",
          "slug": "unified-diff-generator",
          "name": "GenerateDiff produces unified patches and counts changes",
          "description": "`internal/diff/diff.go` trims leading slashes from filenames, calls `go-udiff`, and walks the output counting +/- hunks so tools can show diff stats alongside the patch content.",
          "tags": [
            "agent",
            "cli",
            "diffing",
            "filesystem",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/diff/diff.go",
              "sha256": "7b98cd6d4e1142339f600abf3b81bbfd1b01f890950779604b60f6a06b847ec5"
            },
            {
              "path": "projects/Crush/internal/llm/tools/edit.go",
              "sha256": "c29298100d5f7b3218f01ca2dc0f8e87c60ed5ad725b1821ab142a94355f8fae"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        }
      ]
    },
    {
      "id": "section-permissions",
      "slug": "permissions",
      "title": "Permissions and Safety",
      "entries": [
        {
          "id": "aspect-permission-service",
          "sectionId": "section-permissions",
          "slug": "permission-service",
          "name": "Permission service serializes prompts, caches grants, and tracks sessions",
          "description": "`internal/permission/permission.go` layers a primary pubsub broker, a notification broker, and a `csync.Map` of pending channels so `Request` can block callers while the TUI reacts in real time. The method guards access with `requestMu`, short-circuits skip mode, allowlisted tool/action keys, auto-approved sessions, and previously granted `(tool, action, path)` tuples before publishing a prompt. `Grant`, `GrantPersistent`, and `Deny` flip `activeRequest`, fan out notification payloads, and feed the waiting goroutine, giving the service both concurrency safety and ergonomic tooling hooks.",
          "tags": [
            "permissions",
            "concurrency",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/permission/permission_test.go",
              "sha256": "efbcf0fcbde038af6e1bb18602ab2756e77da3930e765c29421247669ffd2b77"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.78
        },
        {
          "id": "aspect-permissions-yolo-flag",
          "sectionId": "section-permissions",
          "slug": "permissions-yolo-flag",
          "name": "YOLO flag flips SkipRequests and keeps UI state in sync",
          "description": "`internal/cmd/root.go` maps `--yolo/-y` onto `cfg.Permissions.SkipRequests` so the service boots in auto-approve mode, while `internal/tui/tui.go` and the commands dialog emit `ToggleYoloModeMsg` to call `SetSkipRequests` at runtime and refresh keymaps, status banners, and agent telemetry (`yolo mode`). Even when skip is enabled, `Request` still publishes notification events, keeping toast alerts and logs accurate during scripted runs.",
          "tags": [
            "cli",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            },
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            },
            {
              "path": "projects/Crush/internal/permission/permission_test.go",
              "sha256": "efbcf0fcbde038af6e1bb18602ab2756e77da3930e765c29421247669ffd2b77"
            },
            {
              "path": "projects/Crush/internal/tui/tui.go",
              "sha256": "456b4b3a9b6e8d6da885ed176d7306895ec5628b8bc348386a114bd0f8ca8bc1"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-permissions-noninteractive",
          "sectionId": "section-permissions",
          "slug": "permissions-noninteractive",
          "name": "Non-interactive runs auto-approve per session via AutoApproveSession",
          "description": "`internal/app/app.go` calls `Permissions.AutoApproveSession` on the transient session created for `RunNonInteractive`, populating the `autoApproveSessions` map so only that run bypasses prompts. Inside `Request` the lookup happens after allowlist checks but before prompting, letting scripted workflows stream tool output while interactive sessions still block; tests cover the interplay with persistent and temporary grants to ensure approvals remain scoped.",
          "tags": [
            "cli",
            "permissions",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            },
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/permission/permission_test.go",
              "sha256": "efbcf0fcbde038af6e1bb18602ab2756e77da3930e765c29421247669ffd2b77"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-permission-notifications",
          "sectionId": "section-permissions",
          "slug": "permission-notifications",
          "name": "Notification broker mirrors lifecycle events for snackbars and badges",
          "description": "`permission.NewPermissionService` builds a `notificationBroker` alongside the main broker so `Request` can publish a placeholder event as soon as a dialog opens and `Grant`/`Deny` later decorate the same tool call with `Granted`/`Denied` flags. `SubscribeNotifications` returns a context-bound channel, ensuring TUI toasts drain cleanly during shutdown without leaking goroutines.",
          "tags": [
            "permissions",
            "pubsub",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-permission-path-normalization",
          "sectionId": "section-permissions",
          "slug": "permission-path-normalization",
          "name": "Permission requests collapse file paths to directories before caching",
          "description": "`permission.Service.Request` inspects `os.Stat(opts.Path)` to decide whether to keep a directory as-is or collapse a file path to `filepath.Dir`, falling back to the service working directory when lookups fail. The normalized directory is stored on the `PermissionRequest` and in `sessionPermissions`, so future writes under that tree inherit the same grant while neighbouring folders continue to require approval.",
          "tags": [
            "permissions",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-permission-allowlist",
          "sectionId": "section-permissions",
          "slug": "permission-allowlist",
          "name": "Allowlist short-circuits prompts for whitelisted tools and actions",
          "description": "`Request` builds a `tool:action` string, compares it and the bare tool name against `allowedTools`, and immediately returns `true` when either matches, skipping locks and broker fan-out. `TestPermissionService_AllowedCommands` documents the precedence between tool-only and tool+action entries, keeping CLI defaults predictable for integrators.",
          "tags": [
            "permissions",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/permission/permission_test.go",
              "sha256": "efbcf0fcbde038af6e1bb18602ab2756e77da3930e765c29421247669ffd2b77"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-permission-persistent-cache",
          "sectionId": "section-permissions",
          "slug": "permission-persistent-cache",
          "name": "Persistent approvals store normalized requests for automatic reuse",
          "description": "`GrantPersistent` publishes a notification, signals the waiting channel from `pendingRequests`, and appends the canonical `(tool, action, sessionID, path)` tuple to `sessionPermissions`. The next `Request` iterates that slice before acquiring `requestMu`, letting repeated operations auto-approve while new paths still trigger dialogs; unit tests cover the cache\u2019s behaviour across sequential runs.",
          "tags": [
            "permissions",
            "session",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/permission/permission_test.go",
              "sha256": "efbcf0fcbde038af6e1bb18602ab2756e77da3930e765c29421247669ffd2b77"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-permission-pending-map",
          "sectionId": "section-permissions",
          "slug": "permission-pending-map",
          "name": "Pending request map bridges blocking callers with async notifications",
          "description": "`Request` stores a buffered channel in the `csync.Map`-backed `pendingRequests`, defers removal, and waits on the channel so grants can resolve asynchronously. `Grant`, `GrantPersistent`, and `Deny` look up the entry, send the boolean result, and clear `activeRequest`, while the notification broker continues broadcasting state\u2014providing a clean hand-off between blocking CLI calls and the interactive UI.",
          "tags": [
            "permissions",
            "concurrency",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-permissions-concurrent-requests",
          "sectionId": "section-permissions",
          "slug": "permissions-concurrent-requests",
          "name": "Permission service handles concurrent grants, denials, and persistent reuse",
          "description": "`permission_test.go` spawns three concurrent requests, mixes `Grant`, `GrantPersistent`, and `Deny`, and verifies that only the persistent approval auto-allows subsequent identical calls while other sessions still require interaction, demonstrating the service\u2019s sequential gatekeeping under parallel load.",
          "tags": [
            "permissions",
            "concurrency",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            },
            {
              "path": "projects/Crush/internal/permission/permission_test.go",
              "sha256": "efbcf0fcbde038af6e1bb18602ab2756e77da3930e765c29421247669ffd2b77"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        }
      ]
    },
    {
      "id": "section-cli",
      "slug": "cli",
      "title": "Command-Line Interface",
      "entries": [
        {
          "id": "aspect-cli-dirs",
          "sectionId": "section-cli",
          "slug": "cli-dirs",
          "name": "`crush dirs` prints config and data paths with TTY-aware formatting",
          "description": "`internal/cmd/dirs.go` adds the `dirs` command that renders a rounded `lipgloss` table when stdout is a TTY, falling back to plain newline-separated paths otherwise. Nested `config` and `data` subcommands print individual locations, making it easy to script automation around Crush's cache directories.",
          "tags": [
            "cli",
            "cli-runtime",
            "config",
            "filesystem",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/dirs.go",
              "sha256": "46a6fc73fc6946be96dcbf103b55518f22b06d7b92705bcfbcac404a6c1d2573"
            },
            {
              "path": "projects/Crush/internal/config/load.go",
              "sha256": "aa8421a4f444f129d0897660b1817b70e812d6bc654878247d62cb0ec5221f34"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-cli-fang-execute",
          "sectionId": "section-cli",
          "slug": "cli-fang-execute",
          "name": "CLI fang execution wrapper",
          "description": "`Execute` delegates to `fang.Execute` with the cobra root command, injecting `fang.WithVersion(version.Version)` and `fang.WithNotifySignal(os.Interrupt)` so version output and Ctrl+C handling stay consistent across platforms. Fang also manages help/version exits before `RunE` fires.",
          "tags": [
            "cli",
            "cli-runtime"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-cli-logs",
          "sectionId": "section-cli",
          "slug": "cli-logs",
          "name": "`crush logs` tails JSON output with optional follow mode",
          "description": "`internal/cmd/logs.go` resolves `cwd`/`data-dir`, loads config to locate `.crush/logs/crush.log`, and supports `--follow` with tail seeking to continue streaming new entries. It parses structured JSON lines, replays timestamps, sorts metadata keys, and prints warnings when log files are missing, giving users an ergonomic debug surface without leaving the terminal.",
          "tags": [
            "cli",
            "cli-runtime",
            "config",
            "observability",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/logs.go",
              "sha256": "907e0f17d57cc2b4f11e150bddb4e65619d8e5beab12fe287ac73cb292a6963a"
            },
            {
              "path": "projects/Crush/internal/log/log.go",
              "sha256": "373f0bfff11dd59e390b31d1c4fb23e7759dd5df75ded5e76e78a5976d2e39cc"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.5
        },
        {
          "id": "aspect-cli-resolve-cwd",
          "sectionId": "section-cli",
          "slug": "cli-resolve-cwd",
          "name": "CLI working directory resolver",
          "description": "`ResolveCwd` honours the `--cwd/-c` flag by `os.Chdir`-ing before returning the value, falling back to `os.Getwd()` when unset. Errors are wrapped with context so cobra surfaces clear diagnostics, and all downstream config loading operates on the resolved path.",
          "tags": [
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "id": "aspect-cli-root-flags",
          "sectionId": "section-cli",
          "slug": "cli-root-flags",
          "name": "Root command persistent flags",
          "description": "`root.go`'s `init` registers persistent `--cwd`, `--data-dir`, and `--debug` flags along with the `-y/--yolo` runtime flag, ensuring every subcommand inherits environment, cache, and permission controls. Combined with cobra's `PersistentFlags`, setup logic consumes these options in `setupApp`.",
          "tags": [
            "cli",
            "permissions",
            "config"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-cli-run",
          "sectionId": "section-cli",
          "slug": "cli-run",
          "name": "`crush run` pipes stdin into non-interactive sessions",
          "description": "`internal/cmd/run.go` joins prompt args or reads stdin via `MaybePrependStdin`, ensures providers are configured, and reuses `setupApp` before invoking `App.RunNonInteractive`. It exposes a `--quiet` flag to suppress the spinner and returns early when prompts are empty, providing a streamlined path for scripting one-off generations.",
          "tags": [
            "agent",
            "cli",
            "cli-runtime",
            "rendering",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/run.go",
              "sha256": "7cc432e1d7171453fa0411bfa9f755e4882186fdf5f7da260a161ec303483a51"
            },
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.55
        },
        {
          "id": "aspect-cli-schema",
          "sectionId": "section-cli",
          "slug": "cli-schema",
          "name": "Hidden `schema` command emits JSON schema for config tooling",
          "description": "`internal/cmd/schema.go` reflects `config.Config` via `github.com/invopop/jsonschema` and prints the result, providing machine-readable documentation for editors or validation tooling. The command stays hidden from general help output but powers the `task schema` recipe used during release chores.",
          "tags": [
            "cli",
            "cli-runtime",
            "config",
            "schema"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/schema.go",
              "sha256": "573aa2a049e6873cdf4294093ca7522242819d2262112279688b7c295208c062"
            },
            {
              "path": "projects/Crush/internal/config/config.go",
              "sha256": "deb2d8e112ff7cab7783428cc2af45b751908841e4ee9d5b4620953544e37294"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.35
        },
        {
          "id": "aspect-cli-stdin-prepend",
          "sectionId": "section-cli",
          "slug": "cli-stdin-prepend",
          "name": "CLI stdin prompt prepend",
          "description": "`MaybePrependStdin` checks whether stdin is a pipe via `os.ModeNamedPipe`, reads the stream when present, and prefixes it to the prompt text with two newlines so scripted input retains context. Interactive sessions bypass the read, keeping latency low for tty launches.",
          "tags": [
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "id": "aspect-cli-update-providers",
          "sectionId": "section-cli",
          "slug": "cli-update-providers",
          "name": "`crush update-providers` refreshes cached catalogs with stylized feedback",
          "description": "`internal/cmd/update_providers.go` silences default slog output, proxies to `config.UpdateProviders` with optional path/URL arguments (including `embedded`), and renders a Charm-styled success banner. Failures bubble up directly, aligning CLI behavior with config\u2019s caching logic so teams can refresh provider lists outside of runtime start.",
          "tags": [
            "cli",
            "cli-runtime",
            "config",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/update_providers.go",
              "sha256": "fc681f83e5137c0970098d6d3683739e50ce892248dc5ce9e840d0703bb79bb9"
            },
            {
              "path": "projects/Crush/internal/config/provider.go",
              "sha256": "743106292f4f369ab0b89ca7dba731d2b4ce05628c60daa3362c02fb58ad6d15"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.52
        },
        {
          "id": "aspect-cli-version-heartbeat",
          "sectionId": "section-cli",
          "slug": "cli-version-heartbeat",
          "name": "CLI version heartbeat banner",
          "description": "`Execute` detects interactive terminals and uses `colorprofile.NewWriter` to paint the ASCII heart stored in `heartbit`, forwarding through a buffer so `SetVersionTemplate` combines the banner with cobra's template. Non-interactive runs skip the colour work to avoid polluting scripting output.",
          "tags": [
            "cli",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "id": "aspect-create-dot-crush",
          "sectionId": "section-cli",
          "slug": "create-dot-crush",
          "name": "createDotCrushDir scaffolds the data directory and gitignore",
          "description": "`internal/cmd/root.go`'s `createDotCrushDir` ensures the data directory exists with `0700` permissions and writes a `.gitignore` containing `*` when absent. It runs during `setupApp` so both interactive and non-interactive modes keep generated history and logs out of source control.",
          "tags": [
            "cli",
            "cli-runtime",
            "config",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            },
            {
              "path": "projects/Crush/internal/config/init.go",
              "sha256": "7edbbda2c55eaf21f3f40ff47a5284ae56d1fb25e9c9f081f580198d101fbf55"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        }
      ]
    },
    {
      "id": "section-automation",
      "slug": "automation",
      "title": "Automation and Ops",
      "entries": [
        {
          "id": "aspect-automation-build-pipeline",
          "sectionId": "section-automation",
          "slug": "automation-build-pipeline",
          "name": "Build workflow reuses Charm meta template with go.mod version",
          "description": "`.github/workflows/build.yml` delegates to `charmbracelet/meta`'s build workflow, letting the shared template derive the Go toolchain from `go.mod` while authenticating with a personal access token for private modules. This keeps CI builds aligned with local versions without duplicating steps.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/workflows/build.yml",
              "sha256": "0cd3b7e92e6c476b2d9d90a5e7147497ded13832dc7eecbdb6bb53ab9bb49b12"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.4
        },
        {
          "id": "aspect-automation-cla-workflow",
          "sectionId": "section-automation",
          "slug": "automation-cla-workflow",
          "name": "CLA workflow listens to PR events and 'recheck' comments",
          "description": "`.github/workflows/cla.yml` runs `contributor-assistant/github-action@v2.6.1` on `pull_request_target` and issue comments, gated by an allowlist and authenticated with `PERSONAL_ACCESS_TOKEN`. It honours the 'I have read the CLA' and 'recheck' phrases, signs commits with a chore message, and stores signatures in `.github/cla-signatures.json` while leaving merged PRs unlocked.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/workflows/cla.yml",
              "sha256": "79a5243fc4c31b607aa928a54ced0d962c6057acf4223e4c03c8f2a52bf8d3c9"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.45
        },
        {
          "id": "aspect-automation-dependabot-config",
          "sectionId": "section-automation",
          "slug": "automation-dependabot-config",
          "name": "Dependabot batches Go modules and actions every Monday",
          "description": "`.github/dependabot.yml` schedules weekly updates at 05:00 America/New_York for both `gomod` and `github-actions`, labeling PRs as `area: dependencies`, grouping all bumps into a single cohort, and skipping the Bubble Tea/Lip Gloss beta tags while generating `chore(scope):` commit messages.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/dependabot.yml",
              "sha256": "3245fcc9d2f2e2b1f70fae5ff927e6b959d3f083550feca60e44b67375feebf4"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.42
        },
        {
          "id": "aspect-automation-goreleaser-config",
          "sectionId": "section-automation",
          "slug": "automation-goreleaser-config",
          "name": "GoReleaser config builds multi-platform artifacts and completions",
          "description": "`.goreleaser.yml` includes Charm's notarization workflow, tidies modules, generates completions/manpages before builds, and produces binaries for the major OS/arch matrix with CGO disabled. It drives AUR, Homebrew, Scoop, and Gemfury publishing, using env-injected tokens and nightly templates so tagged releases and nightly channels share a single definition.",
          "tags": [
            "automation",
            "distribution"
          ],
          "sources": [
            {
              "path": "projects/Crush/.goreleaser.yml",
              "sha256": "f9c76f589ed8a8015b11fd842a03e83de3486e141804d0ad503d0d81336520e2"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.52
        },
        {
          "id": "aspect-automation-labeler-config",
          "sectionId": "section-automation",
          "slug": "automation-labeler-config",
          "name": "Labeler config maps regexes to area/os/provider labels",
          "description": "`.github/labeler.yml` keeps one pattern per label, covering areas (CI, diff, onboarding), operating systems, and provider names so the workflow applies a label when any single regex matches. Comments document why duplicates are avoided\u2014GitHub's action requires all patterns to match when multiple rules are present\u2014and the expressions catch common spellings across issues and PRs.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/labeler.yml",
              "sha256": "25b7a471d5a9dfc6559b093cc4238361f28c91c1d7931235c45eebb00598533b"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.4
        },
        {
          "id": "aspect-automation-lint-pipeline",
          "sectionId": "section-automation",
          "slug": "automation-lint-pipeline",
          "name": "Lint workflow pins golangci setup through meta lint job",
          "description": "`.github/workflows/lint.yml` invokes the shared lint workflow, pointing it at `.golangci.yml`, forcing `golangci-lint` v2.4, and setting a 10-minute timeout. Using the template keeps CLI and CI lint behaviour in lockstep.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/workflows/lint.yml",
              "sha256": "762b3b54b671f347d80aaea4f5a1a704f93d6fffa674677be30bacc174559c75"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.38
        },
        {
          "id": "aspect-automation-lint-sync",
          "sectionId": "section-automation",
          "slug": "automation-lint-sync",
          "name": "Lint-sync workflow is manual-only with write-scoped permissions",
          "description": "`.github/workflows/lint-sync.yml` exposes a `workflow_dispatch` entry point and grants contents/pull-request write scopes before delegating to the meta lint-sync workflow. It enables maintainers to sync golangci linters or configs without full CI automation.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/workflows/lint-sync.yml",
              "sha256": "45904c22326324de633031c78f515f20f30e307610614c855061ede623ce42e9"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.32
        },
        {
          "id": "aspect-automation-nightly-gate",
          "sectionId": "section-automation",
          "slug": "automation-nightly-gate",
          "name": "Nightly workflow checks for prior runs before triggering meta job",
          "description": "`.github/workflows/nightly.yml` runs a guard job that uses `gh run list` against the current commit to skip reruns when a nightly already succeeded. Only when `should_run` is true does it call the shared nightly workflow with release credentials, preventing duplicate artifacts.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/workflows/nightly.yml",
              "sha256": "a5eff41976effbfd9a8ccf6c97db6006f9b3e5e4b164b737742a165f75552875"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.5
        },
        {
          "id": "aspect-automation-release-goreleaser",
          "sectionId": "section-automation",
          "slug": "automation-release-goreleaser",
          "name": "Release workflow fans secrets into meta goreleaser pipeline",
          "description": "`.github/workflows/release.yml` listens for semantic version tags, serialises runs via a `goreleaser` concurrency group, and calls the shared goreleaser workflow with macOS signing entitlements. It wires Docker, npm, Snap, AUR, and mac notarization secrets so the template can publish every artifact.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/workflows/release.yml",
              "sha256": "9f3c9002abbbb60d642b09d40c306202411449d4aa916bc49afd70874cf792f3"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.62
        },
        {
          "id": "aspect-automation-schema-update",
          "sectionId": "section-automation",
          "slug": "automation-schema-update",
          "name": "Schema-update workflow regenerates schema.json on config changes",
          "description": "`.github/workflows/schema-update.yml` watches `internal/config/**`, runs `go run . schema > schema.json`, and uses git-auto-commit-action to push the regenerated artifact back to main. This keeps the published config schema in sync with code without manual steps. Referencing the generated `schema.json` clarifies the output the workflow maintains, tying the automation directly to the artifact developers consume.",
          "tags": [
            "automation",
            "schema"
          ],
          "sources": [
            {
              "path": "projects/Crush/.github/workflows/schema-update.yml",
              "sha256": "4f48493e25a4ed6194c4309cb95819202ff9cb10336ab5902fbdadfdd847b1e4"
            },
            {
              "path": "projects/Crush/schema.json",
              "sha256": "3f7ac51a48af1f004afd1a6680e14498db6112d846e3d6046e18047faf4ead8e"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.6
        },
        {
          "id": "aspect-diffview-taskfile",
          "sectionId": "section-automation",
          "slug": "diffview-taskfile",
          "name": "DiffView Taskfile drives golden maintenance",
          "description": "`internal/tui/exp/diffview/Taskfile.yaml` defines `test`, `test:update`, and a matrix of `test:print:*` tasks to run the experimental diffview tests and dump golden files by width, height, and offsets. The workflow keeps snapshot fixtures fresh and gives engineers quick loops for debugging ANSI output.",
          "tags": [
            "automation",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/Taskfile.yaml",
              "sha256": "3a944235d2aecf78a14efacfe2730da0d9477c3e2342a2723263a657205aac34"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.33
        },
        {
          "id": "aspect-run-labeler",
          "sectionId": "section-automation",
          "slug": "run-labeler",
          "name": "GitHub CLI script replays labeler workflow across issues and PRs",
          "description": "`scripts/run-labeler.sh` enumerates all issues and PRs via `gh` JSON queries, then dispatches the `labeler.yml` workflow for each number. This bulk tool lets maintainers retroactively apply labeling logic without manual clicks, ensuring the automation covers historical threads. The paired `.github/labeler.yml` keeps one regex per label (areas, OSes, providers, security) so the action only applies labels when a single pattern matches, avoiding accidental multi-condition requirements.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/scripts/run-labeler.sh",
              "sha256": "3af1f1028986ba33cec5f4d768b132504982ec542282b1339371b4159f18ce87"
            },
            {
              "path": "projects/Crush/.github/labeler.yml",
              "sha256": "25b7a471d5a9dfc6559b093cc4238361f28c91c1d7931235c45eebb00598533b"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.3
        },
        {
          "id": "aspect-taskfile",
          "sectionId": "section-automation",
          "slug": "taskfile",
          "name": "Taskfile codifies lint, test, profiling, and release workflows",
          "description": "`Taskfile.yaml` pins `GOEXPERIMENT` defaults, installs golangci-lint with go1.25, and exposes tasks for lint, fmt, build, run, dev (with `CRUSH_PROFILE`), schema generation, and profiling via pprof. The release flow gates execution on a clean main branch, bumps versions with `svu`, and pushes annotated tags, making repeatable operations a single task invocation.",
          "tags": [
            "automation"
          ],
          "sources": [
            {
              "path": "projects/Crush/Taskfile.yaml",
              "sha256": "5b04f5989160b8c11daba570725afb5d5a9a826f995a88e91922966f09f2b31b"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.45
        }
      ]
    },
    {
      "id": "section-observability",
      "slug": "observability",
      "title": "Observability",
      "entries": [
        {
          "id": "aspect-app-duration-flush",
          "sectionId": "section-observability",
          "slug": "app-duration-flush",
          "name": "AppExited reports session duration then flushes PostHog",
          "description": "`internal/event/all.go` tracks `appStartTime`, publishing a human-readable and numeric duration when the app exits before calling `Flush`, so telemetry always captures shutdown metrics and ensures queued events are delivered.",
          "tags": [
            "eventing",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/all.go",
              "sha256": "21dfe17370ea51186d7bbb1c90737f06644c6c065121f1aff19820c1db6154f0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.54
        },
        {
          "id": "aspect-distinct-id",
          "sectionId": "section-observability",
          "slug": "distinct-id",
          "name": "Distinct ID derivation hashes machine identity with fallbacks",
          "description": "`internal/event/identifier.go` first tries `machineid.ProtectedID(\"charm\")` for a stable telemetry identifier, then hashes the first active MAC address with HMAC-SHA256, and finally falls back to `unknown`. The helper keeps PostHog events pseudonymous while still providing a durable distinct ID.",
          "tags": [
            "eventing",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/identifier.go",
              "sha256": "f1b3108e8ac8cc01e3ba8d2ffc42b7f47d5a368bda00f72fb965a67f1e469c8a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-event-filepicker-opened",
          "sectionId": "section-observability",
          "slug": "event-filepicker-opened",
          "name": "File picker telemetry",
          "description": "`FilePickerOpened` wraps a simple `send(\"filepicker opened\")`, giving the UI a single call site to report when users browse the filesystem. Coupled with prompt sent/responded events, this helps correlate tool usage with manual file uploads in telemetry dashboards.",
          "tags": [
            "observability",
            "eventing",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/all.go",
              "sha256": "21dfe17370ea51186d7bbb1c90737f06644c6c065121f1aff19820c1db6154f0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-event-prompt-tracking",
          "sectionId": "section-observability",
          "slug": "event-prompt-tracking",
          "name": "Prompt telemetry hooks",
          "description": "`PromptSent` and `PromptResponded` in `internal/event/all.go` call `send` with arbitrary key/value pairs, letting callers include model, provider, or latency metadata. By fusing these props with the shared `baseProps`, Crush records both context and prompt lifecycle without duplicating boilerplate at call sites.",
          "tags": [
            "observability",
            "eventing",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/all.go",
              "sha256": "21dfe17370ea51186d7bbb1c90737f06644c6c065121f1aff19820c1db6154f0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "id": "aspect-event-session-lifecycle",
          "sectionId": "section-observability",
          "slug": "event-session-lifecycle",
          "name": "Session lifecycle telemetry",
          "description": "`internal/event/all.go` exposes `SessionCreated`, `SessionDeleted`, and `SessionSwitched`, each calling `send` with distinct event names so PostHog captures session churn alongside the base properties configured in `event.Init`. The helpers sit alongside the session service, ensuring telemetry stays in lockstep with database updates.",
          "tags": [
            "observability",
            "eventing",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/all.go",
              "sha256": "21dfe17370ea51186d7bbb1c90737f06644c6c065121f1aff19820c1db6154f0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-event-token-usage",
          "sectionId": "section-observability",
          "slug": "event-token-usage",
          "name": "Token usage telemetry",
          "description": "`TokensUsed` forwards arbitrary analytics pairs through `send(\"tokens used\", props...)`, allowing agent code to record prompt/completion token counts that PostHog can aggregate. The helper keeps token reporting consistent with other lifecycle events while inheriting the shared environment context.",
          "tags": [
            "observability",
            "eventing",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/all.go",
              "sha256": "21dfe17370ea51186d7bbb1c90737f06644c6c065121f1aff19820c1db6154f0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "id": "aspect-http-log-tests",
          "sectionId": "section-observability",
          "slug": "http-log-tests",
          "name": "HTTP logger tests redact secrets and log failures",
          "description": "`internal/log/http_test.go` routes requests through `NewHTTPClient` against an httptest server returning 500s to confirm the transport logs structured errors without choking on JSON bodies. It also checks `formatHeaders` redacts `Authorization` and API keys while preserving innocuous headers for diagnostics.",
          "tags": [
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/log/http_test.go",
              "sha256": "794f494aff411f1511ee48acacd5e7fd9011aee00bc71efd7ad6079e4b5a7a05"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.34
        },
        {
          "id": "aspect-http-logging",
          "sectionId": "section-observability",
          "slug": "http-logging",
          "name": "HTTP round trip logger redacts secrets and measures latency",
          "description": "`internal/log/http.go` wraps the default transport to log request and response payloads when debug logging is enabled, draining bodies safely so upstream callers can still read them. It redacts common secret headers, pretty-prints JSON bodies, and records duration in milliseconds, giving engineers insight into provider traffic without leaking credentials.",
          "tags": [
            "cli-runtime",
            "llm",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/log/http.go",
              "sha256": "a48dcc0dd4e0dc8ed63e974db012072b72bb978d7d858d8fe0a8e254a845ebf9"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.5
        },
        {
          "id": "aspect-logging-setup",
          "sectionId": "section-observability",
          "slug": "logging-setup",
          "name": "Slog setup rotates JSON logs and captures panics",
          "description": "`internal/log/log.go` configures a lumberjack logger under `.crush/logs`, toggles debug level based on config, and installs panic recovery that logs to PostHog and writes timestamped panic files. Cleanup hooks integrate with the app so panic handlers can shut down gracefully while preserving stack traces for diagnostics.",
          "tags": [
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/log/log.go",
              "sha256": "373f0bfff11dd59e390b31d1c4fb23e7759dd5df75ded5e76e78a5976d2e39cc"
            },
            {
              "path": "projects/Crush/internal/event/event.go",
              "sha256": "f235255dec6ac1a6de0bef38c6c39f69b1d97c20dcb9103d672034cf62dcd12e"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.6
        },
        {
          "id": "aspect-metrics-guard",
          "sectionId": "section-observability",
          "slug": "metrics-guard",
          "name": "Metrics guard respects opt-out environment variables and config",
          "description": "`internal/cmd/root.go`'s `shouldEnableMetrics` short-circuits when `CRUSH_DISABLE_METRICS`, `DO_NOT_TRACK`, or `Options.DisableMetrics` are true, skipping `event.Init()`. It lets CI, privacy-conscious users, and workspace settings disable telemetry without code changes.",
          "tags": [
            "cli-runtime",
            "config",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/cmd/root.go",
              "sha256": "54017443a859b0387bd13a07b8b12a6c94a951d1095aa6ab5d147cf1e531329e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-posthog-base-props",
          "sectionId": "section-observability",
          "slug": "posthog-base-props",
          "name": "Telemetry baseProps capture runtime and shell metadata",
          "description": "`internal/event/event.go` populates `baseProps` with GOOS, GOARCH, terminal, shell, version, and Go runtime details so every captured event includes consistent environment context without repeating that data at call sites.",
          "tags": [
            "eventing",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/event.go",
              "sha256": "f235255dec6ac1a6de0bef38c6c39f69b1d97c20dcb9103d672034cf62dcd12e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-posthog-error-wrapper",
          "sectionId": "section-observability",
          "slug": "posthog-error-wrapper",
          "name": "Error helper mimics PostHog exception payloads",
          "description": "`internal/event/event.go`'s `Error` function appends a `$exception_list` with type and value before sending `$exception`, ensuring PostHog recognizes Crush errors as stacktrace events even though the Go SDK lacks native exception support.",
          "tags": [
            "eventing",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/event.go",
              "sha256": "f235255dec6ac1a6de0bef38c6c39f69b1d97c20dcb9103d672034cf62dcd12e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-telemetry-distinct-id",
          "sectionId": "section-observability",
          "slug": "telemetry-distinct-id",
          "name": "Telemetry distinct ID hashes machine identifiers with HMAC fallback",
          "description": "`internal/event/identifier.go` tries `machineid.ProtectedID` for a stable per-machine identifier and falls back to hashing MAC addresses with HMAC-SHA256 using a Charm key. If no MAC is found it emits `unknown`, ensuring PostHog receives consistent but anonymized `distinctId` values across restarts.",
          "tags": [
            "eventing",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/event/identifier.go",
              "sha256": "f1b3108e8ac8cc01e3ba8d2ffc42b7f47d5a368bda00f72fb965a67f1e469c8a"
            }
          ],
          "lastUpdated": "2025-10-15",
          "importance": 0.5
        }
      ]
    },
    {
      "id": "section-lsp",
      "slug": "lsp",
      "title": "Language Servers",
      "entries": [
        {
          "id": "aspect-lsp-apply-text-edits",
          "sectionId": "section-lsp",
          "slug": "lsp-apply-text-edits",
          "name": "Apply edit handler routes workspace edits through util.ApplyWorkspaceEdit",
          "description": "`HandleApplyEdit` decodes `ApplyWorkspaceEditParams`, calls `util.ApplyWorkspaceEdit`, and responds with the failure reason when applying the edit set fails, letting the server know whether edits stuck.",
          "tags": [
            "filesystem",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/util/edit.go",
              "sha256": "3d112c4dcb16b9cf35c51850a7a8610d543488fd71a37d9bd2dff2d5e4abd095"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "id": "aspect-lsp-client-bootstrap",
          "sectionId": "section-lsp",
          "slug": "lsp-client-bootstrap",
          "name": "LSP client bootstrap resolves commands and seeds powernap config",
          "description": "`lsp.New` resolves the launch command through the config resolver, applies `home.Long`, seeds workspace folders, and preallocates `VersionedMap` caches for diagnostics before storing the starting state.",
          "tags": [
            "architecture",
            "lsp",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/lsp.go",
              "sha256": "539ca0ea5633371ba59d819b9cf3ecc3e82bd4ce9d0d0e1dc9649377084d9b11"
            },
            {
              "path": "projects/Crush/internal/app/lsp_events.go",
              "sha256": "e4d026ec6629076c7282ac8982c24c0737a1a000d078e0719143d5c4f8502800"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.68
        },
        {
          "id": "aspect-lsp-client-config",
          "sectionId": "section-lsp",
          "slug": "lsp-client-config",
          "name": "Client init enforces root markers and wires diagnostics callbacks",
          "description": "`createAndStartLSPClient` skips disabled servers without root markers, sets `updateLSPState` transitions, instantiates the client, and registers `updateLSPDiagnostics` so state and counts stay in sync.",
          "tags": [
            "config",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/client.go",
              "sha256": "fad9a4d76cd9ce2810fca428c97c061411e31a7b9d56aa430967b6a6f6dc452d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-lsp-client-tests",
          "sectionId": "section-lsp",
          "slug": "lsp-client-tests",
          "name": "LSP client test wires dummy command smoke",
          "description": "`internal/lsp/client_test.go` initialises the LSP client with a dummy `$THE_CMD` resolved via the env resolver, verifying name reporting, `HandlesFile` filtering, and server state setters. It attempts `Close` on the fake process and skips gracefully when the echo command cannot start, proving the wrapper tolerates minimal configs.",
          "tags": [
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/client_test.go",
              "sha256": "7cff4332a516cea43d139c0eddfbadb0648b02f5d994ff1c335035363f5a4d4a"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.33
        },
        {
          "id": "aspect-lsp-diagnostics-cache",
          "sectionId": "section-lsp",
          "slug": "lsp-diagnostics-cache",
          "name": "Diagnostics handler caches per-URI results and totals counts",
          "description": "`HandleDiagnostics` decodes `PublishDiagnosticsParams`, stores entries in the client\u2019s `VersionedMap`, recomputes the total issue count, and invokes the registered callback to update UI badges.",
          "tags": [
            "concurrency",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/handlers.go",
              "sha256": "ec235127b7f93dead6aeae3f3165a9b47a9bdf42330b97b11ef80743762e4696"
            },
            {
              "path": "projects/Crush/internal/lsp/client.go",
              "sha256": "fad9a4d76cd9ce2810fca428c97c061411e31a7b9d56aa430967b6a6f6dc452d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-lsp-language-detection",
          "sectionId": "section-lsp",
          "slug": "lsp-language-detection",
          "name": "Language detector maps extensions to protocol language kinds",
          "description": "`DetectLanguageID` lowercases filenames, normalises extensions, and returns the matching `protocol.LanguageKind`, falling back to an empty kind when the suffix is unknown.",
          "tags": [
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/language.go",
              "sha256": "fede9930c957d1d21a2c20f6c27e0114fc2f67260e4ef946e04838f868e627fc"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.4
        },
        {
          "id": "aspect-lsp-notify-change",
          "sectionId": "section-lsp",
          "slug": "lsp-notify-change",
          "name": "NotifyChange increments LSP document versions before sending diffs",
          "description": "`Client.NotifyChange` reads the file, ensures it is tracked, bumps the cached version, wraps the whole document in a change event, and calls `NotifyDidChangeTextDocument`.",
          "tags": [
            "filesystem",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/client.go",
              "sha256": "fad9a4d76cd9ce2810fca428c97c061411e31a7b9d56aa430967b6a6f6dc452d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-lsp-open-files",
          "sectionId": "section-lsp",
          "slug": "lsp-open-files",
          "name": "OpenFile loads content, notifies the server, and tracks versions",
          "description": "`Client.OpenFile` verifies the file matches configured extensions, reads its contents, sends `textDocument/didOpen`, and stores the URI with version metadata in a `csync.Map`.",
          "tags": [
            "filesystem",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/client.go",
              "sha256": "fad9a4d76cd9ce2810fca428c97c061411e31a7b9d56aa430967b6a6f6dc452d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-lsp-server-messages",
          "sectionId": "section-lsp",
          "slug": "lsp-server-messages",
          "name": "Debug logging surfaces LSP server messages and file watchers",
          "description": "`HandleServerMessage` respects `Options.DebugLSP`, decoding `ShowMessage` payloads into leveled `slog` entries, while registration handlers capture watched file patterns for later notifications.",
          "tags": [
            "lsp",
            "observability"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/handlers.go",
              "sha256": "ec235127b7f93dead6aeae3f3165a9b47a9bdf42330b97b11ef80743762e4696"
            },
            {
              "path": "projects/Crush/internal/config/config.go",
              "sha256": "deb2d8e112ff7cab7783428cc2af45b751908841e4ee9d5b4620953544e37294"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-lsp-state-events",
          "sectionId": "section-lsp",
          "slug": "lsp-state-events",
          "name": "LSP event broker stores client info and publishes state changes",
          "description": "`internal/app/lsp_events.go` tracks `LSPClientInfo` in a `csync.Map`, stamps `ConnectedAt` when servers reach ready, and pushes `LSPEvent` updates through a `pubsub` broker for the TUI.",
          "tags": [
            "lsp",
            "pubsub",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/lsp_events.go",
              "sha256": "e4d026ec6629076c7282ac8982c24c0737a1a000d078e0719143d5c4f8502800"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-lsp-wait-for-ready",
          "sectionId": "section-lsp",
          "slug": "lsp-wait-for-ready",
          "name": "WaitForServerReady polls powernap client status with timeout",
          "description": "`Client.WaitForServerReady` wraps the ready loop in a 30-second context, logging when debug LSP is enabled and marking the server state based on whether the ping succeeded.",
          "tags": [
            "concurrency",
            "lsp"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/client.go",
              "sha256": "fad9a4d76cd9ce2810fca428c97c061411e31a7b9d56aa430967b6a6f6dc452d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-rootmarkers-tests",
          "sectionId": "section-lsp",
          "slug": "rootmarkers-tests",
          "name": "Root marker tests cover globs and defaults",
          "description": "`internal/lsp/rootmarkers_test.go` writes temporary files to confirm `HasRootMarkers` treats empty lists as matches, recognises concrete markers like `go.mod`, and honours glob patterns such as `*.mod`. Negative cases ensure absent markers keep servers disabled until the workspace is ready.",
          "tags": [
            "lsp",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/lsp/rootmarkers_test.go",
              "sha256": "3c87384aab02908e76a5ecb5d22a66d4f175f2edd338085df54f2cdbd46bc334"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.32
        }
      ]
    },
    {
      "id": "section-concurrency",
      "slug": "concurrency",
      "title": "Concurrency Utilities",
      "entries": [
        {
          "id": "aspect-app-event-cleanup",
          "sectionId": "section-concurrency",
          "slug": "app-event-cleanup",
          "name": "App subscriber cleanup cancels contexts and waits on goroutines",
          "description": "`internal/app/app.go` registers a cleanup that cancels the fan-in context, waits on `serviceEventsWG`, and relies on the `cleanupFuncs` stack to unwind database handles and the TUI worker after `Subscribe` exits. The guard sits alongside `log.RecoverPanic`, so even UI panics trigger `program.Quit` and still drain the goroutines before shutdown completes.",
          "tags": [
            "concurrency",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-app-subscriber-backpressure",
          "sectionId": "section-concurrency",
          "slug": "app-subscriber-backpressure",
          "name": "setupSubscriber warns on slow consumers and respects cancellation",
          "description": "`setupSubscriber` spins a goroutine per service subscription, forwarding events into the shared `app.events` queue and using a two-second `time.After` to detect slow consumers. When the TUI cannot keep up it logs a warning and drops the message, and context cancellation logs a debug line before the worker returns.",
          "tags": [
            "concurrency",
            "tui",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-app-tui-forwarder",
          "sectionId": "section-concurrency",
          "slug": "app-tui-forwarder",
          "name": "TUI forwarder drains app events and exits cleanly",
          "description": "`App.Subscribe` loops on the buffered `app.events` channel, forwarding each payload into `program.Send` until the channel closes or the context cancels. It adds a cleanup hook that calls `tuiCancel` and waits on `tuiWG`, ensuring the Bubble Tea handler exits before shutdown proceeds.",
          "tags": [
            "concurrency",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-csync-map",
          "sectionId": "section-concurrency",
          "slug": "csync-map",
          "name": "csync.Map offers RW-locked maps with lazy loaders and JSON adapters",
          "description": "`internal/csync/maps.go` wraps a Go map with RWMutexes, exposes helpers like `GetOrSet`, `Take`, and `Seq2`, and supports lazy initialisation via `NewLazyMap` (which populates data in a goroutine). It also implements `json.Marshaler`/`Unmarshaler` so config structures can persist the concurrent map safely.",
          "tags": [
            "architecture",
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/csync/maps.go",
              "sha256": "31d7c1e87b05c9c73e2b6dab444e4acd7c3a46d549adb217959520ae089462ad"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-csync-map-tests",
          "sectionId": "section-concurrency",
          "slug": "csync-map-tests",
          "name": "csync map tests cover lazy loads and iteration",
          "description": "`internal/csync/maps_test.go` drives `NewMap`, `NewMapFrom`, and `NewLazyMap` under `synctest.Test`, locking a loader so concurrent readers prove the lazy branch executes once. It exercises `Reset`, `GetOrSet`, `Take`, and both `Seq` variants, ensuring the concurrent map mirrors Go semantics without races or dropped entries.",
          "tags": [
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/csync/maps_test.go",
              "sha256": "ac93a2f169d608c922a230b963238876bb22bac3a1befe2942d2b45331f64460"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.38
        },
        {
          "id": "aspect-csync-slice",
          "sectionId": "section-concurrency",
          "slug": "csync-slice",
          "name": "csync slice utilities provide locked appends and lazy population",
          "description": "`internal/csync/slices.go` provides a locked Slice with `Append`, `Prepend`, `Delete`, `Set`, and iterator helpers plus a `LazySlice` that runs the loader under a `sync.WaitGroup.Go` and blocks `Seq` until data arrives. The copy-on-iterate design avoids holding locks while consumers traverse the collection.",
          "tags": [
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/csync/slices.go",
              "sha256": "7cbd0c31f4723f9c76f270ac25670cbb7dc4214770f05a0f8ec1f0d847e312f9"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.38
        },
        {
          "id": "aspect-csync-slice-tests",
          "sectionId": "section-concurrency",
          "slug": "csync-slice-tests",
          "name": "Lazy slice tests guarantee loader gating",
          "description": "`internal/csync/slices_test.go` uses `synctest.Test` to show `NewLazySlice` blocks until its supplier finishes and still allows early breaks. Table-driven cases cover `Append`, `Prepend`, `Delete`, `Get`, and `SetSlice`, confirming the concurrency wrapper copies backing data, guards bounds, and keeps length accounting consistent.",
          "tags": [
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/csync/slices_test.go",
              "sha256": "5212d53e24547ce0f491f6e77c837985142eef869980fbd611bcfc3e183529f9"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.36
        },
        {
          "id": "aspect-csync-versioned-map",
          "sectionId": "section-concurrency",
          "slug": "csync-versioned-map",
          "name": "VersionedMap tracks mutation counters for cheap change detection",
          "description": "`VersionedMap` composes a `Map` with an `atomic.Uint64` counter, bumping the version on every `Set` or `Del` and exposing it through `Version()`. Callers can poll the number to detect changes while still using familiar `Get`, `Len`, and `Seq2` helpers for access.",
          "tags": [
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/csync/versionedmap.go",
              "sha256": "eb37937a10bb1e5ad934793e6f7f5762a0697d6c1b6b60029e25df6d06438ff4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-csync-versionedmap-tests",
          "sectionId": "section-concurrency",
          "slug": "csync-versionedmap-tests",
          "name": "Versioned map tests enforce monotonic counters",
          "description": "`internal/csync/versionedmap_test.go` asserts every `Set` and `Del` bumps the version number, even when deleting missing keys, and that lookups reflect the latest value. A high-concurrency loop spawns 100 goroutines issuing paired sets and deletes, validating the counter surpasses the expected minimum while the map drains cleanly.",
          "tags": [
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/csync/versionedmap_test.go",
              "sha256": "0db1f38ba92f633db1f63baae2cadb10738ef1ddd46c8c4d560e878b4cfd56de"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.38
        },
        {
          "id": "aspect-history-retry-loop",
          "sectionId": "section-concurrency",
          "slug": "history-retry-loop",
          "name": "History retry loop handles UNIQUE conflicts when inserting versions",
          "description": "`internal/history/file.go`'s `createWithVersion` retries up to three times: it opens a transaction, attempts the insert, and on `UNIQUE constraint failed` bumps the version before replaying. Successful commits publish a Created event via the history broker, keeping concurrent tool writes consistent even under contention.",
          "tags": [
            "concurrency",
            "history",
            "database"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/history/file.go",
              "sha256": "cc940356f6dfd073795c6f5d7e559467d4e5140da6a51c9b5ac43c097075e392"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-permission-request-serialization",
          "sectionId": "section-concurrency",
          "slug": "permission-request-serialization",
          "name": "Permission request mutex enforces one active prompt at a time",
          "description": "`permission.Service.Request` acquires `requestMu` before examining allowlists and cached grants, sets `activeRequest`, and only releases the lock after the goroutine registers its `pendingRequests` channel. Grants or denials clear the pointer and wake the waiter, ensuring the UI never interleaves prompts or leaves older requests dangling.",
          "tags": [
            "concurrency",
            "permissions"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/permission/permission.go",
              "sha256": "e071d511a807928f117c8012cdc438220d4e3b84fa5554dabbfdffe252e2403f"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "sectionId": "section-concurrency",
          "id": "aspect-pubsub-context-unsubscribe",
          "slug": "pubsub-context-unsubscribe",
          "name": "Pubsub.Subscribe tears down channels when the context closes",
          "description": "`internal/pubsub/broker.go` spawns a goroutine per subscriber that waits on `ctx.Done`, then grabs the lock, drops the channel from the map, closes it, and decrements `subCount`. The guard against `b.done` prevents double-closing during broker shutdown.",
          "tags": [
            "concurrency",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/pubsub/broker.go",
              "sha256": "99fd3c3e7aefb1b49b8e86412cb0b8ba359c757602751d7c183f341d5b43919d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "sectionId": "section-concurrency",
          "id": "aspect-pubsub-nonblocking-publish",
          "slug": "pubsub-nonblocking-publish",
          "name": "Publish clones subscriber list to avoid holding write locks",
          "description": "`Publish` takes an `RLock`, snapshots the subscriber channels into a slice, releases the lock, and then iterates sending events with a non-blocking select that skips slow consumers. This design keeps producers from stalling while still letting fast subscribers drain the buffered channels.",
          "tags": [
            "concurrency",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/pubsub/broker.go",
              "sha256": "99fd3c3e7aefb1b49b8e86412cb0b8ba359c757602751d7c183f341d5b43919d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "sectionId": "section-concurrency",
          "id": "aspect-pubsub-shutdown",
          "slug": "pubsub-shutdown",
          "name": "Broker.Shutdown closes the done channel and every subscriber",
          "description": "Calling `Shutdown` closes the `done` channel exactly once, then under a write lock iterates the subscriber map, deletes each entry, and closes the channel. Resetting `subCount` to zero ensures subsequent `GetSubscriberCount` calls reflect the drained state.",
          "tags": [
            "concurrency",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/pubsub/broker.go",
              "sha256": "99fd3c3e7aefb1b49b8e86412cb0b8ba359c757602751d7c183f341d5b43919d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "sectionId": "section-concurrency",
          "id": "aspect-pubsub-subscriber-count",
          "slug": "pubsub-subscriber-count",
          "name": "GetSubscriberCount reads the live total under an RLock",
          "description": "`GetSubscriberCount` acquires the read lock before returning the current `subCount`, giving diagnostics a thread-safe way to observe how many consumers are attached to a broker.",
          "tags": [
            "concurrency",
            "pubsub"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/pubsub/broker.go",
              "sha256": "99fd3c3e7aefb1b49b8e86412cb0b8ba359c757602751d7c183f341d5b43919d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        }
      ]
    },
    {
      "id": "section-database",
      "slug": "database",
      "title": "Database Internals",
      "entries": [
        {
          "id": "aspect-files-latest-join",
          "sectionId": "section-database",
          "slug": "files-latest-join",
          "name": "ListLatestSessionFiles joins aggregate to dedupe paths",
          "description": "The `ListLatestSessionFiles` query in `internal/db/sql/files.sql` joins the files table with a subselect computing `MAX(version)` and `MAX(created_at)` per path, ensuring the result set holds exactly the newest version of each file for a session. This powers UI overlays that need a current working set without scanning every historical revision.",
          "tags": [
            "database",
            "history",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sql/files.sql",
              "sha256": "ec9e0cc9d1fbadbd9a35989f56b88c8505a83eaf0b54721ba85e3956ec709d23"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-files-version-ordering",
          "sectionId": "section-database",
          "slug": "files-version-ordering",
          "name": "File queries sort versions and timestamps deterministically",
          "description": "`internal/db/sql/files.sql` orders `ListFilesBySession` ascending by version/created time and `ListFilesByPath` descending, guaranteeing deterministic history when reconstructing session state. The ordering conventions let history viewers show chronological progressions while diffing tools grab the newest copy first.",
          "tags": [
            "database",
            "history",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sql/files.sql",
              "sha256": "ec9e0cc9d1fbadbd9a35989f56b88c8505a83eaf0b54721ba85e3956ec709d23"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "id": "aspect-goose-embedded-migrations",
          "sectionId": "section-database",
          "slug": "goose-embedded-migrations",
          "name": "Embedded goose migrations bootstrap schema on start",
          "description": "`internal/db/connect.go` configures Goose with `goose.SetBaseFS(FS)` from `internal/db/embed.go`, pins the sqlite dialect, and executes `goose.Up` against the embedded `migrations/` directory once the connection is verified. This flow keeps schema creation and upgrades bundled with the binary so new installations reach the latest schema without external tooling.",
          "tags": [
            "database",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/connect.go",
              "sha256": "fa45f5ef2272863b452837dccc253c7bb6ba75728474893a0e5345122fb1d08a"
            },
            {
              "path": "projects/Crush/internal/db/embed.go",
              "sha256": "fea793765ad569baaa581d8ad36a83c20b975dc8e351d688ca4fde31054f1e36"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "id": "aspect-messages-finished-at-update",
          "sectionId": "section-database",
          "slug": "messages-finished-at-update",
          "name": "UpdateMessage persists finish timestamps and bumps updated_at",
          "description": "The `UpdateMessage` statement in `internal/db/sql/messages.sql` takes a caller-supplied `finished_at` value and updates the row while recomputing `updated_at` via SQLite. This matches the message service\u2019s streaming lifecycle where tool or assistant completions retroactively set finish metadata without losing ordering.",
          "tags": [
            "database",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sql/messages.sql",
              "sha256": "ece9324a29e35814bb93e09735e15e57d44f1b83b07fa0a29f90887c564b1c7a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-messages-json-persistence",
          "sectionId": "section-database",
          "slug": "messages-json-persistence",
          "name": "Message inserts persist JSON parts and provider metadata",
          "description": "`internal/db/sql/messages.sql` inserts serialized `parts`, `model`, and `provider` columns while setting `created_at`/`updated_at` via `strftime`. Storing provider metadata alongside the JSON payload lets the session layer trace which backend produced each completion without additional joins.",
          "tags": [
            "database",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sql/messages.sql",
              "sha256": "ece9324a29e35814bb93e09735e15e57d44f1b83b07fa0a29f90887c564b1c7a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-migration-created-at-indexes",
          "sectionId": "section-database",
          "slug": "migration-created-at-indexes",
          "name": "Created_at indexes accelerate chronological queries",
          "description": "`internal/db/migrations/20250624000000_add_created_at_indexes.sql` creates indexes on session, file, and message `created_at` columns, improving ORDER BY performance for UI timelines and history lookups that page by recency.",
          "tags": [
            "database",
            "history",
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/migrations/20250624000000_add_created_at_indexes.sql",
              "sha256": "0c2cd46b4f3c3e29e9bf56705019264213e2069b10b33d62f06460d18568e612"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "id": "aspect-migration-initial-triggers",
          "sectionId": "section-database",
          "slug": "migration-initial-triggers",
          "name": "Initial migration installs updated_at triggers and counters",
          "description": "`internal/db/migrations/20250424200609_initial.sql` seeds sessions, files, and messages tables with `updated_at` triggers plus insert/delete triggers that maintain `sessions.message_count`. This design keeps metadata like message totals accurate without application-side transactions.",
          "tags": [
            "database",
            "history",
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/migrations/20250424200609_initial.sql",
              "sha256": "07a62a147089293b128eed108b493de0de96dd2e47cdeedc0397bb8181e90a15"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.64
        },
        {
          "id": "aspect-migration-message-provider",
          "sectionId": "section-database",
          "slug": "migration-message-provider",
          "name": "Provider column captures LLM backend for each message",
          "description": "`internal/db/migrations/20250627000000_add_provider_to_messages.sql` extends the messages table with a `provider` column, allowing analytics and auditing layers to differentiate outputs from Anthropic, OpenAI, or other adapters without parsing the JSON payload.",
          "tags": [
            "database",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/migrations/20250627000000_add_provider_to_messages.sql",
              "sha256": "adcb6ee4202b0a360518dc0f03778e5e64558ad22c8ff1e390a8236506749889"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-migration-summary-message",
          "sectionId": "section-database",
          "slug": "migration-summary-message",
          "name": "Summary message column links sessions to generated titles",
          "description": "`internal/db/migrations/20250515105448_add_summary_message_id.sql` adds a nullable `summary_message_id` column so background title jobs can persist the message that produced a session name, enabling quick reopen or editing of summaries.",
          "tags": [
            "database",
            "history",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/migrations/20250515105448_add_summary_message_id.sql",
              "sha256": "1d8597089034d7386d93b5da34741401d4b0ebb9d33580403d8ded1ab768ad27"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "id": "aspect-prepared-query-cache",
          "sectionId": "section-database",
          "slug": "prepared-query-cache",
          "name": "sqlc Prepare caches hot statements with contextual errors",
          "description": "`internal/db/db.go` builds a `Queries` wrapper whose `Prepare` method precompiles every generated statement and wraps failures with the query name (`error preparing query CreateFile`). By returning a ready-to-use handle and surfacing the failed statement, higher layers get early feedback about migration drift before executing business logic.",
          "tags": [
            "database",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/db.go",
              "sha256": "0f748c97d33fc351a7476023fe2ee2749efa2ee2842756fac03f12d9fcef978b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-prepared-statement-close",
          "sectionId": "section-database",
          "slug": "prepared-statement-close",
          "name": "Queries.Close tears down prepared statements safely",
          "description": "`internal/db/db.go` surfaces a `Close` method that walks every prepared statement, closing each handle and aggregating any errors into fmt-wrapped messages (for example `error closing createFileStmt`). This lets long-running services release SQLite resources deterministically during shutdown or test teardown.",
          "tags": [
            "database",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/db.go",
              "sha256": "0f748c97d33fc351a7476023fe2ee2749efa2ee2842756fac03f12d9fcef978b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.54
        },
        {
          "id": "aspect-querier-interface-contract",
          "sectionId": "section-database",
          "slug": "querier-interface-contract",
          "name": "Querier interface documents generated CRUD surface",
          "description": "`internal/db/querier.go` defines the `Querier` interface covering file, message, and session CRUD plus list helpers, letting services depend on the interface for test doubles while sqlc provides the concrete implementation. The map ensures features like ListNewFiles or UpdateSession remain discoverable without spelunking into generated structs.",
          "tags": [
            "database",
            "history",
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/querier.go",
              "sha256": "2660313cb4acb005dafffd8c0260e2c0efe2847cc3c76979fba50ed4a8bce06b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-sessions-root-listing",
          "sectionId": "section-database",
          "slug": "sessions-root-listing",
          "name": "ListSessions surfaces only root conversations by recency",
          "description": "`internal/db/sql/sessions.sql` constrains `ListSessions` to rows where `parent_session_id` is NULL and orders by `created_at DESC`, so the timeline view shows top-level chats first while nested task sessions remain hidden until expanded.",
          "tags": [
            "database",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sql/sessions.sql",
              "sha256": "1d65f1f7b8a76945c932ee548090540584b2948ec1742b98aa94d0522b64778e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-sessions-update-contract",
          "sectionId": "section-database",
          "slug": "sessions-update-contract",
          "name": "UpdateSession writes prompt/completion tokens and summary link",
          "description": "`internal/db/sql/sessions.sql` updates the `sessions` table with new token counts, cost, and an optional `summary_message_id`, returning the fresh row so the caller can refresh cache entries. The statement underpins summarization flows that attach derived sub-sessions back to their parent.",
          "tags": [
            "database",
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sql/sessions.sql",
              "sha256": "1d65f1f7b8a76945c932ee548090540584b2948ec1742b98aa94d0522b64778e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-sqlc-models",
          "sectionId": "section-database",
          "slug": "sqlc-models",
          "name": "sqlc models expose typed rows with nullable metadata",
          "description": "`internal/db/models.go` defines Go structs for files, messages, and sessions using `sql.NullString` and `sql.NullInt64` to represent optional provider, summary, and finish fields. These models let services work with typed data while preserving SQLite nullability semantics.",
          "tags": [
            "database",
            "history",
            "session",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/models.go",
              "sha256": "b6cb5b2d36ba5160b45e7ec240a6c827412f6ad74961ee07082f2d292744aa95"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-sqlite-connection-pragmas",
          "sectionId": "section-database",
          "slug": "sqlite-connection-pragmas",
          "name": "SQLite connection enforces WAL and foreign keys",
          "description": "`internal/db/connect.go` resolves the `crush.db` path under the configured data directory and opens it with `driver.Open`, applying pragmas for foreign keys, WAL journaling, secure deletion, and tuned page/cache sizes before the first `PingContext`. That upfront guard ensures every run inherits referential integrity and durability defaults before higher-level services touch SQLite.",
          "tags": [
            "database",
            "sqlite"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/connect.go",
              "sha256": "fa45f5ef2272863b452837dccc253c7bb6ba75728474893a0e5345122fb1d08a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.68
        },
        {
          "id": "aspect-sqlc-files-queries",
          "sectionId": "section-database",
          "slug": "sqlc-files-queries",
          "name": "sqlc-generated file queries back history diff summaries",
          "description": "`projects/Crush/internal/db/files.sql.go` exposes typed queries for file history records, returning additions/deletions counts with timestamps so history services and TUI overlays can list recent file changes efficiently.",
          "tags": [
            "database",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/files.sql.go",
              "sha256": "e322b2168be4b6287061e5e223af80f5f5c53ba571759520298dc344e068a841"
            }
          ],
          "lastUpdated": "2025-10-17",
          "importance": 0.46
        },
        {
          "id": "aspect-sqlc-messages-queries",
          "sectionId": "section-database",
          "slug": "sqlc-messages-queries",
          "name": "sqlc message queries handle inserts, fetches, and session cleanup",
          "description": "`projects/Crush/internal/db/messages.sql.go` is the sqlc output that creates, lists, and deletes conversation messages ordered by timestamp, powering session replay and agent history retrieval.",
          "tags": [
            "database",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/messages.sql.go",
              "sha256": "2c15668d68cd05e10da2650debbdf326db42deb2290790bd13f2c71697b369be"
            }
          ],
          "lastUpdated": "2025-10-17",
          "importance": 0.52
        },
        {
          "id": "aspect-sqlc-sessions-queries",
          "sectionId": "section-database",
          "slug": "sqlc-sessions-queries",
          "name": "sqlc session queries upsert metadata and prune inactive runs",
          "description": "`projects/Crush/internal/db/sessions.sql.go` provides the generated accessors for sessions, including inserts, updates, and archival helpers, which the session service uses to keep the CLI history synchronized.",
          "tags": [
            "database",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/db/sessions.sql.go",
              "sha256": "c71122e613a50b71fae323c037868595f719162d4b9139cc08fad00495c0bbe0"
            }
          ],
          "lastUpdated": "2025-10-17",
          "importance": 0.5
        },
        {
          "id": "aspect-sqlc-generator-config",
          "sectionId": "section-database",
          "slug": "sqlc-generator-config",
          "name": "sqlc config emits prepared query interfaces for SQLite",
          "description": "`sqlc.yaml` points at `internal/db/migrations` and `internal/db/sql`, generating Go code into `internal/db` with JSON tags, prepared statements, and exported interfaces so services can swap implementations while keeping empty slice semantics.",
          "tags": [
            "database"
          ],
          "sources": [
            {
              "path": "projects/Crush/sqlc.yaml",
              "sha256": "0be9640e02dea7d5cd7dc9305a4140a61614b0a3d5c285a3d4e389aeac9f7c83"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.48
        }
      ]
    },
    {
      "id": "section-filesystem",
      "slug": "filesystem",
      "title": "Filesystem Utilities",
      "entries": [
        {
          "id": "aspect-directory-ignore-stack",
          "sectionId": "section-filesystem",
          "slug": "directory-ignore-stack",
          "name": "Directory lister composes git/crush ignores with cached parsers",
          "description": "`internal/fsext/ls.go` memoizes `ignore.IgnoreParser` instances per directory in a `csync.Map`, layers common patterns, `.gitignore`, `.crushignore`, and home-level ignore files, and special-cases the root path to respect git semantics.",
          "tags": [
            "agent",
            "cli-runtime",
            "filesystem",
            "llm",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/ls.go",
              "sha256": "3c746b7a43017ba58e5fe0937f5c65f17a4c461d5c8485229d7120bd42d8af33"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-expand-literal-shell",
          "sectionId": "section-filesystem",
          "slug": "expand-literal-shell",
          "name": "Shell expand mirrors mvdan literal logic with GlobStar support",
          "description": "`internal/fsext/expand.go` parses the input with `syntax.Document` and feeds it to `expand.Literal` using a config that exposes `os.Getenv`, `os.ReadDir`, and globstar matching so CLI paths behave like the embedded shell.",
          "tags": [
            "cli",
            "filesystem",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/expand.go",
              "sha256": "9eeb9b1b73a8a00c69ff88bc2fbf8239477fe5489191fe19cb74c1cd227a251a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-fast-glob-walker",
          "sectionId": "section-filesystem",
          "slug": "fast-glob-walker",
          "name": "Fast glob walker combines fastwalk, doublestar, and ignore rules",
          "description": "`GlobWithDoubleStar` constructs a `FastGlobWalker`, skips ignored paths via hierarchical ignore checks, matches patterns with `doublestar.Match`, records `ModTime`, and truncates results after the configured limit.",
          "tags": [
            "agent",
            "filesystem",
            "llm",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/fileutil.go",
              "sha256": "6d88f9d2e9256440001818916a941e482e17c8ad5e07fbaedf9ff41a61e5dfeb"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-fileutil-glob-tests",
          "sectionId": "section-filesystem",
          "slug": "fileutil-glob-tests",
          "name": "Glob tests ensure recursive limits and ordering",
          "description": "`internal/fsext/fileutil_test.go` fabricates nested trees to verify `GlobWithDoubleStar` finds files, directories, and recursive patterns while normalising to slash paths. It also caps results with the `limit` flag and checks the output sorts by modification time, matching the expectations of the TUI file picker.",
          "tags": [
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/fileutil_test.go",
              "sha256": "47f079ad1f102aa6d9a50fa0b92e6bb60e5b9f4fb7e6c2620598388171272d3e"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.35
        },
        {
          "id": "aspect-home-dir-fallback",
          "sectionId": "section-filesystem",
          "slug": "home-dir-fallback",
          "name": "Home directory helper falls back to a temp dir and logs warnings",
          "description": "`home.Dir` uses `sync.OnceValue` to cache `os.UserHomeDir`, and when lookup fails it creates a temporary directory, warning through `slog` before returning the substitute path.",
          "tags": [
            "cli-runtime",
            "config",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/home/home.go",
              "sha256": "9388f433d6bc886d152530115e5fafd49fa21e2bbcfbd02dcd607c4ca46ca947"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-home-ignore-sources",
          "sectionId": "section-filesystem",
          "slug": "home-ignore-sources",
          "name": "Home-level ignore parser merges git and crush config files",
          "description": "`homeIgnore` lazily reads `~/.gitignore`, `~/.config/git/ignore`, and `~/.config/crush/ignore`, compiling the lines with `go-gitignore` so workspace scans respect user-level ignore rules.",
          "tags": [
            "cli-runtime",
            "filesystem",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/ls.go",
              "sha256": "3c746b7a43017ba58e5fe0937f5c65f17a4c461d5c8485229d7120bd42d8af33"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-home-path-shortcuts",
          "sectionId": "section-filesystem",
          "slug": "home-path-shortcuts",
          "name": "Home.Short/Long convert between tilde paths and absolute roots",
          "description": "`home.Short` swaps the resolved home prefix for `~`, while `home.Long` expands leading tildes back to the actual directory returned by `home.Dir`, keeping UI paths readable.",
          "tags": [
            "cli-runtime",
            "filesystem",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/home/home.go",
              "sha256": "9388f433d6bc886d152530115e5fafd49fa21e2bbcfbd02dcd607c4ca46ca947"
            },
            {
              "path": "projects/Crush/internal/fsext/fileutil.go",
              "sha256": "6d88f9d2e9256440001818916a941e482e17c8ad5e07fbaedf9ff41a61e5dfeb"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-home-path-tests",
          "sectionId": "section-filesystem",
          "slug": "home-path-tests",
          "name": "Home helpers tests normalize short and long paths",
          "description": "`projects/Crush/internal/home/home_test.go` confirms `Dir()` returns a real path, while `Short` compacts files under the home directory into `~/\u2026` and `Long` expands them back. The round-trip ensures messaging and prompts can display friendly paths without losing canonical locations.",
          "tags": [
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/home/home_test.go",
              "sha256": "eb37cf0429f33feeb33c5b1ab1206a9739d5c6cf3e6bda9ada2499369fec27b1"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.32
        },
        {
          "id": "aspect-ignore-filters-tests",
          "sectionId": "section-filesystem",
          "slug": "ignore-filters-tests",
          "name": "Ignore tests merge .crushignore and defaults",
          "description": "`internal/fsext/ignore_test.go` writes `.gitignore` and `.crushignore` files, proving `DirectoryLister.shouldIgnore` and `ShouldExcludeFile` drop common directories like `node_modules` alongside user patterns. Hierarchical cases place ignore files in subdirectories to confirm inherited rules while keeping the workspace root visible.",
          "tags": [
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/ignore_test.go",
              "sha256": "15e896f9c0192a63be4113ffc681cb35b39e3c5afafd8cb66163707d6834f0eb"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.35
        },
        {
          "id": "aspect-list-directory-tests",
          "sectionId": "section-filesystem",
          "slug": "list-directory-tests",
          "name": "ListDirectory tests gate pagination and visibility",
          "description": "`internal/fsext/ls_test.go` seeds a mix of hidden files and subdirectories, then checks `ListDirectory` omits ignored entries, expands child directories, and flags truncation when a limit is applied. Relative path helpers ensure UI renderers can map the canonical paths back to the workspace.",
          "tags": [
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/ls_test.go",
              "sha256": "1d09cc3b2b8999ecbb9f8e24e4cbafb7ef44eb83484317b6029cfe7b9c25372f"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.33
        },
        {
          "id": "aspect-lookup-closest-stop",
          "sectionId": "section-filesystem",
          "slug": "lookup-closest-stop",
          "name": "LookupClosest walks up ownership boundaries and stops at home",
          "description": "`LookupClosest` climbs directories with `traverseUp`, probes each candidate with `probeEnt`, and returns `filepath.SkipAll` once it reaches `home.Dir()` or finds the target, preventing runaway searches.",
          "tags": [
            "cli-runtime",
            "config",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/lookup.go",
              "sha256": "f113f16117724bf282c2a08f2619e44197f4efb3540d99444a6d87fd469dafa0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-lookup-ownership-bounds",
          "sectionId": "section-filesystem",
          "slug": "lookup-ownership-bounds",
          "name": "Lookup respects file ownership while scanning parent directories",
          "description": "`Lookup` and `LookupClosest` cache the starting UID, compare it with `Owner` for each candidate, and treat mismatches as permission errors so lookups do not cross into other users\u2019 trees.",
          "tags": [
            "cli-runtime",
            "config",
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/lookup.go",
              "sha256": "f113f16117724bf282c2a08f2619e44197f4efb3540d99444a6d87fd469dafa0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-lookup-tests",
          "sectionId": "section-filesystem",
          "slug": "lookup-tests",
          "name": "Lookup tests walk parents and home fences",
          "description": "`internal/fsext/lookup_test.go` creates nested directories to show `LookupClosest` finds targets in current, parent, and grandparent folders, aborts at the home directory boundary, and tolerates invalid start paths. It also checks `Lookup` returns all requested filenames so tooling can resolve project roots reliably.",
          "tags": [
            "filesystem"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/lookup_test.go",
              "sha256": "5b2b3c8f1a8f5e349e1ed6531946c67ed1c7c1f3f6267daa6a3978b91a832862"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.34
        },
        {
          "id": "aspect-owner-cross-platform",
          "sectionId": "section-filesystem",
          "slug": "owner-cross-platform",
          "name": "Owner abstracts POSIX stat UIDs and Windows opt-out semantics",
          "description": "`internal/fsext/owner_others.go` pulls `syscall.Stat_t.Uid` while the Windows build returns -1, signalling the lookup helpers to skip ownership enforcement where the platform cannot report it.",
          "tags": [
            "filesystem",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/owner_others.go",
              "sha256": "41abfc7206ccac7c7542f5da5362bfc2072f98c1e3399897eb78351f5eaa6b1c"
            },
            {
              "path": "projects/Crush/internal/fsext/owner_windows.go",
              "sha256": "0111c018589f00ac1011aea2dddc6abb9cb6d6d036043e817c909129db4ac3a3"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-skip-hidden-patterns",
          "sectionId": "section-filesystem",
          "slug": "skip-hidden-patterns",
          "name": "SkipHidden filters dotfiles and common build/vendor directories",
          "description": "`SkipHidden` looks for leading dots and splits the path into segments to drop directories like `node_modules`, `vendor`, and `__pycache__`, short-circuiting expensive file operations.",
          "tags": [
            "agent",
            "filesystem",
            "llm",
            "tools"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/fsext/fileutil.go",
              "sha256": "6d88f9d2e9256440001818916a941e482e17c8ad5e07fbaedf9ff41a61e5dfeb"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        }
      ]
    },
    {
      "id": "section-shell",
      "slug": "shell",
      "title": "Shell Execution",
      "entries": [
        {
          "id": "aspect-shell-arguments-blocker",
          "sectionId": "section-shell",
          "slug": "shell-arguments-blocker",
          "name": "Arguments blocker matches command prefixes and flag sets",
          "description": "`internal/shell/shell.go`'s `ArgumentsBlocker` slices argv into positional and flag buckets via `splitArgsFlags`, then checks that the leading args exactly match the expected sequence and that every flag in the allowlist is present using `slice.IsSubset`. The resulting closure plugs into `blockHandler` so security filters can lock down subcommands without rewriting the parser.",
          "tags": [
            "permissions",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-shell-block-handler",
          "sectionId": "section-shell",
          "slug": "shell-block-handler",
          "name": "Exec handler enforces block funcs before running commands",
          "description": "`blockHandler` wraps mvdan's exec handler, iterating configured `BlockFunc`s before executing and returning a formatted `command is not allowed` error when any matcher trips. Because it sits inside `interp.ExecHandlers`, the check runs for every process spawned by the POSIX interpreter, giving the app a centralized security gate.",
          "tags": [
            "permissions",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-shell-command-block-tests",
          "sectionId": "section-shell",
          "slug": "shell-command-block-tests",
          "name": "Command blocker tests enforce CLI safety",
          "description": "`internal/shell/command_block_test.go` feeds `Shell.Exec` with curated block functions, proving network calls like `curl` and privileged installs such as `npm install -g` return the security error while benign commands proceed. It also validates `ArgumentsBlocker` catches flags regardless of order without tripping unrelated subcommands.",
          "tags": [
            "shell",
            "permissions"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/command_block_test.go",
              "sha256": "ec5dff80259651d1d924f00bbc1eae0b1a9ec8a8340a3a62b3f495cfcda9724e"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.37
        },
        {
          "id": "aspect-shell-commands-blocker",
          "sectionId": "section-shell",
          "slug": "shell-commands-blocker",
          "name": "Commands blocker screens argv[0] against a denylist",
          "description": "`CommandsBlocker` precomputes a set of forbidden executables keyed by the first argv token and returns a closure that rejects matches in O(1). Combined with `BlockFunc`s, it lets callers disable binaries like `rm` or `curl` while still allowing other shell features.",
          "tags": [
            "permissions",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "id": "aspect-shell-env-sync",
          "sectionId": "section-shell",
          "slug": "shell-env-sync",
          "name": "execPOSIX keeps shell cwd/env in sync with mvdan interpreter",
          "description": "After each run `execPOSIX` copies `runner.Dir` into `Shell.cwd` and rebuilds the environment slice from `runner.Vars`, ensuring exported variables and directory changes persist across commands. The service then logs the command outcome through the injected `InfoPersist` logger so diagnostics capture both success and failure.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.53
        },
        {
          "sectionId": "section-shell",
          "id": "aspect-shell-exec-locking",
          "slug": "shell-exec-locking",
          "name": "Shell.Exec serialises runs behind a mutex before invoking mvdan",
          "description": "`Shell.Exec` guards the interpreter with a mutex so cwd/env mutations remain consistent even when multiple goroutines queue commands. After the critical section it delegates to `execPOSIX`, returning captured stdout/stderr alongside any mvdan error.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-shell-exec-posix",
          "sectionId": "section-shell",
          "slug": "shell-exec-posix",
          "name": "execPOSIX runs mvdan interpreter with shared env",
          "description": "`execPOSIX` parses the command with `syntax.NewParser`, builds an `interp.New` runner that inherits the shell's env, cwd, and coreutils handlers, and wires in the block handler before executing. Stdout/stderr stream into buffers that are returned alongside any interpreter error, giving CRUSH a portable POSIX surface even on Windows.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "sectionId": "section-shell",
          "id": "aspect-shell-get-env-copy",
          "slug": "shell-get-env-copy",
          "name": "GetEnv returns a defensive copy of environment variables",
          "description": "`GetEnv` locks, clones the internal env slice, and returns the copy so callers can't mutate the shell's state without going through `SetEnv`. It preserves invariants while still letting commands inspect the current environment.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-shell-interrupt-handling",
          "sectionId": "section-shell",
          "slug": "shell-interrupt-handling",
          "name": "Shell helpers unwrap context cancellations and exit codes",
          "description": "`IsInterrupt` treats `context.Canceled` and `DeadlineExceeded` as user-triggered interrupts, while `ExitCode` unwraps mvdan's `interp.ExitStatus` so callers can map Go errors back to integer exit codes. Non-shell errors fall back to `1`, keeping CLI semantics predictable.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-shell-new-shell",
          "sectionId": "section-shell",
          "slug": "shell-new-shell",
          "name": "NewShell defaults cwd/env and logger when options omit them",
          "description": "`NewShell` normalises options by defaulting to `os.Getwd()`/`os.Environ()` and a `noopLogger` when callers omit them, while also stashing any provided `BlockFunc`s. That allows higher layers to share a reusable interpreter without worrying about nil checks during setup.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-shell-performance-tests",
          "sectionId": "section-shell",
          "slug": "shell-performance-tests",
          "name": "Shell performance tests measure exec overhead",
          "description": "`internal/shell/comparison_test.go` times quick `echo` commands and benchmarks short sleeps, ensuring the shell wrapper reports allocations and exit codes correctly. The comparison captures baseline latency so regressions in polling or process startup surface quickly.",
          "tags": [
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/comparison_test.go",
              "sha256": "8e556c65281dc5632f7e6c8a919903245b59d470a852d491f2cfcfd13e97e912"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.31
        },
        {
          "id": "aspect-shell-persistent-singleton",
          "sectionId": "section-shell",
          "slug": "shell-persistent-singleton",
          "name": "Persistent shell uses sync.Once and slog-backed logging adapter",
          "description": "`GetPersistentShell` guards instantiation with `sync.Once`, constructing a `Shell` that uses the provided cwd and a `loggingAdapter` which forwards `InfoPersist` calls to `slog`. The singleton keeps environment mutations and directory changes alive across the lifetime of the app, mirroring a long-lived terminal session.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/persistent.go",
              "sha256": "f2addba723d1b335914c0308f1ccbbf8df3c6b50128c8a2c5f25f553b2438861"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "sectionId": "section-shell",
          "id": "aspect-shell-set-block-funcs",
          "slug": "shell-set-block-funcs",
          "name": "SetBlockFuncs swaps the active security filters at runtime",
          "description": "`SetBlockFuncs` grabs the mutex and replaces the shell's `blockFuncs` slice, letting higher layers adjust command allow/deny policies without re-instantiating the interpreter. The new closures are picked up the next time `blockHandler` runs.",
          "tags": [
            "permissions",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "sectionId": "section-shell",
          "id": "aspect-shell-set-env",
          "slug": "shell-set-env",
          "name": "SetEnv updates or appends key=value pairs atomically",
          "description": "`SetEnv` scans the env slice for an existing `KEY=` prefix, replacing it in place when found or appending a new entry otherwise. The method runs under the shell mutex so concurrent commands never interleave partial updates.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "sectionId": "section-shell",
          "id": "aspect-shell-set-working-dir",
          "slug": "shell-set-working-dir",
          "name": "SetWorkingDir validates the target path before updating cwd",
          "description": "`SetWorkingDir` wraps `os.Stat` to ensure the requested directory exists, returning a wrapped error if the path is invalid. Successful updates happen under the shell mutex so subsequent commands inherit the new cwd.",
          "tags": [
            "cli",
            "shell"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell.go",
              "sha256": "9e0a80d4b605674f4fde4a2adaf00c2007274ce5000f241c927665c6c4c144a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "id": "aspect-shell-timeout-tests",
          "sectionId": "section-shell",
          "slug": "shell-timeout-tests",
          "name": "Shell timeout tests guard cancellation paths",
          "description": "`internal/shell/shell_test.go` benchmarks rapid commands, then exercises context timeouts and cancellations to assert `ExitCode` reflects failures and `IsInterrupt` fires when sleeps are aborted. It also checks environment continuity across sequential `Exec` calls so exported vars and working directories persist between commands.",
          "tags": [
            "shell",
            "concurrency"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/shell/shell_test.go",
              "sha256": "3f74a28c9f9888a34eebe85d7b9c75ade6b2d6d9a2686f885daeef0d78dc1e87"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.35
        }
      ]
    },
    {
      "id": "section-messaging",
      "slug": "messaging",
      "title": "Message Modeling",
      "entries": [
        {
          "id": "aspect-message-append-content",
          "sectionId": "section-messaging",
          "slug": "message-append-content",
          "name": "AppendContent streams text deltas into existing parts",
          "description": "`internal/message/message.go` walks parts, updating the first `TextContent` when appending deltas and adding a new part if none exists, letting the UI stream assistant output in place without duplicating entries.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-message-binary-encoding",
          "sectionId": "section-messaging",
          "slug": "message-binary-encoding",
          "name": "BinaryContent encodes attachments for provider compatibility",
          "description": "`internal/message/content.go` base64-encodes binary data and prepends `data:` URIs when targeting OpenAI providers, ensuring file uploads render correctly regardless of backend expectations.",
          "tags": [
            "filesystem",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/content.go",
              "sha256": "d11e1d2e1bb1414a8d366f81772788aacbfb89aa4cd4d84bc8027bd5e66ba9ca"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-message-finish-state",
          "sectionId": "section-messaging",
          "slug": "message-finish-state",
          "name": "Finish helpers manage completion reasons and state",
          "description": "`internal/message/message.go` exposes `AddFinish`, `FinishReason`, and `IsFinished` to attach stop metadata, remove stale finish parts, and inspect the current termination reason, allowing the UI to show whether a response hit max tokens, canceled, or succeeded.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-message-image-parts",
          "sectionId": "section-messaging",
          "slug": "message-image-parts",
          "name": "ImageURLContent and AddImageURL collect multimodal prompts",
          "description": "`internal/message/content.go` defines image URL parts while `internal/message/message.go` appends them via `AddImageURL`, letting the agent capture per-message image context alongside text.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/content.go",
              "sha256": "d11e1d2e1bb1414a8d366f81772788aacbfb89aa4cd4d84bc8027bd5e66ba9ca"
            },
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.54
        },
        {
          "id": "aspect-message-reasoning-deltas",
          "sectionId": "section-messaging",
          "slug": "message-reasoning-deltas",
          "name": "AppendReasoningContent tracks thinking text and timestamps",
          "description": "`internal/message/message.go` aggregates reasoning deltas, creating a part with `StartedAt` when none exists and setting `FinishedAt` via `FinishThinking`, powering the UI's reasoning transcript and duration metrics.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-message-thinking-duration",
          "sectionId": "section-messaging",
          "slug": "message-thinking-duration",
          "name": "ThinkingDuration computes elapsed seconds for reasoning spans",
          "description": "`internal/message/message.go` inspects the current reasoning part, defaulting the end timestamp to `time.Now` when incomplete, so telemetry can attribute how long a provider spent in hidden thinking mode.",
          "tags": [
            "llm",
            "observability",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "id": "aspect-message-tool-call-management",
          "sectionId": "section-messaging",
          "slug": "message-tool-call-management",
          "name": "Tool call helpers merge incremental inputs and completion",
          "description": "`internal/message/message.go` supplies `AddToolCall`, `AppendToolCallInput`, `FinishToolCall`, and `SetToolCalls` to reconcile streamed tool invocations, ensuring repeated updates replace the same struct instead of duplicating entries.",
          "tags": [
            "llm",
            "permissions",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-message-tool-results",
          "sectionId": "section-messaging",
          "slug": "message-tool-results",
          "name": "Tool result helpers append batches without clobbering history",
          "description": "`internal/message/content.go`'s `AddToolResult` simply appends a `ToolResult` part, while `SetToolResults` bulk-appends a slice, preserving prior text and reasoning content. Combined with `FinishToolCall` and `AddFinish`, the helpers let the agent stream tool output, mark completion, and keep previous results intact for replayed transcripts.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-message-attachments-struct",
          "slug": "message-attachments-struct",
          "name": "Attachment struct carries file metadata into chat and history flows",
          "description": "`message.Attachment` holds the file path, display name, MIME type, and raw bytes so uploads can be stored alongside messages. Chat editors and the image file picker attach these structs when queuing prompts, letting history services and dialog previews persist binary context across the tool pipeline.",
          "tags": [
            "session",
            "filesystem",
            "chat"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/attachment.go",
              "sha256": "65f8f6cc599571a2aa9f3fa21013b45b036422e386037a2c77eea978ead99f9c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.38,
          "sectionId": "section-messaging"
        },
        {
          "sectionId": "section-messaging",
          "id": "aspect-message-role-enum",
          "slug": "message-role-enum",
          "name": "Message roles map assistant, user, system, and tool turns",
          "description": "`internal/message/content.go` defines `MessageRole` constants so services can tag persisted messages as assistant, user, system, or tool. The enum underpins database storage and determines how downstream renderers style each turn in the transcript.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/content.go",
              "sha256": "d11e1d2e1bb1414a8d366f81772788aacbfb89aa4cd4d84bc8027bd5e66ba9ca"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "sectionId": "section-messaging",
          "id": "aspect-message-finish-reasons-enum",
          "slug": "message-finish-reasons-enum",
          "name": "FinishReason enum captures provider stop semantics",
          "description": "`FinishReason` enumerates stop causes like `end_turn`, `max_tokens`, `tool_use`, `canceled`, `error`, and `permission_denied`, plus an `unknown` fallback. Agent flows rely on these string constants when annotating final parts and when translating provider-specific finish states into Crush's session summaries.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/content.go",
              "sha256": "d11e1d2e1bb1414a8d366f81772788aacbfb89aa4cd4d84bc8027bd5e66ba9ca"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "sectionId": "section-messaging",
          "id": "aspect-message-content-accessors",
          "slug": "message-content-accessors",
          "name": "Message accessors expose first text, reasoning, and attachment parts",
          "description": "Helper methods like `Content()`, `ReasoningContent()`, `ImageURLContent()`, and `BinaryContent()` walk cached parts and return the first matching instance (or a slice for attachments). They let UI callers inspect the leading text or embedded media without re-parsing the JSON payload each render.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "sectionId": "section-messaging",
          "id": "aspect-message-tool-call-accessors",
          "slug": "message-tool-call-accessors",
          "name": "ToolCalls() surfaces finished tool invocations in order",
          "description": "`Message.ToolCalls()` filters the parts slice for `ToolCall` entries and returns them in encounter order, giving the permissions dialog and run log a simple way to list tool executions associated with a message.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "sectionId": "section-messaging",
          "id": "aspect-message-is-thinking",
          "slug": "message-is-thinking",
          "name": "IsThinking flags reasoning-only assistant placeholders",
          "description": "`Message.IsThinking()` returns true when reasoning content exists, text content is empty, and no finish part has been recorded, which lets the chat UI render \"thinking...\" placeholders while a provider streams hidden reasoning tokens.",
          "tags": [
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "sectionId": "section-messaging",
          "id": "aspect-message-add-binary",
          "slug": "message-add-binary",
          "name": "AddBinary appends raw file payloads for downstream encoding",
          "description": "`Message.AddBinary()` pushes a `BinaryContent` part (mime type plus bytes) so provider adapters can decide how to encode the attachment\u2014OpenAI gets a data URI via `BinaryContent.String`, while Anthropic receives base64 blobs. The helper centralises binary handling for tools and message history.",
          "tags": [
            "filesystem",
            "llm",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/message/message.go",
              "sha256": "506ca30075ed1a5acad31a9960457399eae3e772b2a8c34232f7b75aef495304"
            },
            {
              "path": "projects/Crush/internal/message/content.go",
              "sha256": "d11e1d2e1bb1414a8d366f81772788aacbfb89aa4cd4d84bc8027bd5e66ba9ca"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.53
        }
      ]
    },
    {
      "id": "section-devx",
      "slug": "devx",
      "title": "Developer Experience",
      "entries": [
        {
          "id": "aspect-core-section-divider",
          "sectionId": "section-devx",
          "slug": "core-section-divider",
          "name": "Core section dividers",
          "description": "`Section` and `SectionWithInfo` compute remaining width with `lipgloss.Width`, fill it with `\u2500`, and tint the line using the theme's border colour, optionally appending an info string. This utility keeps TUI panels aligned regardless of terminal width or label length.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/core/core.go",
              "sha256": "0177b2d555573786225d863697b9e27a1198a0b6c5c7f32254c3eb038e828f0b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-core-simple-help",
          "sectionId": "section-devx",
          "slug": "core-simple-help",
          "name": "Simple help key map",
          "description": "`internal/tui/components/core/core.go`'s `simpleHelp` implements `help.KeyMap` by storing short and full binding slices, letting components wrap Bubble's help model without embedding complex structs. `NewSimpleHelp` wires the lists once so dialogs and panels can expose consistent shortcut hints.",
          "tags": [
            "tui",
            "rendering",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/core/core.go",
              "sha256": "0177b2d555573786225d863697b9e27a1198a0b6c5c7f32254c3eb038e828f0b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.41
        },
        {
          "id": "aspect-spinner-construction",
          "sectionId": "section-devx",
          "slug": "spinner-construction",
          "name": "NewSpinner builds a Bubble Tea program with themed anim",
          "description": "`internal/format/spinner.go` wires `anim.New` with the active theme, creating a Tea program that renders to stderr so non-interactive operations show progress without hijacking stdout.",
          "tags": [
            "cli",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/format/spinner.go",
              "sha256": "5f66ba1079110fffe7df3f04aad9ded55bed5beab34fc676cb564dcc98a7a70c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-cspell-dictionary",
          "sectionId": "section-devx",
          "slug": "cspell-dictionary",
          "name": "cspell dictionary captures domain-specific vocabulary",
          "description": "`cspell.json` seeds the spell checker with Charm ecosystem terms (Charmtone palettes, provider names, tool IDs, Go packages) and disables flagWords so developer-lint runs don't flag project jargon.",
          "tags": [
            "automation",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/cspell.json",
              "sha256": "d0a08ac7b05a3bffdc1b1a1adddcebccf532d70f3fde37242becb95b187582e3"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.36
        },
        {
          "id": "aspect-crush-dev-guide",
          "sectionId": "section-devx",
          "slug": "crush-dev-guide",
          "name": "CRUSH.md codifies build, lint, and testing conventions",
          "description": "`CRUSH.md` lists standard `go build`, `task test`, and golden-file update commands, notes gofumpt formatting, semantic commit prefixes, and testing patterns (t.Parallel, config mocks). It doubles as a memory file for agents, capturing contributor preferences.",
          "tags": [
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/CRUSH.md",
              "sha256": "9bd8b16d9ec6233deff30b7aacc68c7a549a7682559f5e335e6207ceb0ebd365"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.5
        },
        {
          "id": "aspect-readme-orientation",
          "sectionId": "section-devx",
          "slug": "readme-orientation",
          "name": "README highlights multi-model support and installation channels",
          "description": "`README.md` positions Crush as a terminal AI assistant, lists core features (multi-model switching, LSP integration, MCP extensibility), and documents package manager installs across Homebrew, npm, Scoop, winget, NUR, and Debian repositories.",
          "tags": [
            "cli",
            "distribution"
          ],
          "sources": [
            {
              "path": "projects/Crush/README.md",
              "sha256": "7b65ea2fd3461f86920f11ecf6d10df2ba40130b5ca6d07ed6e6ac11f1deb415"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.44
        },
        {
          "id": "aspect-ansi-renderer-integration",
          "slug": "ansi-renderer-integration",
          "name": "Renderer escapes control pictures with ansiext before painting",
          "description": "`ansiext.Escape` converts control bytes to Unicode pictograms, and `renderPlainContent`/`renderCodeContent` route tool output through it before lipgloss styling. This prevents invisible control characters from corrupting Crush\u2019s TUI layout while keeping diagnostics legible.",
          "tags": [
            "rendering",
            "tui",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/ansiext/ansi.go",
              "sha256": "32e091e51181f353cd93baf46d83c9f258b3debcda35a54751839e5d57aed101"
            },
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5,
          "sectionId": "section-devx"
        },
        {
          "id": "aspect-core-title-gradient",
          "sectionId": "section-devx",
          "slug": "core-title-gradient",
          "name": "Core title gradient",
          "description": "`Title` renders heading text alongside a gradient of `\u2571` characters coloured via `styles.ApplyForegroundGrad`, trimming width with `lipgloss.Width` so the accent extends to the panel edge. The helper standardises hero titles across sidebars and dialogs. Gradient colours come from `styles/theme.go`, so swapping palettes automatically re-skins dialog headings.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/core/core.go",
              "sha256": "0177b2d555573786225d863697b9e27a1198a0b6c5c7f32254c3eb038e828f0b"
            },
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-17",
          "importance": 0.4
        },
        {
          "id": "aspect-ansi-control-pictures",
          "sectionId": "section-devx",
          "slug": "ansi-control-pictures",
          "name": "ansiext.Escape swaps control bytes for Unicode pictures",
          "description": "`internal/ansiext/ansi.go` iterates runes, emitting control picture code points or preserving printable characters, ensuring logs and TUI panes display otherwise invisible control characters safely. The same escape logic powers CLI logging (`internal/log/http.go`), preventing control characters from polluting JSON log output.",
          "tags": [
            "cli",
            "observability",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/ansiext/ansi.go",
              "sha256": "32e091e51181f353cd93baf46d83c9f258b3debcda35a54751839e5d57aed101"
            },
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/renderer.go",
              "sha256": "be75991c125a5a91c381fe563c1a5400a2c974e99b7c9e9865a8f6ba106bf3b6"
            },
            {
              "path": "projects/Crush/internal/log/http.go",
              "sha256": "a48dcc0dd4e0dc8ed63e974db012072b72bb978d7d858d8fe0a8e254a845ebf9"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-core-selectable-buttons",
          "sectionId": "section-devx",
          "slug": "core-selectable-buttons",
          "name": "Selectable button rendering",
          "description": "`SelectableButton` builds underlined accelerator characters and highlights selected entries with theme backgrounds, while `SelectableButtons` and `SelectableButtonsVertical` join them with spacing. Dialogs use these helpers to present keyboard-friendly button rows without bespoke styling code. Components like the command palette reuse these helpers, keeping button rows consistent across dialogs.",
          "tags": [
            "tui",
            "rendering",
            "cli"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/core/core.go",
              "sha256": "0177b2d555573786225d863697b9e27a1198a0b6c5c7f32254c3eb038e828f0b"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/commands/commands.go",
              "sha256": "177d107cabd82c62f0ab71d57ab8a7c7b5c587845c7ee5351f5631cec70002a7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-core-status-line",
          "sectionId": "section-devx",
          "slug": "core-status-line",
          "name": "Core status line composer",
          "description": "`Status` accepts icon/title/description/extra content, truncates descriptions with `ansi.Truncate`, and colours segments using theme foregrounds so callers get consistent one-line status bars. Thinking footers, LSP panels, and dialog banners reuse this helper for uniform messaging. Chat thinking footers and the status help bar call this helper so iconography and truncation logic stay consistent across the UI.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/core/core.go",
              "sha256": "0177b2d555573786225d863697b9e27a1198a0b6c5c7f32254c3eb038e828f0b"
            },
            {
              "path": "projects/Crush/internal/tui/components/core/status/status.go",
              "sha256": "0966c292cf3debfc2f89555c2cd6e550bce85bfa837d2e0947edabc0af4b0160"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43
        },
        {
          "id": "aspect-spinner-control-flow",
          "sectionId": "section-devx",
          "slug": "spinner-control-flow",
          "name": "Spinner.Start runs asynchronously and cleans the terminal",
          "description": "`internal/format/spinner.go` launches the Tea program in a goroutine, waits on a channel, and prints `ansi.EraseEntireLine` after exit so transient spinners do not leave artifacts even on cancellation errors. `App.RunNonInteractive` wraps agent runs with this spinner helper, demonstrating how CLI flows cleanly tear down the animation even when users cancel.",
          "tags": [
            "cli",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/format/spinner.go",
              "sha256": "5f66ba1079110fffe7df3f04aad9ded55bed5beab34fc676cb564dcc98a7a70c"
            },
            {
              "path": "projects/Crush/internal/app/app.go",
              "sha256": "7f045a1cda46a5802bce142b8888c6ff66a5eb005244b2e13451121e0ce884d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        }
      ]
    },
    {
      "id": "section-tui-dialogs",
      "slug": "tui-dialogs",
      "title": "TUI Dialogs",
      "entries": [
        {
          "id": "aspect-dialogs-stack-manager",
          "sectionId": "section-tui-dialogs",
          "slug": "dialogs-stack-manager",
          "name": "Dialog stack reuses models, rejects duplicates, and layers views",
          "description": "`internal/tui/components/dialogs/dialogs.go` keeps a slice of `DialogModel`s plus an ID map, reuses an existing model when the same ID is reopened, and refuses to stack anything on top of the quit dialog. Window size messages cascade to each dialog, and `GetLayers` produces lipgloss layers anchored by each dialog\u2019s `Position()`.",
          "tags": [
            "dialogs",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/dialogs.go",
              "sha256": "79dd396e1244d99531afed93e2b771c69b32f6ef9edbe71cde876304affd3245"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/keys.go",
              "sha256": "21c133e9ac6c2fa7ec03e2a20337164ccbb5a0cf48e34ca01f29713c333ab738"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-compact-session-dialog",
          "sectionId": "section-tui-dialogs",
          "slug": "compact-session-dialog",
          "name": "Compact dialog drives summarisation progress and handles auto-confirm",
          "description": "`internal/tui/components/dialogs/compact/compact.go` supports a no-confirm path that immediately calls `agent.Summarize`, listens for `AgentEventTypeSummarize` updates to refresh the progress copy, and exposes key handlers for Y/N shortcuts. Errors flip the dialog into an error state with a dismiss prompt.",
          "tags": [
            "dialogs",
            "llm",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/compact/compact.go",
              "sha256": "f64e582734c538c676820bdabf1abf5567a52d81228173f705c0b882d9aa12ed"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/compact/keys.go",
              "sha256": "c2813bbd87b898cbbb7715fbb7dd9cb8bca58be3e8543ffc9e13532288749a00"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-filepicker-attachment-dialog",
          "sectionId": "section-tui-dialogs",
          "slug": "filepicker-attachment-dialog",
          "name": "File picker validates size, renders previews, and emits attachments",
          "description": "`internal/tui/components/dialogs/filepicker/filepicker.go` wraps the Charm filepicker, clamps file types, and on selection reads the file, enforces the 5\u00a0MB cap, detects MIME, and returns a `message.Attachment`. It also redraws an image preview via the shared image component and shows contextual key help.",
          "tags": [
            "chat",
            "dialogs",
            "filesystem",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/filepicker/filepicker.go",
              "sha256": "8347d6cbe2e66c88c57053832f4d93bb4db2557cdc690a9682de00186a3a04b9"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/filepicker/keys.go",
              "sha256": "7687b60f4135742ba1759147a7062bf03793a04dba53073810b7f38224744fa7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.59
        },
        {
          "id": "aspect-model-dialog-selection",
          "sectionId": "section-tui-dialogs",
          "slug": "model-dialog-selection",
          "name": "Model dialog toggles large/small lists and verifies provider API keys",
          "description": "`internal/tui/components/dialogs/models/models.go` switches between large and small model lists with Tab, includes built-in shortcuts, and when a provider lacks credentials shows an API key input that calls `TestConnection` with a spinner delay. Confirmed selections emit `ModelSelectedMsg` and close the dialog.",
          "tags": [
            "config",
            "dialogs",
            "llm",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/models/models.go",
              "sha256": "f4b4fa1ba2d3627a73b5b78cfc0a9ed78f1f73b2247e938d5da439ebeb6e6f57"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/models/keys.go",
              "sha256": "8a446afc7abe54ea1a7ff7e34e39fc0a293ceef3f204ec67fa9fa0b3f89fa558"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "id": "aspect-permissions-dialog-keymap",
          "sectionId": "section-tui-dialogs",
          "slug": "permissions-dialog-keymap",
          "name": "Permissions dialog keymap drives allow/session/deny and diff scrolling",
          "description": "`internal/tui/components/dialogs/permissions/permissions.go` binds Allow, Allow Session, Deny, tab cycling, and diff toggles to dedicated key bindings, and when a diff is available lets arrow keys or the mouse wheel scroll the diff viewport. Toggle diff mode flips between split/unified views while marking the content dirty for re-render.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/keys.go",
              "sha256": "630753d837a3205926200850a0a8a78a09d5e4684745698bfe768f140909d00b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-quit-dialog",
          "sectionId": "section-tui-dialogs",
          "slug": "quit-dialog",
          "name": "Quit dialog defaults to No and supports Y/N shortcuts",
          "description": "`internal/tui/components/dialogs/quit/quit.go` initialises with the No button selected, flips selection with Tab/arrow keys, and quits the program with `tea.Quit` when Yes is confirmed. The themed buttons underline hotkeys so the dialog stays readable even on narrow terminals.",
          "tags": [
            "cli",
            "dialogs",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/quit/quit.go",
              "sha256": "912178542ba2ecf69e847e6eb7ac97f256c99f1a81c92e4d1d245569fd423ada"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/quit/keys.go",
              "sha256": "08c468b970d053eb04d221e9b0d305e00dfa08ae6c0dd687fadc3402a6e53572"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-reasoning-dialog",
          "sectionId": "section-tui-dialogs",
          "slug": "reasoning-dialog",
          "name": "Reasoning dialog lists effort presets and returns the selected value",
          "description": "`internal/tui/components/dialogs/reasoning/reasoning.go` builds a filterable list with low/medium/high options, marks the current selection based on the agent config, and emits `ReasoningEffortSelectedMsg` when Enter is pressed. Key bindings reuse Vim-style navigation while help text stays in sync.",
          "tags": [
            "dialogs",
            "llm",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/reasoning/reasoning.go",
              "sha256": "339dfc96f62b4d8db6cb9e19b48832517facf1b5215c12fdbbbce450085d8cb5"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-session-switcher-dialog",
          "sectionId": "section-tui-dialogs",
          "slug": "session-switcher-dialog",
          "name": "Session switcher filters titles and emits chat selection messages",
          "description": "`internal/tui/components/dialogs/sessions/sessions.go` wraps a filterable list seeded with session titles, highlights the current session when opened, and on Enter closes the dialog, logs `event.SessionSwitched()`, and sends `chat.SessionSelectedMsg` so the chat module swaps focus.",
          "tags": [
            "dialogs",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/sessions/sessions.go",
              "sha256": "cd26993a8f501f55042b0e259a235676d352b167ac478bd41927524d50aaf8e7"
            },
            {
              "path": "projects/Crush/internal/tui/components/dialogs/sessions/keys.go",
              "sha256": "108261cf102fc1e2f3d1de862f496a04f21ab62befbc5a9e0ee4bec70ef3f514"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "sectionId": "section-tui-dialogs",
          "id": "aspect-permissions-dialog-content-cache",
          "slug": "permissions-dialog-content-cache",
          "name": "Permissions dialog caches rendered content until marked dirty",
          "description": "`internal/tui/components/dialogs/permissions/permissions.go` keeps `cachedContent` and a `contentDirty` flag so `getOrGenerateContent` can reuse the last render across frame updates. Resizes, diff toggles, and tool changes flip the dirty bit, but steady-state permission prompts avoid reformatting markdown or diffs on each `View` call, keeping the dialog responsive when the viewport scrolls.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "sectionId": "section-tui-dialogs",
          "id": "aspect-permissions-dialog-diff-scroll",
          "slug": "permissions-dialog-diff-scroll",
          "name": "Diff scroll state tracks X/Y offsets for edit and write approvals",
          "description": "The dialog records `diffXOffset` and `diffYOffset`, adjusts them from `scrollUp/Down/Left/Right`, and feeds those offsets into `core.DiffFormatter()` inside `generateEditContent`/`generateWriteContent`. Combined with mouse-wheel handling that only triggers when the cursor is over the dialog, large diffs stay navigable without the viewport snapping back to the top each repaint.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "sectionId": "section-tui-dialogs",
          "id": "aspect-permissions-dialog-diff-layout",
          "slug": "permissions-dialog-diff-layout",
          "name": "Diff renderer auto-selects split mode on wide windows with override support",
          "description": "`SetSize` recalculates dialog width per tool and sets `defaultDiffSplitMode` when the window spans at least 140 cells. `useDiffSplitMode` then consults the user-provided `Options.DiffMode` override (via `isSplitMode`) or the default to choose split or unified rendering before piping dimensions into `DiffFormatter`. The result keeps diffs readable on large terminals while letting power users lock their preferred layout.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.59
        },
        {
          "sectionId": "section-tui-dialogs",
          "id": "aspect-permissions-dialog-tool-sizing",
          "slug": "permissions-dialog-tool-sizing",
          "name": "Permission dialog resizes per tool to balance context and controls",
          "description": "`SetSize` switches width/height ratios based on the requesting tool\u2014editor-like actions consume 80% of the viewport, download/view/ls shrink vertically, and other tools default to a mid-height layout. Resizing marks content dirty, recomputes the centered position, and feeds the new dimensions into the viewport so headers, diffs, and buttons stay balanced regardless of the prompt type.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "sectionId": "section-tui-dialogs",
          "id": "aspect-permissions-dialog-bash-render",
          "slug": "permissions-dialog-bash-render",
          "name": "Bash permission prompts prettify multi-line commands in themed blocks",
          "description": "For `bash` requests the dialog trims the script, splits it into lines, and renders each inside a muted, padded block sized to the viewport width. That styling, paired with the surrounding `BgSubtle` container, mirrors syntax panels elsewhere in Crush so users can review potentially destructive commands before approving them.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "sectionId": "section-tui-dialogs",
          "id": "aspect-permissions-dialog-headers",
          "slug": "permissions-dialog-headers",
          "name": "Permission headers adapt labels and file paths per tool",
          "description": "`renderHeader` inspects `permission.ToolName` and formats contextual rows\u2014file paths for edit/write/multi-edit, directory listings for ls, URLs for fetch, etc.\u2014using `fsext.PrettyPath` and themed label/value pairs. The row list ensures every prompt surfaces the critical target path or URL above the diff so approvals remain transparent.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "sectionId": "section-tui-dialogs",
          "id": "aspect-permissions-dialog-diff-support",
          "slug": "permissions-dialog-diff-support",
          "name": "Diff tooling is limited to edit/write family and gated by supportsDiffView",
          "description": "`supportsDiffView` only enables diff controls for `edit`, `write`, and `multi_edit` tools, keeping scroll/toggle logic dormant for other actions. The render path builds context-specific markdown (fetch, ls, download, view) via dedicated `generate*Content` helpers so non-diff permissions still present informative payloads without exposing irrelevant toggles.",
          "tags": [
            "dialogs",
            "permissions",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/dialogs/permissions/permissions.go",
              "sha256": "189c2caab6f7e7778ad7ac623dd2bbe8701b3f71e21cd2ba60016f9dd14f03a4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        }
      ]
    },
    {
      "id": "section-tui-components",
      "slug": "tui-components",
      "title": "TUI Components",
      "entries": [
        {
          "id": "aspect-anim-spinner-cache",
          "sectionId": "section-tui-components",
          "slug": "anim-spinner-cache",
          "name": "Animated spinner caches pre-rendered frames per settings hash",
          "description": "`internal/tui/components/anim/anim.go` hashes spinner settings with xxh3, stores gradient frames and ellipsis sequences in a `csync.Map`, and reuses them so subsequent spinners avoid recomputation.",
          "tags": [
            "components",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/anim/anim.go",
              "sha256": "bb934a31120ab6e20076f0601a2c9e5bdcf438702f433af1d9f134cd642d420a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.52
        },
        {
          "id": "aspect-chat-keymap",
          "sectionId": "section-tui-components",
          "slug": "chat-keymap",
          "name": "Chat components reuse list keymaps for message navigation",
          "description": "`components/chat/chat.go` stores the default list keymap and applies it to the message list, while splash setup rewires next/previous bindings so chat navigation and help text stay consistent.",
          "tags": [
            "chat",
            "components",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/page/chat/keys.go",
              "sha256": "9bd976d67143f3ec422527224f896bcafe0bcba6bff7fc0fedb9fbf0cbf5fea2"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.5
        },
        {
          "id": "aspect-completions-keymap",
          "sectionId": "section-tui-components",
          "slug": "completions-keymap",
          "name": "Completions keymap covers navigation, selection, and cancel flows",
          "description": "`DefaultKeyMap` in `components/completions/keys.go` binds arrow keys, enter/tab/ctrl+y for selection, ctrl+n/ctrl+p for inserting next/previous suggestions, and esc/alt+esc to dismiss.",
          "tags": [
            "chat",
            "components",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/completions/keys.go",
              "sha256": "3cb780b3d33b63400a9b2515f79c094eefcf29e70888c1e28160e964a0d4867f"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "id": "aspect-files-status-block",
          "sectionId": "section-tui-components",
          "slug": "files-status-block",
          "name": "File status block sorts histories and renders diff stats with theme colors",
          "description": "`components/files/files.go` orders session histories by latest timestamp, truncates relative paths with `DirTrim`, and builds status rows pairing additions/deletions counts with themed badges.",
          "tags": [
            "components",
            "filesystem",
            "session",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/files/files.go",
              "sha256": "fce4f436f93cba8cacf9d6cc69389262a1de51effc6cd07f36c62e658a674ac7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-image-preview-loader",
          "sectionId": "section-tui-components",
          "slug": "image-preview-loader",
          "name": "Image component streams HTTP/local assets and rasterises SVGs for the TUI",
          "description": "`components/image/load.go` fetches paths or URLs, orients images, rasterises SVGs via oksvg+rasterx, and renders them as coloured block characters using termenv so previews fit terminal bounds.",
          "tags": [
            "components",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/image/image.go",
              "sha256": "518b7872d6ca42c0f561623a613890a969f37ce5318f4740fc8f761c79b4a559"
            },
            {
              "path": "projects/Crush/internal/tui/components/image/load.go",
              "sha256": "4ddc38309be1151d62d6feeeb917727733ef692a246bfa620fe9764f276be0ea"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "id": "aspect-layout-interfaces",
          "sectionId": "section-tui-components",
          "slug": "layout-interfaces",
          "name": "Layout package defines shared focus, size, and position contracts",
          "description": "`components/core/layout/layout.go` declares `Focusable`, `Sizeable`, `Help`, and `Positional` interfaces so higher-level components can coordinate focus and sizing without tight coupling.",
          "tags": [
            "architecture",
            "components",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/components/core/layout/layout.go",
              "sha256": "9e299eab6fdd5a31a60a99b4a73165d50aca83836afb6c3e8b04ebb63d7fb2ec"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-page-registry",
          "sectionId": "section-tui-components",
          "slug": "page-registry",
          "name": "PageChangeMsg carries typed page IDs for decoupled routing",
          "description": "`internal/tui/page/page.go` introduces the `PageID` alias and `PageChangeMsg` so components can request page swaps without importing concrete page implementations.",
          "tags": [
            "architecture",
            "components",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/page/page.go",
              "sha256": "53d9aa7fb7c54ff940cb17452f365255c8f5b1be6a5bb7ed99f52d42ddc99fff"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.4
        },
        {
          "id": "aspect-syntax-highlight-service",
          "sectionId": "section-tui-components",
          "slug": "syntax-highlight-service",
          "name": "SyntaxHighlight picks lexers and paints tokens with theme-aware backgrounds",
          "description": "`internal/tui/highlight/highlight.go` selects lexers by filename or content, builds a chroma style from the active theme, adjusts the background colour, and formats code with the 16m formatter.",
          "tags": [
            "components",
            "rendering",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/highlight/highlight.go",
              "sha256": "b692625be3fcbdcb9eb1b90d2c1fe098ad8a4a3d2593cdb8b9830fac6f55c339"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-tui-keymap",
          "sectionId": "section-tui-components",
          "slug": "tui-keymap",
          "name": "Simple help adapter bridges component key bindings into bubble help",
          "description": "`components/core/core.go` provides `NewSimpleHelp`, returning a `help.KeyMap` implementation that exposes short and full binding lists for use in prompts and overlays.",
          "tags": [
            "components",
            "styles",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/keys.go",
              "sha256": "dffa8ebafa1a1dd28eca87dbc9aac8653456b6e40ccb4982b2dea212d0404b68"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.54
        },
        {
          "id": "aspect-tui-util-messages",
          "sectionId": "section-tui-components",
          "slug": "tui-util-messages",
          "name": "Util helpers wrap info/error messages into Bubble Tea commands",
          "description": "`internal/tui/util/util.go` exposes `ReportError`, `ReportWarn`, and `ReportInfo`, logging via `slog` and emitting `InfoMsg` payloads with optional TTL so status bars handle notifications uniformly.",
          "tags": [
            "components",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/util/util.go",
              "sha256": "0cbf1408a55f74e92fa93e8c4fb3718d5f76b81c05d4bf8e798fc12f5fe022c8"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        }
      ]
    },
    {
      "id": "section-tui-widgets",
      "slug": "tui-widgets",
      "title": "TUI Widgets",
      "entries": [
        {
          "id": "aspect-diffview-highlighting",
          "sectionId": "section-tui-widgets",
          "slug": "diffview-highlighting",
          "name": "Custom chroma formatter escapes control bytes and applies lipgloss styles",
          "description": "`diffview/chroma.go` wraps chroma formatting, escaping tokens with `ansiext` and forcing a background colour while rendering foreground styles through Lip Gloss attributes.",
          "tags": [
            "diffing",
            "rendering",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/chroma.go",
              "sha256": "9860a3071ce924a5bdfae3e2903d4e7696ecd7610e3b6c9a2ad4ab4d057c472c"
            },
            {
              "path": "projects/Crush/internal/tui/exp/diffview/style.go",
              "sha256": "b0eec3c311908a7b27587fb3c6a5bfa380048a8bb51c5427a50ab44ac8fa6bf0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-diffview-model",
          "sectionId": "section-tui-widgets",
          "slug": "diffview-model",
          "name": "DiffView caches syntax, supports unified/split layouts, and tracks offsets",
          "description": "`internal/tui/exp/diffview/diffview.go` stores highlighted lines per hash, toggles unified or split layouts, and maintains offsets, context lines, and tab widths while generating string output.",
          "tags": [
            "diffing",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview.go",
              "sha256": "b8641b29a99b3839ba4db5319bd38ea325d15ad0e5a2f52b9cf5b21f76406ac0"
            },
            {
              "path": "projects/Crush/internal/tui/exp/diffview/split.go",
              "sha256": "3bae5cd7b1c52aebb0b23d15e6a8d9478ab27167d4964ae4f47b93f2b2f35563"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "sectionId": "section-tui-widgets",
          "id": "aspect-diffview-normalize-line-endings",
          "slug": "diffview-normalize-line-endings",
          "name": "DiffView normalizes CRLF to LF before diffing",
          "description": "`diffview.go` replaces Windows `\r\n` line endings with `\n` in both buffers so udiff comparisons and width calculations behave consistently across platforms.",
          "tags": [
            "diffing",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview.go",
              "sha256": "b8641b29a99b3839ba4db5319bd38ea325d15ad0e5a2f52b9cf5b21f76406ac0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "sectionId": "section-tui-widgets",
          "id": "aspect-diffview-prevent-infinite-scroll",
          "slug": "diffview-prevent-infinite-scroll",
          "name": "preventInfiniteYScroll clamps scroll offsets unless explicitly disabled",
          "description": "Before rendering, `preventInfiniteYScroll` caps `YOffset` based on computed `totalLines` and the current height unless `InfiniteYScroll(true)` is set, keeping the viewport from drifting past the bottom of the diff.",
          "tags": [
            "diffing",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview.go",
              "sha256": "b8641b29a99b3839ba4db5319bd38ea325d15ad0e5a2f52b9cf5b21f76406ac0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.47
        },
        {
          "sectionId": "section-tui-widgets",
          "id": "aspect-diffview-resize-code-width",
          "slug": "diffview-resize-code-width",
          "name": "resizeCodeWidth splits available width between gutters and code",
          "description": "`resizeCodeWidth` subtracts line-number padding and leading symbols, giving unified diffs the remaining width and splitting it between panes in split mode (adding an extra column to the after pane when needed). The computation keeps columns aligned regardless of terminal width.",
          "tags": [
            "diffing",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview.go",
              "sha256": "b8641b29a99b3839ba4db5319bd38ea325d15ad0e5a2f52b9cf5b21f76406ac0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.48
        },
        {
          "sectionId": "section-tui-widgets",
          "id": "aspect-diffview-tab-width",
          "slug": "diffview-tab-width",
          "name": "DiffView expands tabs using the configured tab width",
          "description": "`replaceTabs` swaps `\t` characters for a string of spaces sized by `TabWidth`, ensuring alignment stays predictable regardless of terminal tab settings before the diff is computed.",
          "tags": [
            "diffing",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview.go",
              "sha256": "b8641b29a99b3839ba4db5319bd38ea325d15ad0e5a2f52b9cf5b21f76406ac0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-diffview-utils",
          "sectionId": "section-tui-widgets",
          "slug": "diffview-utils",
          "name": "Diffview utilities pad ANSI-aware strings and expose helper predicates",
          "description": "`diffview/util.go` includes helpers like `pad`, `isEven`, and `ternary`, ensuring width calculations respect ANSI escape sequences inside the diff renderer.",
          "tags": [
            "diffing",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/util.go",
              "sha256": "82ce4cf5456c78a2c38ac62019544ebc98c45d117e1f8ea86e9898e7af134ea0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "sectionId": "section-tui-widgets",
          "id": "aspect-filterable-focus-propagation",
          "slug": "filterable-focus-propagation",
          "name": "Filter operations blur focusable items and track cursor ownership",
          "description": "Before refiltering, `Filter` blurs any `layout.Focusable` items and clears `HasMatchIndexes`; the list exposes `Cursor`, `Focus`, and `Blur` helpers so the search box and list stay in sync when the widget gains or loses focus.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/filterable.go",
              "sha256": "693e2c3c3f9f54fa61f19e44d78f435010fb2709ec010b8280c04d6302a55d89"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "sectionId": "section-tui-widgets",
          "id": "aspect-filterable-input-hidden",
          "slug": "filterable-input-hidden",
          "name": "Filterable lists can hide the input while preserving fuzzy filtering",
          "description": "`NewFilterableList` accepts `WithFilterInputHidden`, skipping text-input construction so callers can drive filtering manually (e.g., via command palette search) while still reusing the list's fuzzy matching and rendering pipeline.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/filterable.go",
              "sha256": "693e2c3c3f9f54fa61f19e44d78f435010fb2709ec010b8280c04d6302a55d89"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43
        },
        {
          "id": "aspect-filterable-list-groups",
          "sectionId": "section-tui-widgets",
          "slug": "filterable-list-groups",
          "name": "Grouped filterable list shares filtering logic across sections",
          "description": "`filterable_group.go` extends the filterable list to grouped data, updating keymaps, resizing the search input independently, and clearing focus/match state across grouped items.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/grouped.go",
              "sha256": "014189f9b6339174f6cf860a2007db792ff70e448e6f232228580859578b370d"
            },
            {
              "path": "projects/Crush/internal/tui/exp/list/filterable_group.go",
              "sha256": "69129e6e0e7b0f24dab804039b8bb68b3a0e81e211619c946865d9360589f405"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-filterable-list-items",
          "sectionId": "section-tui-widgets",
          "slug": "filterable-list-items",
          "name": "Completion items underline match ranges and support shortcut badges",
          "description": "`exp/list/items.go` underlines fuzzy match ranges with Lip Gloss, performs smart truncation around matches, and appends optional shortcut labels while tracking focus state.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/items.go",
              "sha256": "23b32e438a1b4c53adf7bd7a060eb8858d4e50178358f8a8a8c627ad36aa0c1b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.43
        },
        {
          "id": "aspect-filterable-list-model",
          "sectionId": "section-tui-widgets",
          "slug": "filterable-list-model",
          "name": "Filterable list filters with fuzzy matches and prunes keybindings",
          "description": "`exp/list/filterable.go` wraps the base list with a `textinput.Model`, runs fuzzy matching, and strips alphanumeric bindings from navigation so typing feeds the search box.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list.go",
              "sha256": "c84b6d872703188e3fd3d20b3c19936efdffba90b7a762c856b688aefe585d6e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "sectionId": "section-tui-widgets",
          "id": "aspect-filterable-match-indexes",
          "slug": "filterable-match-indexes",
          "name": "Filter records fuzzy match indexes so renderers can underline hits",
          "description": "During `Filter`, each matched item receives `MatchIndexes` from `sahilm/fuzzy`; view code can then underline the exact characters the search matched, keeping highlighting in sync with the search engine.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/filterable.go",
              "sha256": "693e2c3c3f9f54fa61f19e44d78f435010fb2709ec010b8280c04d6302a55d89"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-filterable-widget-keymap",
          "sectionId": "section-tui-widgets",
          "slug": "filterable-widget-keymap",
          "name": "List keymap mixes Vim-style and desktop navigation bindings",
          "description": "`exp/list/keys.go` binds arrow keys, ctrl+j/k, shift+arrow jumps, page up/down, and Vim-style g/G/u/d shortcuts, exposing them for help overlays.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/keys.go",
              "sha256": "9427d995f051d2ba270be3c89a9aeda9ef80841712689518a5968de7c61b48f9"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "id": "aspect-list-render-cache",
          "sectionId": "section-tui-widgets",
          "slug": "list-render-cache",
          "name": "List viewport caches rendered items to speed scrolling and updates",
          "description": "`exp/list/list.go` stores rendered item views and heights in a `csync.Map`, reusing them for scroll math and updating offsets when items change without re-rendering everything.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list.go",
              "sha256": "c84b6d872703188e3fd3d20b3c19936efdffba90b7a762c856b688aefe585d6e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-list-selection-ranges",
          "sectionId": "section-tui-widgets",
          "slug": "list-selection-ranges",
          "name": "Selection helpers map mouse columns to grapheme-safe ranges",
          "description": "`exp/list/list.go` tracks selection start/end positions, uses `uniseg` to find word and paragraph boundaries, and returns ANSI-stripped text for clipboard operations.",
          "tags": [
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list.go",
              "sha256": "c84b6d872703188e3fd3d20b3c19936efdffba90b7a762c856b688aefe585d6e"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        }
      ]
    },
    {
      "id": "section-tui-experiments",
      "slug": "tui-experiments",
      "title": "TUI Experiments",
      "entries": [
        {
          "id": "aspect-diffview-tests",
          "sectionId": "section-tui-experiments",
          "slug": "diffview-tests",
          "name": "DiffView golden tests span layouts and themes",
          "description": "`internal/tui/exp/diffview/diffview_test.go` now drives unified and split layouts through the behaviour/theme matrix plus the width and height sweeps, so the experimental widget's golden harness mirrors the dedicated regression sections. The entry pinpoints the matrix parent that seeds the newer diff regression cases.",
          "tags": [
            "diffing",
            "tests",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-diffview-udiff-tests",
          "sectionId": "section-tui-experiments",
          "slug": "diffview-udiff-tests",
          "name": "Unified diff tests check golden width variants",
          "description": "`internal/tui/exp/diffview/udiff_test.go` keeps the low-level unified diff parser honest by validating split hunk conversion, line number padding, and width math, underpinning the broader regression coverage captured in the new diff test section.",
          "tags": [
            "diffing",
            "tests",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/udiff_test.go",
              "sha256": "66e32464cb2d8e794e6d4abbeca870f341ce55d51eba963c214fd35ac4576e9b"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.31
        },
        {
          "id": "aspect-diffview-util-tests",
          "sectionId": "section-tui-experiments",
          "slug": "diffview-util-tests",
          "name": "Diff util tests validate caret alignment helpers",
          "description": "`internal/tui/exp/diffview/util_test.go` exercises helpers like `pad`, `isEven`, and the ternary shortcut, guarding the formatting primitives the renderer relies on before golden assertions run. Tagging it as tests surfaces the linkage to the regression suite.",
          "tags": [
            "diffing",
            "tests",
            "tui",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/util_test.go",
              "sha256": "98026cff4879654a2244ff490932f09618a5cf82ae52c6d0e1f08c51a1b86881"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.3
        },
        {
          "id": "aspect-exp-filterable-list-tests",
          "sectionId": "section-tui-experiments",
          "slug": "exp-filterable-list-tests",
          "name": "Filterable list tests snapshot query behaviour",
          "description": "`internal/tui/exp/list/filterable_test.go` spins up the experimental filterable list, verifies keymap stripping of single-letter bindings, and snapshots the fuzzy-filtered view so the regression section inherits a trustworthy baseline.",
          "tags": [
            "components",
            "tests",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/filterable_test.go",
              "sha256": "1c1ef62082e24be25f322ad0ce919d8e72cfb01d72fdb8a7ac85dc2f6ac12f3d"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.32
        },
        {
          "id": "aspect-exp-list-tests",
          "sectionId": "section-tui-experiments",
          "slug": "exp-list-tests",
          "name": "Experimental list tests cover selection and viewport",
          "description": "`internal/tui/exp/list/list_test.go` still drives selection changes, viewport resizing, and golden comparisons for the prototype list, and now explicitly feeds the new list regression section with expectations for direction toggles and multi-line rows.",
          "tags": [
            "components",
            "tests",
            "tui"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        }
      ]
    },
    {
      "id": "section-tui-styles",
      "slug": "tui-styles",
      "title": "TUI Styles",
      "entries": [
        {
          "id": "aspect-theme-builders",
          "sectionId": "section-tui-styles",
          "slug": "theme-builders",
          "name": "Theme builder hydrates lipgloss styles, Markdown, and Bubble inputs",
          "description": "`internal/tui/styles/theme.go` lazily composes `Styles` from the active theme, wiring markdown colours, diff styles, text inputs, and status accents so UI components can share a single palette abstraction.",
          "tags": [
            "tui",
            "config",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.62
        },
        {
          "id": "aspect-filepicker-styles",
          "sectionId": "section-tui-styles",
          "slug": "filepicker-styles",
          "name": "File picker theme colours selected, disabled, and empty states",
          "description": "`buildStyles` populates `filepicker.Styles` with theme-derived colours for directories, symlinks, disabled rows, and an `Empty directory` placeholder padded with lipgloss, ensuring the picker matches Crush branding.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.43
        },
        {
          "id": "aspect-diffview-style-palette",
          "sectionId": "section-tui-styles",
          "slug": "diffview-style-palette",
          "name": "DiffView palette maps equal/insert/delete rows to theme colours",
          "description": "`buildStyles` constructs `diffview.Style`, setting divider, insert, delete, and missing line styles with lipgloss colours matching the active theme so the experimental diff widget inherits Crush's chroma without extra wiring.",
          "tags": [
            "tui",
            "diffing",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.47
        },
        {
          "id": "aspect-help-style-sheet",
          "sectionId": "section-tui-styles",
          "slug": "help-style-sheet",
          "name": "Help view styling reuses base palette for key and description",
          "description": "The theme's `Help` styles tint short/full key segments, separators, and ellipses using foreground, muted, and border colours so Bubble Tea help components remain legible regardless of palette.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.41
        },
        {
          "id": "aspect-charmtone-theme",
          "sectionId": "section-tui-styles",
          "slug": "charmtone-theme",
          "name": "Charmtone theme seeds palette, status colors, and YOLO accents",
          "description": "`internal/tui/styles/charmtone.go` constructs the default dark theme from Charmtone tokens, defining base/overlay colours, status hues, icon glyph styles, and YOLO indicators so the rest of the style system can derive lipgloss styles lazily. `styles/theme.go` swaps palettes at runtime, so components reading from `styles.CurrentTheme` immediately reflect Charmtone updates.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/charmtone.go",
              "sha256": "ec73fc119e330b4358b7ffd7c7dddb8e746ba55d354849db7c2a15fc988d7c3c"
            },
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.53
        },
        {
          "id": "aspect-markdown-renderer",
          "sectionId": "section-tui-styles",
          "slug": "markdown-renderer",
          "name": "Markdown renderer wraps glamour with theme-backed rules",
          "description": "`internal/tui/styles/markdown.go` exposes `GetMarkdownRenderer`, injecting the current theme's Glamour rules and wrap width so chat messages and tool replies render consistently with Crush branding. Renderer output feeds into chat markdown handling, sharing the same colour mapping used by the chat renderer.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/markdown.go",
              "sha256": "dadadddb480f1597739be958ee5a5c9c1af56af27917fd6fd95cda5574420e2b"
            },
            {
              "path": "projects/Crush/internal/tui/components/chat/messages/messages.go",
              "sha256": "1b00ccb6c73be0dfbe6860641a00bcad2596a1b98306da4565be30cbf02d5eac"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.5
        },
        {
          "id": "aspect-chroma-theme",
          "sectionId": "section-tui-styles",
          "slug": "chroma-theme",
          "name": "Chroma theme mirrors markdown code block styling",
          "description": "`internal/tui/styles/chroma.go` builds a Chroma style map from the current markdown configuration, reusing color, emphasis, and underline flags so code snippets and diff styling stay in sync across the UI. The exported Chroma styles map directly into the diff and tool preview highlight pipelines, ensuring syntax colours match the active Charmtone palette.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/chroma.go",
              "sha256": "5f56af32249876e141cc09c38255ecd1932b5183037046a6ed8f231a9f2a7cb7"
            },
            {
              "path": "projects/Crush/internal/tui/highlight/highlight.go",
              "sha256": "b692625be3fcbdcb9eb1b90d2c1fe098ad8a4a3d2593cdb8b9830fac6f55c339"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.47
        },
        {
          "id": "aspect-style-icons",
          "sectionId": "section-tui-styles",
          "slug": "style-icons",
          "name": "Icon constants centralize glyph choices for status and tools",
          "description": "`internal/tui/styles/icons.go` defines the glyph set for status indicators, tool events, and borders, plus an ignore list for selection logic, preventing duplicated magic strings across widgets. Icon glyphs feed into the chat editor prompt icons and YOLO indicators, keeping status prompts consistent across components.",
          "tags": [
            "tui",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/icons.go",
              "sha256": "71fa82b4e2e12bdca78974de471795e062e4f93c6d75a58fbc5f46cdf176648d"
            },
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.38
        },
        {
          "id": "aspect-theme-manager",
          "sectionId": "section-tui-styles",
          "slug": "theme-manager",
          "name": "Theme manager lazily instantiates and caches themes",
          "description": "`internal/tui/styles/theme.go` defines a singleton `Manager` that stores named themes, ensures `CurrentTheme()` always returns a valid instance (defaulting to Charmtone), and allows tests to override the manager. Lazy construction keeps expensive lipgloss style generation out of hot paths. Chat components call `styles.CurrentTheme()` before rendering, so swapping themes propagates instantly across editor, status, and dialog surfaces.",
          "tags": [
            "tui",
            "styles",
            "rendering"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.46
        },
        {
          "id": "aspect-text-input-styles",
          "sectionId": "section-tui-styles",
          "slug": "text-input-styles",
          "name": "Theme styles wire focused and blurred text inputs",
          "description": "Within `buildStyles`, the theme configures `textinput.Styles` and `textarea.Styles`, setting prompt colours, cursor shapes (Tea cursor bar with blink), and muted palettes for blurred states so editors adopt the active palette automatically. The chat editor pulls these styles when constructing its textarea, keeping focused prompts and YOLO badges aligned with the current theme.",
          "tags": [
            "tui",
            "rendering",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/styles/theme.go",
              "sha256": "b33a6dd5f185f52993597d855060ada4c780d65990f5df53719086ee4d537427"
            },
            {
              "path": "projects/Crush/internal/tui/components/chat/editor/editor.go",
              "sha256": "3b86934216b54e424ee46ad15c9ad0825f6b7516568faccfaa0dada11cb9b884"
            }
          ],
          "lastUpdated": "2025-10-18",
          "importance": 0.45
        }
      ]
    },
    {
      "id": "section-llm-prompts",
      "slug": "llm-prompts",
      "title": "LLM Prompts",
      "entries": [
        {
          "id": "aspect-anthropic-prompt-guardrails",
          "sectionId": "section-llm-prompts",
          "slug": "anthropic-prompt-guardrails",
          "name": "Anthropic guardrails demand sub-4-line replies and proactive tooling",
          "description": "`anthropic.md` instructs the coder agent to answer in under four lines, avoid pre/postamble, and lean on CRUSH.md for memory while warning against unsolicited tool usage. It emphasises concise CLI tone, explains when to log command intent, and bans adding comments or verbose justifications\u2014tuning Claude runs for terse productivity.",
          "tags": [
            "llm",
            "prompts",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/anthropic.md",
              "sha256": "40c827f220d517381443ca2b58d2cab770ddfaa312c4036b5a020a23741c31d7"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.46
        },
        {
          "id": "aspect-coder-prompt",
          "sectionId": "section-llm-prompts",
          "slug": "coder-prompt",
          "name": "Coder prompt selects provider-specific playbooks and appends environment context",
          "description": "`internal/llm/prompt/coder.go` picks the provider-specific template (`anthropic.md`, `gemini.md`, or the richer `v2.md`, optionally forced by `CRUSH_CODER_V2`), then stitches in `getEnvironmentInfo`\u2014a snapshot of cwd, git state, platform, date, and a `tools.ListDirectoryTree` dump. It appends LSP guidance when servers are enabled and, if context files are supplied, appends a `# Project-Specific Context` section built from the deduplicated path expansion pipeline.",
          "tags": [
            "agent",
            "config",
            "llm",
            "prompts"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/coder.go",
              "sha256": "eb707c78c738b269dee6c4bc00ab754ce813f9693510e0e2c89746fdc96fbff2"
            },
            {
              "path": "projects/Crush/internal/llm/prompt/anthropic.md",
              "sha256": "40c827f220d517381443ca2b58d2cab770ddfaa312c4036b5a020a23741c31d7"
            },
            {
              "path": "projects/Crush/internal/llm/prompt/gemini.md",
              "sha256": "a84d84933e80e6cd8eac51eaf39d4dbb2a09c4e458c0380ab7075adfea652ca8"
            },
            {
              "path": "projects/Crush/internal/llm/prompt/v2.md",
              "sha256": "bcfcbc73e282e64248fda7125af5e475b1b54f9c415a7f92a5aa511a93ecf2b0"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.7
        },
        {
          "id": "aspect-gemini-prompt-guardrails",
          "sectionId": "section-llm-prompts",
          "slug": "gemini-prompt-guardrails",
          "name": "Gemini guardrails prioritize plan-first execution and command safety",
          "description": "`gemini.md` tailors instructions for Google\u2019s models, stressing verification of project conventions, explicit explanations before destructive commands, and avoidance of chatter while still allowing clarity when needed. It walks through stepwise workflows (search, plan, implement, verify) and enforces absolute paths plus security reminders so Gemini sessions stay disciplined.",
          "tags": [
            "llm",
            "prompts",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/gemini.md",
              "sha256": "a84d84933e80e6cd8eac51eaf39d4dbb2a09c4e458c0380ab7075adfea652ca8"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.44
        },
        {
          "id": "aspect-init-prompt",
          "sectionId": "section-llm-prompts",
          "slug": "init-prompt",
          "name": "Initialize prompt shares first-run setup guidance across surfaces",
          "description": "`Initialize()` in `internal/llm/prompt/initialize.go` returns the embedded `init.md` brief that asks agents to author or improve `CRUSH.md`, capturing build/test commands plus style guidelines and cursor/copilot rules in roughly 20\u201330 lines. It seeds onboarding flows with concrete expectations for the knowledge base file.",
          "tags": [
            "llm",
            "onboarding",
            "prompts"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/initialize.go",
              "sha256": "e0e845680db7fe85c8245ef0940923ac35853ed59540a16a9dcb16c7c308b4f6"
            },
            {
              "path": "projects/Crush/internal/llm/prompt/init.md",
              "sha256": "d914a2d05b8ead25c859529d020099c487acc328b1eedc682ed80b7d97124ba8"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-prompt-expand-path-tests",
          "sectionId": "section-llm-prompts",
          "slug": "prompt-expand-path-tests",
          "name": "Prompt path expansion tests cover env and tilde",
          "description": "`internal/llm/prompt/prompt_test.go` parametrizes `expandPath` with absolute, `~`, `$HOME`, and relative inputs, proving environment variables resolve correctly while plain relative paths pass through unchanged. It skips cases when env vars are unset, keeping prompt context assembly portable across shells.",
          "tags": [
            "llm",
            "prompts"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/prompt_test.go",
              "sha256": "97568b5a07d8a0c8133713c956b98f3fdc8eaaf8a537b565a022ebbd845125c5"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.35
        },
        {
          "id": "aspect-prompt-router",
          "sectionId": "section-llm-prompts",
          "slug": "prompt-router",
          "name": "Prompt router expands context paths concurrently and deduplicates files",
          "description": "`internal/llm/prompt/prompt.go` routes prompt IDs to builders and gathers optional context through `processContextPaths`, which expands `~`, resolves env variables with `config.NewEnvironmentVariableResolver`, walks directories via `filepath.WalkDir`, and tags each unique file (deduped by a `csync.Map`) with a `# From:` header. The helper streams results back through a channel so large path lists load concurrently before being appended to the base template.",
          "tags": [
            "agent",
            "llm",
            "prompts"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/prompt.go",
              "sha256": "dedbea50b9f64bef0a6a882972001841376983d44a3ffb4fe96a6e0e54fc1eac"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.63
        },
        {
          "id": "aspect-summarizer-prompt",
          "sectionId": "section-llm-prompts",
          "slug": "summarizer-prompt",
          "name": "Summarizer prompt anchors recap headings and confidence scoring",
          "description": "`SummarizerPrompt` simply returns the embedded `summarize.md`, instructing the summariser to produce concise yet thorough recaps that note work done, in-flight tasks, touched files, and next steps\u2014ideal for refreshing session headers after long runs.",
          "tags": [
            "llm",
            "prompts",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/summarizer.go",
              "sha256": "3a153b108a662204c1940f90d7539e27e50ee0ea2bf0f1f11c806a0a7b7bed58"
            },
            {
              "path": "projects/Crush/internal/llm/prompt/summarize.md",
              "sha256": "d9239322d1fa43094489b2e5d73f485782eb445c9bc548cf8105ec582a35490c"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.45
        },
        {
          "id": "aspect-task-prompt",
          "sectionId": "section-llm-prompts",
          "slug": "task-prompt",
          "name": "Task prompt enforces terse CLI answers and reuses environment footer",
          "description": "`TaskPrompt` in `internal/llm/prompt/task.go` hardcodes a terse agent script that demands sub-four-line CLI answers, absolute file paths, and on-demand command sharing, then appends the environment summary produced by `getEnvironmentInfo`. The combination pushes the task agent to respond succinctly while still inheriting directory and platform context.",
          "tags": [
            "agent",
            "llm",
            "prompts"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/task.go",
              "sha256": "a1f4e7f1e156f4b6465894ace8754079cfaee5abb172794681eb37576abdee9f"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "id": "aspect-title-prompt",
          "sectionId": "section-llm-prompts",
          "slug": "title-prompt",
          "name": "Title prompt serves the embedded naming rubric for session lists",
          "description": "`internal/llm/prompt/title.go` embeds `title.md`, a template that caps responses at 50 characters, bans punctuation like quotes or colons, and insists on a single-line summary of the user\u2019s opening message. Returning the raw string keeps the title generator deterministic for the TUI sidebar.",
          "tags": [
            "llm",
            "prompts",
            "session"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/prompt/title.go",
              "sha256": "a4f82297aebfa572c30de6b343a0a001b4c59f964ebc8138c429b664ef841df2"
            },
            {
              "path": "projects/Crush/internal/llm/prompt/title.md",
              "sha256": "470076aad949428aec85d1e7e9f2986646c55a98a3283a745e172eb6ecdc6f39"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.4
        }
      ]
    },
    {
      "id": "section-llm-providers",
      "slug": "llm-providers",
      "title": "LLM Providers",
      "entries": [
        {
          "id": "aspect-anthropic-client",
          "sectionId": "section-llm-providers",
          "slug": "anthropic-client",
          "name": "Anthropic client handles bearer auth, platform variants, and cache-aware streaming",
          "description": "`internal/llm/provider/anthropic.go` detects bearer tokens vs X-Api-Key headers, wires Bedrock or Vertex helpers via `option` adapters, and adds ephemeral cache control to the most recent user/assistant turns when caching is enabled. `convertMessages` stitches thinking blocks, drops unfinished tool calls after JSON decoding, and parses context-limit errors to ratchet down max tokens so Claude sessions recover instead of failing hard.",
          "tags": [
            "config",
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/anthropic.go",
              "sha256": "9ab2575ba5c70d4fe3dd48603df0ff24cd961c4e6f90ef2c7b9b48c2a5abfb13"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-anthropic-context-limit-retry",
          "slug": "anthropic-context-limit-retry",
          "name": "Anthropic context-limit handler recalculates safe max_tokens",
          "description": "When the API returns a 400 context-limit error, `handleContextLimitError` parses the `input length and max_tokens exceed` message via `contextLimitRegex`, derives remaining headroom, subtracts a 1k safety buffer, and clamps to at least 1000 tokens before retriggering the request. The adjusted value is stored on the client so the next retry reduces `max_tokens` without throwing away the accumulated conversation.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/anthropic.go",
              "sha256": "9ab2575ba5c70d4fe3dd48603df0ff24cd961c4e6f90ef2c7b9b48c2a5abfb13"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.64
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-anthropic-ephemeral-cache",
          "slug": "anthropic-ephemeral-cache",
          "name": "Anthropic message conversion tags trailing prompts with ephemeral cache hints",
          "description": "`convertMessages` marks the two most recent user or assistant messages with `CacheControlEphemeralParam` unless cacheing is disabled, so repeated follow-ups can reuse Anthropic's prompt cache. It also appends Bubble Tea binary uploads as base64 `image` blocks and only forwards finished tool calls, keeping transcripts clean while still cache-friendly.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/anthropic.go",
              "sha256": "9ab2575ba5c70d4fe3dd48603df0ff24cd961c4e6f90ef2c7b9b48c2a5abfb13"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-anthropic-rate-limit-retry",
          "slug": "anthropic-rate-limit-retry",
          "name": "Anthropic retry path re-resolves credentials and honors backoff headers",
          "description": "`shouldRetry` caps retries at `maxRetries`, distinguishes credential failures, and re-resolves the configured API key (rebuilding the client) before retrying. For rate-limit and overload responses it inspects `Retry-After`, otherwise falls back to exponential backoff with jitter so Anthropic throttling is respected without blocking the UI thread.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/anthropic.go",
              "sha256": "9ab2575ba5c70d4fe3dd48603df0ff24cd961c4e6f90ef2c7b9b48c2a5abfb13"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.62
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-anthropic-stream-events",
          "slug": "anthropic-stream-events",
          "name": "Anthropic streaming surfaces thinking and tool events incrementally",
          "description": "`internal/llm/provider/anthropic.go`'s `stream` goroutine accumulates `anthropic.Message` state while translating `ContentBlockStart`, `ContentBlockDelta`, `ContentBlockStop`, and `MessageStop` notifications into domain `ProviderEvent`s. It emits `EventThinkingDelta` and `EventSignatureDelta` when the SDK surfaces interleaved reasoning tokens, pushes `EventToolUseStart`/`EventToolUseDelta`/`EventToolUseStop` for partial JSON inputs keyed by `currentToolCallID`, and routes text deltas plus a final `EventComplete` that bundles content, usage, tool calls, and a mapped finish reason.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/anthropic.go",
              "sha256": "9ab2575ba5c70d4fe3dd48603df0ff24cd961c4e6f90ef2c7b9b48c2a5abfb13"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-anthropic-thinking-beta",
          "slug": "anthropic-thinking-beta",
          "name": "Anthropic thinking opt-in enables signature deltas for reasoning UI",
          "description": "Before opening a stream the client checks `isThinkingEnabled` and adds the `anthropic-beta: interleaved-thinking-2025-05-14` header, unlocking per-token reasoning and signature feeds. The subsequent delta handler emits `EventThinkingDelta` and `EventSignatureDelta`, letting the TUI render Claude's chain-of-thought and signed provenance alongside content.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/anthropic.go",
              "sha256": "9ab2575ba5c70d4fe3dd48603df0ff24cd961c4e6f90ef2c7b9b48c2a5abfb13"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "id": "aspect-azure-client",
          "sectionId": "section-llm-providers",
          "slug": "azure-client",
          "name": "Azure OpenAI client injects deployment API versions and reuses OpenAI behaviours",
          "description": "`internal/llm/provider/azure.go` picks the preview API version when callers omit one, builds the Azure endpoint via `azure.WithEndpoint`, and appends the shared debug HTTP client when verbose mode is active. It wraps the configured options in the standard `openaiClient`, so the rest of the provider pipeline (message conversion, tool invocation, streaming) behaves identically to first-party OpenAI deployments.",
          "tags": [
            "config",
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/azure.go",
              "sha256": "5cc41160ba28775594176e38b870be5239dee6a65be9bad2d9e952b675f7fda8"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-azure-default-api-version",
          "slug": "azure-default-api-version",
          "name": "Azure adapter defaults preview API versions and reuses OpenAI client",
          "description": "The Azure provider pulls `apiVersion` from `extraParams`, falling back to `2025-01-01-preview`, and builds request options with `azure.WithEndpoint` plus optional debug HTTP logging. It then wraps the configured key with `azure.WithAPIKey` and instantiates an OpenAI client reuse so Azure deployments behave like native OpenAI models without additional plumbing.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/azure.go",
              "sha256": "5cc41160ba28775594176e38b870be5239dee6a65be9bad2d9e952b675f7fda8"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.55
        },
        {
          "id": "aspect-bedrock-client",
          "sectionId": "section-llm-providers",
          "slug": "bedrock-client",
          "name": "Bedrock client rewrites model IDs, disables cache, and delegates to Anthropic",
          "description": "`internal/llm/provider/bedrock.go` derives a region prefix from the configured AWS region, rewrites model IDs accordingly, and force-disables request caching before instantiating the Anthropic Bedrock client. Unsupported models short-circuit with an error event, while supported Claude variants reuse the Anthropic `send`/`stream` implementations so Crush gets consistent tool and content emission semantics on AWS.",
          "tags": [
            "config",
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/bedrock.go",
              "sha256": "e971c4d773668da1d5f9d9a4c22db99b22dd2b275dcdc2c35b622117417f0403"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.57
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-bedrock-region-prefixed-models",
          "slug": "bedrock-region-prefixed-models",
          "name": "Bedrock wrapper rewrites model IDs with region prefixes and disables cache",
          "description": "`newBedrockClient` coerces the configured region (defaulting to `us-east-1`), rewrites the selected model ID with the region's two-letter prefix, and hands Anthropic models off to `newAnthropicClient` in Bedrock mode while forcing cacheing off. Unsupported model families fall back to a nil child provider, ensuring misconfiguration surfaces as a controlled runtime error.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/bedrock.go",
              "sha256": "e971c4d773668da1d5f9d9a4c22db99b22dd2b275dcdc2c35b622117417f0403"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-gemini-client",
          "sectionId": "section-llm-providers",
          "slug": "gemini-client",
          "name": "Gemini client maps Crush parts, inline media, and tool calls into GenAI payloads",
          "description": "`internal/llm/provider/gemini.go` builds the Google GenAI client with optional base URL overrides and the debug HTTP transport, then turns Crush messages into `genai.Content` lists that mix text, inline binary blobs, and finished function calls. `convertTools` emits function declarations from tool schemas, while `send` hydrates model defaults, enforces max tokens, and translates Gemini finish reasons back into Crush enums for downstream cost accounting.",
          "tags": [
            "config",
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/gemini.go",
              "sha256": "e4e1fd7c8cbe28509e018cc21d9cfbe74d2a1cef14683652b0294f1c7911e347"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-gemini-multipart-content",
          "slug": "gemini-multipart-content",
          "name": "Gemini message conversion packs text and inline binary parts for multimodal runs",
          "description": "User messages become `genai.Content` entries composed of text plus `InlineData` blobs for each binary attachment, while assistant replies can mix text and finished tool calls. The structure lets Gemini receive multimodal prompts without callers manually interleaving base64, and preserves Crush's binary uploads in the provider transcript.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/gemini.go",
              "sha256": "e4e1fd7c8cbe28509e018cc21d9cfbe74d2a1cef14683652b0294f1c7911e347"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-gemini-tool-response-mapping",
          "slug": "gemini-tool-response-mapping",
          "name": "Gemini conversion threads tool responses back to originating calls",
          "description": "`convertMessages` wraps assistant tool calls as `FunctionCall` parts and, when processing tool result messages, walks prior assistant messages to locate the matching `ToolCall` so responses can be emitted as `FunctionResponse` parts with structured JSON (falling back to string payloads when parsing fails). That keeps Gemini's function-calling exchange coherent across request/reply pairs.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/gemini.go",
              "sha256": "e4e1fd7c8cbe28509e018cc21d9cfbe74d2a1cef14683652b0294f1c7911e347"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.6
        },
        {
          "id": "aspect-openai-client",
          "sectionId": "section-llm-providers",
          "slug": "openai-client",
          "name": "OpenAI client resolves base URLs, Anthropic cache hints, and tool payloads",
          "description": "`internal/llm/provider/openai.go` resolves custom base URLs through the config resolver, adds a debug `http.Client` when `Options.Debug` is set, and threads extra headers/body overrides into the SDK request options. `convertMessages` maps Crush transcripts into chat payloads with binary image parts, strips unfinished tool calls, and injects `cache_control` metadata when OpenRouter Anthropic models run via OpenAI, while `convertTools` mirrors function schemas so tool descriptors stay in sync with provider contracts.",
          "tags": [
            "config",
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/openai.go",
              "sha256": "bb505fa93771ce6699b63335c877eeb380a8cd622c396f4bcf97102dd0d60cfe"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.68
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-openai-finish-reason-guard",
          "slug": "openai-finish-reason-guard",
          "name": "OpenAI completion normalizes finish reasons and tool-use outcomes",
          "description": "After streaming completes the accumulator defaults empty `FinishReason` values to `stop` (covering OpenRouter quirks) and upgrades the reason to `tool_use` whenever any tool call payloads were produced. It also keeps `IncludeUsage` enabled on the stream options so token accounting accompanies the synthesized finish reason in `ProviderResponse`.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/openai.go",
              "sha256": "bb505fa93771ce6699b63335c877eeb380a8cd622c396f4bcf97102dd0d60cfe"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "id": "aspect-openai-provider-tests",
          "sectionId": "section-llm-providers",
          "slug": "openai-provider-tests",
          "name": "OpenAI provider tests harden streaming and retries",
          "description": "`internal/llm/provider/openai_test.go` spins up an SSE server that emits empty choice chunks to ensure the streaming client no longer panics when OpenAI returns malformed payloads. It also drives `shouldRetry` for quota versus rate-limit errors, confirming Crush escalates exhausted quota immediately while retrying transient 429s.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/openai_test.go",
              "sha256": "3327b2c031c073cf77ff3c6d2ebecd3c93e2a0ba4976084ac514b24e1f45a017"
            }
          ],
          "lastUpdated": "2025-10-21",
          "importance": 0.37
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-openai-reasoning-deltas",
          "slug": "openai-reasoning-deltas",
          "name": "OpenAI stream forwards reasoning extra fields as thinking deltas",
          "description": "While iterating streaming chunks the client inspects `choice.Delta.JSON.ExtraFields[\"reasoning\"]`, unmarshals the JSON wrapper, and pushes `EventThinkingDelta` events whenever the vendor surfaces intermediate rationale. That lets Crush display Qwen or o1-style reasoning traces even though OpenAI nests them outside the standard content channel.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/openai.go",
              "sha256": "bb505fa93771ce6699b63335c877eeb380a8cd622c396f4bcf97102dd0d60cfe"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.58
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-openai-stream-tool-reassembly",
          "slug": "openai-stream-tool-reassembly",
          "name": "OpenAI stream reconstructs fragmented tool calls and emits start events",
          "description": "`internal/llm/provider/openai.go` reassembles chunked tool invocations by tracking `ChatCompletionMessageToolCall` entries per-choice index, normalising `functions.`-prefixed IDs, and generating UUIDs when the API omits them. Each new tool call triggers `EventToolUseStart`, and subsequent deltas mutate the cached struct until completion so downstream observers receive coherent tool inputs.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/openai.go",
              "sha256": "bb505fa93771ce6699b63335c877eeb380a8cd622c396f4bcf97102dd0d60cfe"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.66
        },
        {
          "id": "aspect-provider-client",
          "sectionId": "section-llm-providers",
          "slug": "provider-client",
          "name": "Provider client resolves credentials, options, and strips empty message parts",
          "description": "`internal/llm/provider/provider.go` resolves API keys plus extra headers via the config stack, builds a `providerClientOptions` bundle (including max tokens, cache toggles, and system prompt prefixes), and instantiates the typed client for Anthropic, OpenAI, Gemini, Bedrock, or Azure. The `baseProvider` filters out zero-part messages before calling `send`/`stream`, so providers receive clean transcripts while functional options like `WithDisableCache` and `WithSystemMessage` tune behaviour on a per-call basis.",
          "tags": [
            "providers",
            "config",
            "llm"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/provider.go",
              "sha256": "9a0a3ec225a1f250b6fbb391fccffac2c046d12d7d8d519e792714867ad5f8c6"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.8
        },
        {
          "id": "aspect-vertexai-client",
          "sectionId": "section-llm-providers",
          "slug": "vertexai-client",
          "name": "Vertex AI client configures project/location routing and dispatches to Anthropic or Gemini",
          "description": "`internal/llm/provider/vertexai.go` boots the GenAI client with Google auth using the supplied project and location, reuses the debug HTTP client in verbose mode, and inspects the model ID to decide whether to delegate to the Anthropic Vertex adapter or the Gemini client. That keeps Claude-on-Vertex and native Gemini models flowing through a single provider entry point with matching event formats.",
          "tags": [
            "config",
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/vertexai.go",
              "sha256": "0be838cccb1b6471cdea87d3f233ae3640cff74d46b20dff9c7844d8bd5c490a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        },
        {
          "sectionId": "section-llm-providers",
          "id": "aspect-vertexai-client-switch",
          "slug": "vertexai-client-switch",
          "name": "Vertex AI adapter routes Anthropic-branded models through Claude client",
          "description": "`newVertexAIClient` builds a Vertex `genai.Client` from `extraParams` project/location, mirrors debug HTTP logging, and then inspects the resolved model ID. Anthropic, Claude, or Sonnet IDs trigger a hand-off to `newAnthropicClient` in Vertex mode; everything else reuses the Gemini client so callers get the right protocol bridge without manual wiring.",
          "tags": [
            "llm",
            "providers"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/llm/provider/vertexai.go",
              "sha256": "0be838cccb1b6471cdea87d3f233ae3640cff74d46b20dff9c7844d8bd5c490a"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.56
        }
      ]
    },
    {
      "id": "section-tui-diff-tests",
      "slug": "tui-diff-tests",
      "title": "TUI Diff Regression",
      "entries": [
        {
          "id": "aspect-tui-diff-tests-matrix",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-matrix",
          "name": "Diff view test matrix covers layout, behavior, theme",
          "description": "`TestDiffView` nests `LayoutFuncs`, `BehaviorFuncs`, and `ThemeFuncs`, rendering every combination of unified/split layouts, behaviour presets, and dark/light palettes before asserting against chroma goldens. The matrix ensures renderer tweaks cannot regress specialised configurations because each triplet is replayed through `golden.RequireEqual`.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.42
        },
        {
          "id": "aspect-tui-diff-tests-default",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-default-behavior",
          "name": "Default diff behavior golden locks main.go baseline",
          "description": "Within the behaviour map, `DefaultFunc` feeds `main.go` before/after fixtures into the diff view, guaranteeing the canonical case stays pixel-identical as styling evolves. Any incidental styling change immediately alters the golden snapshot for fast feedback.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.36
        },
        {
          "id": "aspect-tui-diff-tests-no-line-numbers",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-no-line-numbers",
          "name": "No-line-number mode retains stable golden layout",
          "description": "`NoLineNumbersFunc` toggles `LineNumbers(false)` before exercising the diff view, proving that removing gutters still preserves padding and column alignment for both layouts. The snapshots ensure compact displays continue to look balanced when gutters disappear.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-diff-tests-multiple-hunks",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-multiple-hunks",
          "name": "Multiple hunk fixture protects divider rendering",
          "description": "`MultipleHunksFunc` loads multi-hunk fixtures so `TestDiffView` validates divider rows, context spacing, and hunk metadata across adjacent changes. The scenario covers diff streams that stitch several hunks together during reviews.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-diff-tests-context-lines",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-custom-context",
          "name": "Custom context lines keep ellipsis overflow predictable",
          "description": "`CustomContextLinesFunc` bumps context to four lines, and the golden asserts that ellipsis banners and padding scale with the larger window. It guards truncation logic when reviewers dial the surrounding context up for broader changes.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-diff-tests-narrow",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-narrow",
          "name": "Narrow file fixture validates truncation banners",
          "description": "The `NarrowFunc` behaviour switches to a slim text fixture, letting the golden compare how the renderer collapses thin code panes and draws ellipsis prefixes. It prevents regressions in padding when inputs contain only a few columns.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-diff-tests-small-width",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-small-width",
          "name": "40-column diff asserts clamped code width",
          "description": "`SmallWidthFunc` forces `Width(40)` before rendering, and `TestDiffView` immediately calls `assertLineWidth` to confirm ANSI output never exceeds 40 columns. The guard catches regressions where decorations or symbols widen the viewport.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.37
        },
        {
          "id": "aspect-tui-diff-tests-large-width",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-large-width",
          "name": "120-column diff confirms wide padding pipeline",
          "description": "`LargeWidthFunc` expands the diff to 120 columns and reuses `assertLineWidth` to catch any loss of spacing in broader review panes. The test ensures wrapping logic holds for ultra-wide windows favoured by reviewers.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.37
        },
        {
          "id": "aspect-tui-diff-tests-no-syntax",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-no-syntax",
          "name": "No syntax highlight path keeps styling neutral",
          "description": "`NoSyntaxHighlightFunc` passes `ChromaStyle(nil)` to exercise the renderer when syntax colouring is disabled. The golden snapshot ensures the fallback still respects column widths and diff symbols instead of producing blank output.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-diff-tests-light-theme",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-light-theme",
          "name": "Light theme regression tracks catppuccin latte palette",
          "description": "`LightModeFunc` swaps in `diffview.DefaultLightStyle()` plus the `catppuccin-latte` chroma theme, so the golden ensures light-mode palettes remain legible after palette tweaks. It locks the expected colour balance and contrast ratios.",
          "tags": [
            "tui",
            "tests",
            "diffing",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-diff-tests-dark-theme",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-dark-theme",
          "name": "Dark theme regression anchors catppuccin macchiato",
          "description": "`DarkModeFunc` renders the diff with `DefaultDarkStyle()` and the `catppuccin-macchiato` chroma palette, giving a golden that protects night-mode gradients and gutter readability. Any shift in accent hues surfaces immediately.",
          "tags": [
            "tui",
            "tests",
            "diffing",
            "styles"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-diff-tests-tabs",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-tabs",
          "name": "Tab expansion snapshots keep indentation stable",
          "description": "`TestDiffViewTabs` embeds fixtures with literal tab characters, verifying the renderer expands them consistently for unified and split layouts. The golden protects against regressions where tab width tweaks would distort alignment.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.36
        },
        {
          "id": "aspect-tui-diff-tests-linebreak",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-line-break",
          "name": "Line break regression guards CRLF normalization",
          "description": "`TestDiffViewLineBreakIssue` replays fixtures with Windows-style line endings to ensure `normalizeLineEndings` continues to harmonise CRLF pairs. The golden diff shows the once-problematic carriage returns rendered cleanly.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.36
        },
        {
          "id": "aspect-tui-diff-tests-width-sweep",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-width-sweep",
          "name": "Width sweep tests stress split layout scaling",
          "description": "`TestDiffViewWidth` iterates widths from 1 to 110, rendering split and unified diffs for each and matching them to goldens. The sweep detects regressions in padding and split-column math, especially around tiny widths that previously broke symbol columns.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.38
        },
        {
          "id": "aspect-tui-diff-tests-width-unified-cap",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-width-unified-cap",
          "name": "Unified layout caps width sweep at sixty columns",
          "description": "Inside `TestDiffViewWidth`, the unified branch skips widths beyond 60 to match the renderer\u2019s practical limits. The code comment and test encode the design constraint so future engineers preserve the unified truncation policy.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.32
        },
        {
          "id": "aspect-tui-diff-tests-height-sweep",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-height-sweep",
          "name": "Height sweep validates viewport trimming",
          "description": "`TestDiffViewHeight` walks heights from 1 to 20 and ensures truncated diffs still match goldens and obey `assertHeight`. The sweep safeguards overflow banners and blank-line padding when the viewport is shorter than the diff content.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.37
        },
        {
          "id": "aspect-tui-diff-tests-xoffset",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-xoffset",
          "name": "Horizontal offset sweep checks truncation headers",
          "description": "`TestDiffViewXOffset` advances `XOffset` from 0 to 20 while keeping width 60, confirming the renderer emits leading ellipses and truncates code consistently. The assertions catch regressions where horizontal scrolling clipped syntax highlighting.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.36
        },
        {
          "id": "aspect-tui-diff-tests-yoffset",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-yoffset",
          "name": "Vertical offsets enforce clamped scroll window",
          "description": "`TestDiffViewYOffset` iterates offsets with a fixed height of five lines and relies on `assertHeight` to ensure clamping logic never exposes partial frames. It captures earlier bugs where scrolling past the last hunk produced blank space.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.36
        },
        {
          "id": "aspect-tui-diff-tests-yoffset-infinite",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-infinite-scroll",
          "name": "Infinite Y scroll regression locks elastic behaviour",
          "description": "`TestDiffViewYOffsetInfinite` toggles `InfiniteYScroll(true)` and replays the same offset sweep to confirm the renderer keeps emitting content beyond the diff tail without crashing. The golden run ensures elastic scrolling still respects height constraints.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-diff-tests-assertions",
          "sectionId": "section-tui-diff-tests",
          "slug": "diffview-test-assertions",
          "name": "Assertion helpers measure rendered ANSI dimensions",
          "description": "Helper functions `assertLineWidth` and `assertHeight` strip ANSI sequences and count graphemes to validate rendered size. They encapsulate width/height measurement so every sweep test can verify viewport bounds without duplicating parsing code.",
          "tags": [
            "tui",
            "tests",
            "diffing"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/diffview/diffview_test.go",
              "sha256": "8a015b3e9f72a3548cacf7985aacb0d9daed389864fbba1edafc6ae008fd4463"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        }
      ]
    },
    {
      "id": "section-tui-list-tests",
      "slug": "tui-list-tests",
      "title": "TUI List Regression",
      "entries": [
        {
          "id": "aspect-tui-list-tests-forward-fit",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-fit",
          "name": "Forward list fit test locks baseline rendering",
          "description": "The opening subtest initialises five `NewSelectableItem` entries with `WithDirectionForward()` and verifies offsets, rendered heights, and `viewPosition()` bounds before matching a golden. It protects the default scrolling pipeline for compact lists.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-backward-fit",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-fit",
          "name": "Backward list fit test validates reverse ordering",
          "description": "`TestList` mirrors the baseline case with `WithDirectionBackward()`, proving reverse-ordered lists seed `selectedItem` with the last element and maintain consistent render caches. The golden ensures pagination math holds when the newest entries appear at the top.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-forward-overflow",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-overflow",
          "name": "Forward overflow test checks viewport bounds",
          "description": "The third subtest grows the dataset to thirty items while keeping height ten, ensuring offsets remain zero and every rendered item records start/end rows. It guards the bookkeeping that powers virtual scrolling when more entries exist than rows.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-list-tests-backward-overflow",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-overflow",
          "name": "Backward overflow test preserves reverse offsets",
          "description": "The companion backward case keeps the height at ten but ensures `viewPosition()` starts at twentieth row, verifying reverse lists anchor to the bottom. The assertions confirm cached rendered ranges align with offset arithmetic when scrolling upward.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-list-tests-forward-multiline",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-multiline",
          "name": "Forward multi-line items tally rendered height",
          "description": "The multi-line forward case fills each item with incrementing newline counts and asserts the aggregated rendered height equals the sum of line counts. It ensures the list\u2019s cached `renderedItems` map tracks variable-height rows without misaligning the viewport.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-list-tests-backward-multiline",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-multiline",
          "name": "Backward multi-line items keep offsets stable",
          "description": "Repeating the multi-line scenario with `WithDirectionBackward()` confirms the list still anchors to the newest item and sums cumulative heights correctly. The golden shows the reverse-ordered viewport retains the same spacing despite taller rows.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.35
        },
        {
          "id": "aspect-tui-list-tests-forward-selected",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-selected",
          "name": "Forward selected item jump respects WithSelectedItem",
          "description": "`TestList` seeds a forward list with `WithSelectedItem(items[10].ID())` and confirms the model lands on that entry after `Init()`. The golden locks the viewport so future refactors cannot forget to honour the pre-selected anchor.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.32
        },
        {
          "id": "aspect-tui-list-tests-backward-selected",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-selected",
          "name": "Backward selected item jump respects reverse ordering",
          "description": "The next subtest repeats the `WithSelectedItem` path under backward navigation, verifying the cursor still lands on the tenth entry even though the list is reversed. It protects code that remaps indexes when direction flips.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.32
        },
        {
          "id": "aspect-tui-list-tests-move-up",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-move-up",
          "name": "MoveUp bulk scroll updates backward offsets",
          "description": "`TestListMovement` calls `MoveUp(25)` on a backward list and expects `offset` to equal 25 afterwards. The golden demonstrates the viewport jumping towards older entries while retaining highlight state, guarding the paging math for keyboard navigation.",
          "tags": [
            "tui",
            "tests",
            "widgets",
            "keyboard"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-list-tests-move-up-down",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-move-up-down",
          "name": "MoveUp then MoveDown restores origin",
          "description": "A follow-up subtest chains `MoveUp(25)` and `MoveDown(25)` to ensure offsets return to zero and the rendered view matches the original golden. It validates that scrolling operations are symmetrical and do not accumulate rounding errors.",
          "tags": [
            "tui",
            "tests",
            "widgets",
            "keyboard"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-list-tests-move-down",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-move-down",
          "name": "MoveDown bulk scroll advances forward lists",
          "description": "The forward counterpart applies `MoveDown(25)` and asserts `offset` increases accordingly, catching regressions where forward navigation used to stall near the bottom. The golden depicts the expected viewport after the jump.",
          "tags": [
            "tui",
            "tests",
            "widgets",
            "keyboard"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-list-tests-move-down-up",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-move-down-up",
          "name": "MoveDown then MoveUp keeps forward viewport stable",
          "description": "Another subtest chains `MoveDown` and `MoveUp` on a forward list to ensure offsets return to zero and snapshots stay identical. It guarantees repeated navigation does not leak state into the rendered output.",
          "tags": [
            "tui",
            "tests",
            "widgets",
            "keyboard"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-list-tests-backward-append-bottom",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-append-bottom",
          "name": "Appending at bottom keeps backward list pinned",
          "description": "`TestListMovement` appends an item while the backward list sits at offset zero, asserting the viewport and rendered height remain unchanged. The test protects the behaviour where new messages arrive but the user is already viewing the newest entry.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-backward-append-offset",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-append-offset",
          "name": "Backward offset preserved after append above view",
          "description": "After executing `MoveUp(2)`, the test appends an item and verifies both the rendered output and offset remain at five. It catches regressions where inserting new history would snap the viewport away from the user\u2019s place.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-backward-update-below",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-update-below",
          "name": "Updating item below maintains backward viewport",
          "description": "The suite modifies an item below the cursor, increasing its height, and checks the viewport and offset remain intact. It verifies the diff-aware update path recalculates cached ranges without yanking focus for backward lists.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-backward-update-below-decrease",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-update-below-decrease",
          "name": "Shrinking lower item keeps backward scroll anchored",
          "description": "Another backward subtest updates an item below the cursor to shrink from three lines to one and asserts the offset stays at zero. The golden shows the list avoiding a negative scroll as cached heights contract.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-list-tests-backward-update-above",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-update-above",
          "name": "Growing item above preserves backward offset",
          "description": "The backward movement suite also increases the height of an earlier item and verifies the offset remains two, confirming cached start positions shift without pulling focus. It protects scenarios where earlier messages expand after streaming edits.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-backward-prepend",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-backward-prepend",
          "name": "Prepending item leaves backward viewport untouched",
          "description": "After moving up two rows, the test prepends a new item and asserts the rendered view and offset stay identical. It ensures reverse-ordered timelines can insert historical context without jolting the reader\u2019s position.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-list-tests-forward-prepend-top",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-prepend-top",
          "name": "Forward prepend at top keeps offset zero",
          "description": "Switching to forward mode, the suite prepends an item while the cursor rests at the very top and checks the offset persists at zero. The golden guards the behaviour where new system prompts appear above without forcing a scroll.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-forward-prepend-offset",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-prepend-offset",
          "name": "Forward prepend after scroll preserves cursor",
          "description": "The forward list scrolls down two items, prepends a multi-line entry, and confirms the offset remains five. It protects the conversation view when older summaries stream in while the operator reviews mid-thread content.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-forward-update-above",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-update-above",
          "name": "Growing item above maintains forward offset",
          "description": "A forward scenario enlarges the first item after scrolling down, proving the viewport stays locked with offset four even as cached heights shift. It defends against focus jumps when earlier chat messages expand with extra context.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-forward-update-above-decrease",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-update-above-decrease",
          "name": "Shrinking top item avoids forward scroll jump",
          "description": "The next case contracts a tall header item and asserts the offset drops to one, mirroring expected behaviour when sticky banners collapse. The golden ensures compression recalculations keep the viewport aligned with the next visible row.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.33
        },
        {
          "id": "aspect-tui-list-tests-forward-update-below",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-update-below",
          "name": "Growing item below leaves forward offset fixed",
          "description": "When a forward list increases the height of an item below the viewport, the test asserts the offset stays two, proving growth beneath the cursor does not knock the reader upward. It validates the incremental height tracking in `UpdateItem`.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        },
        {
          "id": "aspect-tui-list-tests-forward-append",
          "sectionId": "section-tui-list-tests",
          "slug": "list-test-forward-append",
          "name": "Appending item preserves forward mid-thread view",
          "description": "Finally, the forward test appends a new item while the viewport is scrolled partway down and checks both offset and rendering remain unchanged. It ensures live tool output appended at the bottom does not steal focus from an in-progress review.",
          "tags": [
            "tui",
            "tests",
            "widgets"
          ],
          "sources": [
            {
              "path": "projects/Crush/internal/tui/exp/list/list_test.go",
              "sha256": "efaaa53713b2b49ae452533016229679d51f24af64710323e5f28a4b9d25c7e4"
            }
          ],
          "lastUpdated": "2025-10-16",
          "importance": 0.34
        }
      ]
    }
  ]
}
